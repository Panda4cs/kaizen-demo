{"version":3,"sources":["webpack:///./node_modules/core-js/internals/same-value.js","webpack:///./node_modules/base64-js/index.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack:///./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack:///./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","webpack:///./node_modules/core-js/modules/es.object.is.js","webpack:///../../../src/mixins/validatable/index.ts","webpack:///./node_modules/fabric/dist/fabric.js","webpack:///../../../src/components/VCounter/VCounter.ts","webpack:///../../../src/components/VCounter/index.ts","webpack:///../../../src/mixins/intersectable/index.ts","webpack:///../../../src/components/VTextField/VTextField.ts","webpack:///./node_modules/ieee754/index.js","webpack:///../../../src/components/VIcon/index.ts","webpack:///./node_modules/core-js/modules/es.array.splice.js","webpack:///./node_modules/buffer/index.js","webpack:///../../../src/components/VLabel/VLabel.ts","webpack:///../../../src/components/VLabel/index.ts","webpack:///../../../src/components/VMessages/VMessages.ts","webpack:///../../../src/components/VMessages/index.ts","webpack:///../../../src/components/VInput/VInput.ts","webpack:///../../../src/components/VInput/index.ts","webpack:///../../../src/components/VChip/VChip.ts","webpack:///../../../src/directives/resize/index.ts","webpack:///./node_modules/isarray/index.js"],"names":["module","exports","Object","is","x","y","byteLength","toByteArray","fromByteArray","lookup","revLookup","Arr","Uint8Array","Array","code","i","len","length","charCodeAt","getLens","b64","Error","validLen","indexOf","placeHoldersLen","lens","_byteLength","tmp","arr","curByte","tripletToBase64","num","encodeChunk","uint8","start","end","output","push","join","extraBytes","parts","maxChunkLength","len2","_arrayWithoutHoles","isArray","arrayLikeToArray","_iterableToArray","iter","Symbol","iterator","from","_nonIterableSpread","TypeError","_toConsumableArray","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread","$","target","stat","baseMixins","name","props","disabled","error","errorCount","type","Number","default","errorMessages","String","messages","readonly","rules","success","successMessages","validateOnBlur","value","required","data","errorBucket","hasColor","hasFocused","hasInput","isFocused","isResetting","lazyValue","this","valid","computed","computedColor","isDark","hasError","internalErrorMessages","hasSuccess","internalSuccessMessages","externalError","hasMessages","validationTarget","hasState","shouldValidate","genInternalMessages","internalMessages","internalValue","get","set","isDisabled","form","isInteractive","isReadonly","validations","slice","validationState","watch","handler","newVal","deep","$nextTick","val","setTimeout","beforeMount","created","register","beforeDestroy","unregister","methods","reset","resetValidation","validate","force","index","rule","fabric","version","document","window","HTMLDocument","Document","implementation","createHTMLDocument","jsdom","virtualWindow","JSDOM","decodeURIComponent","features","FetchExternalResources","resources","jsdomImplForWrapper","implForWrapper","nodeCanvas","Canvas","DOMParser","resizeCanvasIfNeeded","pipelineState","targetCanvas","width","height","dWidth","destinationWidth","dHeight","destinationHeight","copyGLTo2DDrawImage","gl","glCanvas","canvas","ctx","getContext","translate","scale","sourceY","drawImage","copyGLTo2DPutImageData","numBytes","u8","imageBuffer","u8Clamped","Uint8ClampedArray","readPixels","RGBA","UNSIGNED_BYTE","imgData","ImageData","putImageData","isTouchSupported","navigator","maxTouchPoints","isLikelyNode","Buffer","SHARED_ATTRIBUTES","DPI","reNum","commaWsp","rePathCommand","reNonWord","fontPaths","iMatrix","svgNS","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","textureSize","disableStyleCopyPaste","enableGLFiltering","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","browserShadowBlurConstant","arcToSegmentsCache","boundsOfCurveCache","cachesBoundsOfCurve","forceGLPutImageData","initFilterBackend","isWebglSupported","console","log","maxTextureSize","WebglFilterBackend","tileSize","Canvas2dFilterBackend","_removeEventListener","eventName","__eventListeners","eventListener","util","array","fill","on","arguments","prop","off","call","fire","options","listenersForEvent","filter","Observable","Collection","_objects","add","apply","_onObjectAdded","renderOnAddRemove","requestRenderAll","insertAt","object","nonSplicing","objects","splice","remove","somethingRemoved","_onObjectRemoved","forEachObject","callback","context","getObjects","concat","o","item","isEmpty","size","contains","complexity","reduce","memo","current","CommonMethods","_setOptions","_initGradient","filler","property","colorStops","Gradient","_initPattern","source","Pattern","_setObject","obj","_set","key","toggle","global","sqrt","Math","atan2","pow","PiBy180","PI","PiBy2","cos","angle","angleSlice","sin","sign","removeFromArray","idx","getRandomInt","min","max","floor","random","degreesToRadians","degrees","radiansToDegrees","radians","rotatePoint","point","origin","subtractEquals","v","rotateVector","Point","addEquals","vector","rx","ry","transformPoint","p","t","ignoreOffset","makeBoundingBoxFromPoints","points","transform","xPoints","minX","maxX","yPoints","minY","maxY","left","top","invertTransform","a","r","toFixed","number","fractionDigits","parseFloat","parseUnit","fontSize","unit","exec","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","toUpperCase","resolveNamespace","getSvgAttributes","attributes","split","loadImage","url","crossOrigin","img","createImage","onLoadCallback","onload","onerror","src","undefined","substring","loadImageInDom","div","createElement","style","position","appendChild","querySelector","parentNode","removeChild","enlivenObjects","reviver","enlivenedObjects","numLoadedObjects","numTotalObjects","onLoaded","forEach","klass","fromObject","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","path","centerPoint","Group","sourcePath","populateWithProperties","destination","properties","prototype","toString","drawDashedLine","x2","y2","da","dx","dy","rot","dc","di","draw","save","moveTo","rotate","restore","createCanvasElement","copyCanvasElement","newCanvas","toDataURL","canvasEl","format","quality","multiplyTransformMatrices","b","is2x2","qrDecompose","denom","scaleX","scaleY","skewX","skewY","translateX","translateY","calcRotateMatrix","theta","calcDimensionsMatrix","scaleMatrix","flipX","flipY","multiply","tan","composeMatrix","matrix","resetObjectTransform","saveObjectTransform","isTransparent","tolerance","temp","_isTransparent","imageData","getImageData","l","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","alignX","alignY","aspectRatioAttrs","pop","clearFabricFontCache","fontFamily","toLowerCase","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","findScaleToFit","findScaleToCover","matrixToSVG","map","NUM_FRACTION_DIGITS","sizeAfterTransform","dimX","dimY","transformMatrix","bbox","_join","commandLengths","m","h","c","s","q","repeatedCommands","M","segmentToBezier","th2","th3","cosTh","sinTh","cx1","cy1","mT","fromX","fromY","costh2","sinth2","costh3","sinth3","toX","toY","cp1X","cp1Y","cp2X","cp2Y","arcToSegments","large","sweep","rotateX","th","abs","px","py","rx2","ry2","py2","px2","pl","root","cx","cy","mTheta","calcVectorAngle","dtheta","segments","ceil","result","mDelta","ux","uy","vx","vy","ta","tb","getBoundsOfCurve","x0","y0","x1","y1","x3","y3","argsString","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","j","jlen","fromArcToBeizers","fx","fy","coords","tx","ty","segsNorm","makePathSimpler","converted","previous","controlX","controlY","destinationPath","calcLineLength","CB1","CB2","CB3","CB4","getPointOnCubicBezierIterator","p1x","p1y","p2x","p2y","p3x","p3y","p4x","p4y","pct","c1","c2","c3","c4","QB1","QB2","QB3","getPointOnQuadraticBezierIterator","pathIterator","perc","tempP","tmpLen","getPathSegmentsInfo","tempInfo","totalLength","info","command","destX","destY","getPointOnPath","infos","distance","segInfo","segPercent","segment","lerp","parsePath","pathString","currentPath","parsed","match","coordsStr","re","rNumber","rNumberCommaWsp","rFlagCommaWsp","rArcSeq","regArcArgumentSequence","RegExp","coordsParsed","trim","args","isNaN","commandLength","repeatedCommand","k","klen","getBoundsOfArc","bound","segs","drawArc","unshift","beizers","beizer","bezierCurveTo","invoke","method","byProperty","find","value1","value2","condition","extend","Element","hasOwnProperty","clone","replace","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","chr","graphemes","getWholeChar","str","next","prev","emptyFunction","IS_DONTENUM_BUGGY","addMethods","parent","superclass","constructor","returnValue","valueOf","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","initialize","shift","subclasses","couldUseAttachEvent","attachEvent","touchEvents","getTouchInfo","event","touchProp","changedTouches","addListener","element","addEventListener","removeListener","removeEventListener","getPointer","scroll","getScrollLeftTop","_evt","clientX","clientY","isTouchEvent","pointerType","setStyle","styles","elementStyle","cssText","setOpacity","normalizedProperty","styleFloat","parseEl","supportsOpacity","opacity","supportsFilters","reOpacity","es","currentStyle","hasLayout","zoom","test","_slice","getById","id","getElementById","sliceCanConvertNodelists","getElementStyle","toArray","arrayLike","childNodes","err","makeElement","tagName","el","className","htmlFor","setAttribute","addClass","wrapElement","wrapper","replaceChild","docElement","documentElement","body","scrollLeft","scrollTop","host","nodeType","getElementOffset","docElem","scrollLeftTop","doc","ownerDocument","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","attr","parseInt","getBoundingClientRect","clientLeft","clientTop","getNodeCanvas","impl","_canvas","_image","cleanUpJsdomNode","_currentSrc","_attributes","_classList","setImageSmoothing","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","defaultView","getComputedStyle","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","addParamToUrl","param","emptyFn","request","onComplete","xhr","XMLHttpRequest","parameters","onreadystatechange","readyState","open","setRequestHeader","send","warn","noop","defaultEasing","d","animate","requestAnimFrame","timestamp","time","Date","duration","finish","onChange","abort","easing","startValue","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","valuePerc","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","_cancelAnimFrame","cancelAnimationFrame","clearTimeout","cancelAnimFrame","calculateColor","begin","pos","color","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","originalOnComplete","originalOnChange","posValue","colorEasing","normalize","asin","elastic","opts","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","svgValidTagNames","svgViewBoxElements","svgInvalidAncestors","svgValidParents","attributesMap","display","visibility","colorAttributes","stroke","fSize","cPath","normalizeAttr","normalizeValue","parentAttributes","parseTransformAttribute","visible","fillIndex","strokeIndex","getSvgRegex","_setStrokeFillOpacity","setAlpha","getAlpha","toRgba","_getMultipleNodes","nodeNames","nodeName","nodeList","nodeArray","getElementsByTagName","parseStyleString","oStyle","chunk","pair","parseStyleObject","getGlobalStylesForElement","svgUid","cssRules","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","doesSomeParentMatch","selector","matcher","classNames","getAttribute","elementById","node","nodelist","parseUseDirectives","attrs","xlink","substr","el2","cloneNode","currentTrans","oldLength","applyViewboxTransform","el3","createElementNS","setAttributeNS","nodeValue","firstChild","removeAttribute","svgValidTagNamesRegEx","svgViewBoxElementsRegEx","svgInvalidAncestorsRegEx","svgValidParentsRegEx","gradientDefs","clipPaths","rotateMatrix","multiplierX","multiplierY","skewMatrix","translateMatrix","transforms","transformList","reTransformList","reTransform","attributeValue","matrices","operation","combinedMatrix","reViewBoxAttrValue","viewBoxWidth","viewBoxHeight","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","hasAncestorWithNodeName","recursivelyParseGradientsXlink","gradient","gradientsAttrs","xlinkAttr","xLink","referencedGradient","hasAttribute","children","referenceClone","parseSVGDocument","parsingOptions","__uid","descendants","selectNodes","getGradientDefs","getCSSRules","parseElements","instances","reFontDeclaration","parseFontDeclaration","fontStyle","fontWeight","lineHeight","tagArray","elList","parseAttributes","parentFontSize","ownAttributes","cssAttrs","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","ElementsParser","parse","parsePointsAttribute","parsedPoints","allRules","styleContents","textContent","ruleObj","declaration","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","results","_options","allElements","loadSVGFromString","parser","parseFromString","regexUrl","proto","numElements","createObjects","createObject","findTag","fromElement","createCallback","checkIfDone","resolveGradient","Image","_originalElement","_removeTransformMatrix","resolveClipPath","extractPropertyDefinition","storage","regex","lastIndex","gradientDef","opacityAttr","createClipPathCallback","container","_newObj","fillRule","clipRule","usingElement","objTransformInv","gTransform","clipPath","calcTransformMatrix","clipPathTag","clipPathOwner","setPositionByOrigin","that","scalarAdd","scalar","scalarAddEquals","subtract","scalarSubtract","scalarSubtractEquals","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","distanceFrom","midPointFrom","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","alpha","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherAlpha","otherSource","reRGBa","reHSLa","reHex","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","oColor","scaleMap","skewMap","controls","LEFT","TOP","RIGHT","BOTTOM","CENTER","opposite","bottom","right","center","findCornerQuadrant","fabricObject","control","cornerAngle","fireEvent","canvasOptions","scaleIsProportional","eventData","uniScaleKey","uniformIsToggled","uniformScaling","isTransformCentered","originX","originY","scalingIsForbidden","by","scaleProportionally","lockX","lockScalingX","lockY","lockScalingY","scaleCursorStyleHandler","notAllowed","n","skewCursorStyleHandler","lockSkewingY","lockSkewingX","scaleSkewCursorStyleHandler","altActionKey","scaleOrSkewActionName","isAlternative","rotationStyleHandler","lockRotation","cursorStyle","commonEventInfo","e","pointer","wrapWithFixedAnchor","actionHandler","getCenterPoint","constraint","translateToOriginPoint","actionPerformed","getLocalPoint","corner","getZoom","padding","localPoint","toLocalPoint","offsetX","offsetY","targetHasOneFlip","compensateScaleForSkew","oppositeSkew","scaleToCompensate","axis","reference","newDim","_getTransformedDimensions","newValue","skewObjectX","newSkew","dimNoSkew","totalSkewSize","currentSkew","hasSkewed","dimBeforeSkewing","skewObjectY","skewHandlerX","localPointFromCenter","finalHandler","skewHandlerY","rotationWithSnapping","pivotPoint","lastAngle","ey","ex","curAngle","hasRotated","snapAngle","snapThreshold","rightAngleLocked","leftAngleLocked","scaleObject","newPoint","dim","signX","signY","forbidScaling","gestureScale","lockScalingFlip","hasScaled","original","originalDistance","oldScaleX","oldScaleY","scaleObjectFromCorner","scaleObjectX","scaleObjectY","scalingYOrSkewingX","scalingY","scalingXOrSkewingY","scalingX","changeWidth","hasResized","strokePadding","strokeWidth","strokeUniform","multiplier","oldWidth","newWidth","dragHandler","newLeft","newTop","moveX","moveY","scalingEqually","controlsUtils","renderCircleControl","styleOverride","cornerSize","transparentCorners","cornerStrokeColor","fillStyle","cornerColor","strokeStyle","lineWidth","beginPath","arc","renderSquareControl","sizeBy2","strokeCornerColor","strokeRect","Control","actionName","withConnection","mouseDownHandler","mouseUpHandler","getActionHandler","getMouseDownHandler","getMouseUpHandler","cursorStyleHandler","getActionName","getVisibility","controlKey","objectVisibility","_controlsVisibility","setVisibility","positionHandler","finalMatrix","render","cornerStyle","getColorStop","colorAlpha","keyValuePairs","getLinearCoords","getRadialCoords","__convertPercentUnitsToValues","instance","svgOptions","gradientUnits","propValue","finalValue","keys","gradientTransform","option","addColorStop","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","withViewport","additionalTransform","sort","pathOffset","reverse","minRadius","maxRadius","percentageShift","colorStop","toLive","createLinearGradient","createRadialGradient","colorStopEls","repeat","patternTransform","setOptions","isError","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","nonScaling","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","BLUR_BOX","StaticCanvas","CANVAS_INIT_ERROR","renderAndResetBound","renderAndReset","bind","requestRenderAllBound","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","viewportTransform","backgroundVpt","overlayVpt","enableRetinaScaling","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","scaleRatio","__initRetinaScaling","lowerCanvasEl","contextContainer","upperCanvasEl","contextTop","_offset","image","__setBgOverlayImage","__setBgOverlayColor","_createCanvasElement","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","hasLostContext","backstoreOnly","_setCssDimension","_isCurrentlyDrawing","freeDrawingBrush","_setBrushStyles","cacheCanvasEl","wrapperEl","setViewportTransform","vpt","activeObject","_activeObject","group","setCoords","calcViewportBoundaries","zoomToPoint","before","after","setZoom","absolutePan","relativePan","getElement","setupState","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","renderAll","canvasToDrawOn","renderCanvas","isRendering","iVpt","tl","br","tr","bl","cancelRequestedRender","_renderBackground","_renderObjects","drawControls","shouldCache","_transformDone","renderCache","forClipping","drawClipPathOnCanvas","_renderOverlay","globalCompositeOperation","zoomX","zoomY","_cacheCanvas","cacheTranslationX","cacheTranslationY","_renderBackgroundOrOverlay","needsVpt","lineTo","closePath","getCenter","centerObjectH","_centerObject","centerObjectV","centerObject","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","_toObject","__serializeBgOverlay","excludeFromExport","originalValue","bgImage","overlay","background","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","clipPathId","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","createSVGClipPathMarkup","toClipPathSVG","shouldTransform","row","rowIndex","_char","charIndex","fontList","_setSVGObject","finalWidth","finalHeight","shouldInvert","sendToBack","objs","activeSelection","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","isIntersecting","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","DataURLExporter","EMPTY_JSON","supports","setLineDash","toJSON","createPNGStream","createJPEGStream","BaseBrush","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeDashArray","lineCap","miterLimit","lineJoin","_saveAndTransform","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","needsFullRender","_resetShadow","PencilBrush","decimate","_points","_drawSegment","p1","p2","midPoint","quadraticCurveTo","onMouseDown","_isMainEvent","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","oldEnd","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","convertPointsToSVGPath","multSignX","multSignY","manyPoints","createPath","pathData","Path","decimatePoints","cDistance","adjustedDistance","lastPoint","newPoints","CircleBrush","drawDot","addPoint","dot","radius","originalRenderOnAddRemove","circles","circle","Circle","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","sprayChunkPoints","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","globalAlpha","fillRect","PatternBrush","getPatternSrc","dotDistance","patternCanvas","patternCtx","getPatternSrcFunction","getPattern","topLeft","_getLeftTopCoords","supportLineDash","STROKE_OFFSET","_initInteractive","_createCacheCanvas","centeredScaling","centeredRotation","centeredKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","selectionFullyContained","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","rotationCursor","notAllowedCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","stopContextMenu","fireRightClick","fireMiddleClick","targets","_hoveredTarget","_hoveredTargets","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","_chooseObjectsToRender","objsToRender","activeGroupObjects","activeObjects","getActiveObjects","contextTopDirty","renderTopLayer","_drawSelection","renderTop","_normalizePointer","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","normalizedPointer","targetRelativeX","targetRelativeY","_cacheContext","contextCache","originalColor","selectionBackgroundColor","_renderControls","hasBorders","_isSelectionKeyPressed","selectionKeyPressed","_shouldClearSelection","evented","selectable","_shouldCenterTransform","action","altKey","centerTransform","_getOriginFromCorner","_getActionFromCorner","alreadySelected","_setupCurrentTransform","__corner","lastX","lastY","shiftKey","_beforeTransform","setCursor","cursor","groupSelector","aleft","atop","_setLineDash","findTarget","skipGroup","activeTarget","activeTargetSubs","ignoreZoom","aObjects","isTouch","_searchPossibleTargets","_findTargetCorner","_checkTarget","globalPointer","containsPoint","isEditing","subTarget","objToCheck","pointerToUse","subTargetCheck","_absolutePointer","_pointer","cssScale","boundsWidth","boundsHeight","retinaScaling","lowerCanvasClass","_copyCanvasStyle","fromEl","toEl","getSelectionContext","getSelectionElement","getActiveObject","active","_discardActiveObject","_fireSelectionEvents","oldObjects","somethingChanged","added","removed","opt","oldObject","selected","deselected","updated","setActiveObject","currentActives","_setActiveObject","onSelect","onDeselect","discardActiveObject","removeListeners","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","layoutProps","originalValues","realizeTransform","clearContextTop","RIGHT_CLICK","MIDDLE_CLICK","LEFT_CLICK","addEventOptions","passive","checkClick","button","mainTouchId","_bindEvents","addOrRemove","_getEventPrefix","enablePointerEvents","functor","eventjsFunctor","canvasElement","eventTypePrefix","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","_onDoubleClick","_onDragOver","_onDragEnter","_onDragLeave","_onDrop","_onTouchStart","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","_onMouseUp","_onTouchEnd","eventsBound","_simpleEventHandler","self","__onTransformGesture","__onDrag","__onMouseWheel","_target","hiddenTextarea","focus","__onOrientationChange","__onShake","__onLongPress","preventDefault","_fireEnterLeaveEvents","stopPropagation","_cacheTransformEventData","_handleEvent","_resetTransformEventData","getPointerId","evt","identifier","pointerId","isPrimary","touches","__onMouseDown","__onMouseUp","_willAddMouseDown","__onMouseMove","_shouldRender","shouldRender","isClick","_onMouseUpInDrawingMode","_finalizeCurrentTransform","targetWasActive","_maybeGroupObjects","isMoving","_setCursorFromEvent","eventType","subTargets","absolutePointer","currentTarget","currentSubTargets","_scaling","hasStateChanged","_addEventOptions","_fire","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","_previousPointer","shouldGroup","_shouldGroup","_handleGrouping","saveState","_transformObject","_fireOverOutEvents","fireSyntheticInOutEvents","oldTarget","evtOut","canvasEvtOut","evtIn","canvasEvtIn","_draggedoverTarget","config","inOpt","outOpt","outFires","inFires","targetChanged","previousTarget","nextTarget","_performTransformAction","getCornerCursor","_updateActiveSelection","_createActiveSelection","currentActiveObjects","removeWithUpdate","addWithUpdate","_createGroup","isActiveLower","groupObjects","exitEditing","ActiveSelection","_groupSelectedObjects","aGroup","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","intersectsWithRect","isContainedWithinRect","toCanvasElement","cropping","scaledWidth","scaledHeight","originalWidth","originalHeight","newZoom","vp","originalInteractive","newVp","originalRetina","originalContextTop","loadFromJSON","json","serialized","JSON","_enlivenObjects","_setBgOverlay","enlivenedCanvasClip","__setupCanvas","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","toDataURLWithMultiplier","stringify","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","supportsLineDash","objectCaching","ALIASING_LIMIT","touchCornerSize","borderColor","borderDashArray","cornerDashArray","strokeDashOffset","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","lockMovementX","lockMovementY","statefullCache","noScaleCache","dirty","paintFirst","stateProperties","cacheProperties","colorProperties","inverted","absolutePositioned","_cacheProperties","_updateCacheCanvas","_limitCacheSize","dims","limitedDims","capped","_getCacheCanvasDimensions","objectScale","getTotalObjectScaling","neededX","neededY","drawingWidth","drawingHeight","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","sizeShrinking","setTransform","needFullTransform","_removeDefaultValues","getObjectScaling","retina","getObjectOpacity","shouldConstrainValue","isChanged","groupNeedsUpdate","_constrainScale","isOnACache","setOnGroup","getViewportTransform","isNotVisible","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","drawCacheOnCanvas","_removeCacheCanvas","drawObject","propertySet","isCacheDirty","hasStroke","hasFill","needsItsOwnCache","ownCaching","willDrawShadow","drawClipPathOnCache","originalFill","originalStroke","_setClippingProperties","_setStrokeStyles","_setFillStyles","_drawClipPath","skipCanvas","_getNonTransformedDimensions","_removeShadow","decl","lineDashOffset","dashArray","alternative","drawBorders","forActiveSelection","drawBordersInGroup","scaling","multX","multY","_applyPatternGradientTransform","_renderPaintInOrder","_renderStroke","_renderFill","_renderDashedStroke","_applyPatternForTransformedGradient","pCtx","pCanvas","_findCenterFromElement","_assignTransformMatrixProps","preserveAspectRatioOptions","cropX","cropY","offsetLeft","offsetTop","objectForm","_fromObject","cloneAsImage","utils","origParams","originalGroup","originalShadow","withoutTransform","withoutShadow","boundingRect","getBoundingRect","shadowOffset","originalCanvas","isType","shouldCenterOrigin","_setOriginToCenter","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","createAccessors","extraParam","enlivedProps","originXOffset","originYOffset","translateToGivenOrigin","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","to","offsetFrom","offsetTo","hypotFull","getScaledWidth","xFull","yFull","_originalOriginX","_originalOriginY","originPoint","arrayFromCoords","multiplyMatrices","oCoords","aCoords","lineCoords","ownMatrixCache","matrixCache","_getCoords","absolute","calculate","calcACoords","calcLineCoords","getCoords","pointTL","pointBR","intersection","other","otherCoords","lines","_getImageLines","_findCrossPoints","some","_containsCenterOfCanvas","isPartiallyOnScreen","allPointsAreOutside","every","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getScaledHeight","scaleToWidth","boundingRectFactor","scaleToHeight","calcCoords","calcOCoords","cosP","sinP","cosPSinP","cosPMinusSinP","_calcRotateMatrix","_calcTranslateMatrix","startMatrix","_calculateCurrentDimensions","forEachControl","w","skipCorners","_setCornerCoords","transformMatrixKey","sep","prefix","calcOwnMatrix","cache","tMatrix","_calcDimensionsTransformMatrix","flipping","noSkew","_finalizeDimensions","getSvgColorString","getSvgStyles","skipShadow","getSvgFilter","getSvgSpanStyles","useWhiteSpace","term","textDecoration","getSvgTextDecoration","deltaY","decoration","getSvgCommons","getSvgTransform","full","svgTransform","_setSVGBg","textBgRects","_getFillAttributes","_createBaseSVGMarkup","_toSVG","_createBaseClipPathSVGMarkup","objectMarkup","commonPieces","clipPathMarkup","noStyle","styleInfo","shadowInfo","withShadow","vectorEffect","absoluteClipPath","addPaintOrder","originalSet","saveProps","tmpObj","_isEqual","origValue","currentValue","firstPass","dashedPropertySet","forTouch","isControlVisible","touchCorner","fn","newTheta","cosTheta","sinTheta","cornerHypotenuse","touchHypotenuse","cosHalfOffset","sinHalfOffset","touchCosHalfOffset","touchSinHalfOffset","wh","shouldStroke","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","_animate","propPair","propIsColor","valueProgress","timeProgress","coordProps","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","_callback","pi","isValidRadius","startAngle","endAngle","setRadius","svgString","startX","startY","endX","endY","largeFlag","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","_initRxRy","isRounded","Polyline","_setPositionDimensions","correctLeftTop","calcDim","_calcDimensions","fromSVG","diffX","diffY","commonRender","fromElementGenerator","_class","Polygon","_toString","fromArray","_renderPathCommands","subpathStartX","subpathStartY","_getOffsetTransform","digits","aX","aY","deltaX","pathUrl","useSetOnGroup","isAlreadyGrouped","_updateObjectsACoords","_calcBounds","_updateObjectsCoords","skipControls","_updateObjectCoords","objectLeft","objectTop","_restoreObjectsState","_includeDefaultValues","objsToObject","originalDefaults","_obj","ownCache","_restoreObjectState","destroy","toActiveSelection","ungroupOnCanvas","setObjectsCoords","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","enlivedClipPath","toGroup","newGroup","childrenOverride","srcFromAttribute","_lastScaleX","_lastScaleY","_filterScalingX","_filterScalingY","minimumScaleTrigger","cacheKey","imageSmoothing","filters","_initElement","_element","setElement","removeTexture","_initConfig","applyFilters","resizeFilter","applyResizeFilters","backend","filterBackend","evictCachesForKey","getCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","hasCrop","strokeSvg","imageMarkup","imageRendering","getSvgSrc","origFill","filtered","setSrc","minimumScale","elementToFilter","_filteredEl","sourceWidth","sourceHeight","isNeutralState","imgElement","_needsResize","elementToDraw","elWidth","elHeight","sX","sY","sW","sH","maxDestW","maxDestH","_resetWidthHeight","CSS_CANVAS","_initFilters","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","testPrecision","precision","fragmentSource","fragmentShader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","setupGLContext","captureGPUInfo","isSupported","getParameter","MAX_TEXTURE_SIZE","precisions","webGlPrecision","createWebGLCanvas","aPosition","Float32Array","chooseFastestCopyGLTo2DMethod","canUseImageData","canMeasurePerf","performance","canUseArrayBuffer","ArrayBuffer","canUseUint8Clamped","copyGLTo2D","startTime","drawImageTime","putImageDataTime","testContext","now","glOptions","premultipliedAlpha","depth","stencil","antialias","clearColor","cachedTexture","getCachedTexture","sourceTexture","createTexture","targetTexture","originalTexture","passes","webgl","programCache","pass","tempFbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","applyTo","bindTexture","TEXTURE_2D","deleteTexture","deleteFramebuffer","clearWebGLCaches","textureCache","textureImageSource","texture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","uniqueId","gpuInfo","renderer","vendor","ext","getExtension","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","sourceElement","originalImageData","originalEl","BaseFilter","vertexSource","createProgram","vertexShader","VERTEX_SHADER","getShaderInfoLog","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","getAttributeLocations","uniformLocations","getUniformLocations","uStepW","getUniformLocation","uStepH","getAttribLocation","sendAttributeData","aPositionData","attributeLocation","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","bufferData","STATIC_DRAW","_setupFrameBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","_swapTextures","main","mainParameter","applyToWebGL","applyTo2d","retrieveShader","shader","useProgram","uniform1f","sendUniformData","viewport","drawArrays","TRIANGLE_STRIP","bindAdditionalTexture","textureUnit","activeTexture","TEXTURE0","unbindAdditionalTexture","getMainParameter","setMainParameter","createHelpLayer","helpLayer","mainP","ColorMatrix","colorsOnly","uColorMatrix","uConstants","constants","uniformMatrix4fv","uniform4fv","Brightness","brightness","uBrightness","Convolute","opaque","Convolute_3_1","Convolute_3_0","Convolute_5_1","Convolute_5_0","Convolute_7_1","Convolute_7_0","Convolute_9_1","Convolute_9_0","dstOff","scx","scy","srcOff","wt","weights","side","halfSide","sw","sh","createImageData","dst","alphaFac","uMatrix","uOpaque","uHalfSize","uSize","uniform1fv","Grayscale","lightness","luminosity","mode","uMode","uniform1i","Invert","invert","uInvert","Noise","noise","rand","uNoise","uSeed","Pixelate","blocksize","_i","_j","_iLen","_jLen","uBlocksize","RemoveColor","useAlpha","lowC","highC","uLow","uHigh","Brownie","Vintage","Kodachrome","Technicolor","Polaroid","Sepia","BlackWhite","BlendColor","screen","diff","lighten","darken","exclusion","tint","buildSource","tg","alpha1","uColor","BlendImage","mask","TEXTURE1","calculateMatrix","canvas1","blendData","blendImage","uTransformMatrix","uImage","uniformMatrix3fv","Resize","resizeType","lanczosLobes","uDelta","uTaps","uniform2fv","horizontal","taps","filterWindow","getFilterWindow","generateShader","tempScale","getTaps","lobeFunction","lanczosCreate","offsets","fragmentSourceTOP","dW","dH","lobes","xx","rcpScaleX","rcpScaleY","newData","oW","oH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","tmpCanvas","mult","doneW","doneH","stepW","stepH","dX","dY","process","u","weight","fX","fY","ratioX","icenter","ratioY","range2X","cacheLanc","range2Y","lanczos","rcpRatioX","rcpRatioY","srcData","destData","destImg","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","centerY","yy","centerX","w0","Contrast","contrast","contrastF","uContrast","Saturation","saturation","adjust","uSaturation","Blur","aspectRatio","simpleBlur","canvas2","blurLayer1","blurLayer2","percent","ctx1","ctx2","nSamples","newImageData","delta","chooseRightDelta","blurScale","Gamma","gamma","rInv","gInv","bInv","rVals","gVals","bVals","uGamma","uniform3fv","Composed","subFilters","HueRotation","rotation","rad","aThird","aThirdSqtSin","OneMinusCos","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","_reSpaceAndTab","_reWords","underline","overline","linethrough","textAlign","superscript","baseline","subscript","textBackgroundColor","_fontSizeFraction","_fontSizeMult","charSpacing","_measuringContext","_styleProperties","__charBounds","CACHE_FONT_SIZE","MIN_TEXT_WIDTH","text","__skipDimension","initDimensions","getMeasuringContext","_splitText","newLines","_splitTextIntoLines","textLines","_textLines","graphemeLines","_unwrappedTextLines","_unwrappedLines","_text","graphemeText","_clearCache","calcTextWidth","cursorWidth","enlargeSpaces","calcTextHeight","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","line","charBound","spaces","isEndOfWrapping","getLineWidth","kernedWidth","lineIndex","missingNewlineOffset","_setTextStyles","_renderTextLinesBackground","_renderTextDecoration","_renderText","_renderTextStroke","_renderTextFill","charStyle","forMeasuring","textBaseline","_getFontDeclaration","maxWidth","_renderTextLine","_renderChars","styleHas","heightOfLine","lineLeftOffset","lastColor","charBox","currentColor","lineTopOffset","leftOffset","_getLeftOffset","topOffset","_getTopOffset","boxStart","boxWidth","getHeightOfLine","_getLineLeftOffset","getValueOfPropertyAt","getFontCache","cacheProp","_applyCharStyles","styleDeclaration","_measureChar","previousChar","prevCharStyle","coupleWidth","previousWidth","fontCache","fontDeclaration","previousFontDeclaration","couple","stylesAreEqual","fontMultiplier","measureText","getHeightOfChar","measureLine","lineInfo","_measureLine","_getWidthOfCharSpacing","grapheme","prevGrapheme","graphemeInfo","numOfSpaces","lineBounds","_getGraphemeBox","skipLeft","getCompleteStyleDeclaration","prevStyle","previousBox","__lineHeights","maxHeight","_renderTextCommon","lineHeights","isEmptyStyles","actualStyle","nextStyle","timeToRender","isJustify","charsToRender","shortCut","_renderChar","_hasStyleChanged","_getStyleDeclaration","fullDecl","shouldFill","fillText","strokeText","setSuperscript","_setScript","setSubscript","schema","loc","get2DCursorLocation","setSelectionStyles","thisStyle","_hasStyleChangedForSvg","__lineWidths","_shouldClearDimensionCache","shouldClear","_forceClearCache","_size","_dy","lastDecoration","currentDecoration","currentFill","lastFill","styleObject","family","fontIsGeneric","genericFonts","newLine","newText","additionalProperties","needsDims","_key","parsedAnchor","textAnchor","originalStrokeWidth","textHeightScaleFactor","lineHeightDiff","scaledDiff","textHeight","offX","p3","0","cleanStyle","letterCount","stylePropertyValue","stylesCount","allStyleObjectPropertiesMatch","graphemeCount","stylePropertyHasBeenSet","removeStyle","lineNum","charNum","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","selectionStart","skipWrapping","getSelectionStyles","startIndex","endIndex","selectionEnd","getStyleAtPosition","lineStyle","_deleteStyleDeclaration","_deleteLineStyle","parseDecoration","IText","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","caching","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","inCompositionMode","initBehavior","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","initDelayedCursor","cursorOffsetCache","renderCursorOrSelection","skipRestore","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","_getCursorBoundariesOffsets","cursorPosition","cursorLocation","charHeight","__isMousedown","startLine","endLine","startChar","endChar","lineOffset","realLineHeight","boxEnd","compositionColor","getCurrentCharFontSize","cp","_getCurrentCharIndex","getCurrentCharColor","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","_currentTickCompleteState","restart","delay","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","searchWordBoundary","direction","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","fromStringToGraphemeSelection","smallerTextStart","graphemeStart","smallerTextEnd","graphemeEnd","fromGraphemeToStringSelection","newSelection","updateTextareaPosition","updateFromTextArea","_calcTextareaPosition","desiredPosition","compositionStart","upperCanvas","upperCanvasWidth","upperCanvasHeight","clientWidth","clientHeight","_savedProps","_restoreEditingProps","isTextChanged","_removeExtraneousStyles","removeStyleFromTo","styleObj","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","shiftLineStyles","numericChar","clonedStyles","numericLine","insertNewlineStyleObject","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","isEndOfLine","numIndex","styleCarriedOver","insertCharStyleObject","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertNewStyleBlock","insertedText","cursorLoc","addedLines","linesLength","setSelectionStartEndWithShift","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","doubleClickHandler","tripleClickHandler","_mouseDownHandler","setCursorByClick","_mouseDownHandlerBefore","currentActive","mouseOffset","prevWidth","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","onKeyDown","onKeyUp","onInput","copy","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","9","27","33","34","35","36","37","38","39","40","ctrlKeysMapUp","67","88","ctrlKeysMapDown","65","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","fromPaste","removedText","removeFrom","removeTo","nextText","charCount","nextCharCount","charDiff","textareaSelection","backDelete","copiedText","copiedTextStyle","compositionEnd","_getClipboardData","clipboardData","_getWidthBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","textAfterCursor","getUpCursorOffset","textBeforeCursor","charWidth","foundMatch","widthOfCharsOnLine","indexOnLine","leftEdge","rightEdge","offsetFromLeftEdge","offsetFromRightEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","moveCursorRight","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","removeChars","insertChars","multipleSpacesRegex","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","noShadow","textSpans","textTopOffset","textLeftOffset","_setSVGTextLineBg","_setSVGTextLineText","_createTextCharSpan","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","_pushTextBgRect","fillColor","_getSVGLineTopOffset","lastHeight","svgStyle","Textbox","minWidth","dynamicMinWidth","__cachedLines","_wordJoiners","splitByGrapheme","_styleMap","_generateStyleMap","textInfo","realLineCount","realLineCharCount","isWrapping","nextOffset","nextLineIndex","shouldLimit","mapNextLine","_wrapText","desiredWidth","wrapped","_wrapLine","_measureWord","word","charOffset","_line","reservedSpace","words","infix","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","getMinWidth","linesToKeep","scaleSkewStyleHandler","scaleStyleHandler","objectControls","ml","mr","mb","mtr","textBoxControls","mixins","functional","content","isGreater","staticClass","class","mounted","onObserve","destroyed","onVisible","dirtyTypes","directives","resize","ripple","inheritAttrs","appendOuterIcon","autofocus","clearable","clearIcon","counter","Boolean","counterValue","filled","flat","fullWidth","label","outlined","placeholder","prependInnerIcon","rounded","shaped","singleLine","solo","soloInverted","suffix","badInput","labelWidth","prefixWidth","prependWidth","initialValue","isBooted","isClearing","classes","VInput","computedCounterValue","hasCounter","hasDetails","isDirty","isEnclosed","isLabelActive","isSingle","isSolo","labelPosition","labelValue","$vuetify","rtl","showLabel","hasLabel","$attrs","clearableCallback","$refs","input","genAppendSlot","slot","$slots","genIcon","genSlot","genPrependInnerSlot","genIconSlot","genInputSlot","prepend","genClearIcon","genCounter","attrs$","$createElement","dark","light","genControl","genDefaultSlot","genFieldset","genLabel","focused","for","VLabel","genLegend","span","domProps","innerHTML","genInput","listeners","keydown","ref","modifiers","quiet","onResize","genMessages","messagesNode","counterNode","genTextFieldSlot","genAffix","onBlur","onFocus","$emit","setLabelWidth","scrollWidth","$el","setPrefixWidth","setPrependWidth","tryAutofocus","updateValue","read","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","Infinity","write","rt","LN2","toAbsoluteIndex","toInteger","toLength","arraySpeciesCreate","createProperty","arrayMethodHasSpeciesSupport","arrayMethodUsesToLength","HAS_SPECIES_SUPPORT","USES_TO_LENGTH","ACCESSORS","1","MAX_SAFE_INTEGER","MAXIMUM_ALLOWED_LENGTH_EXCEEDED","forced","deleteCount","insertCount","actualDeleteCount","A","O","actualStart","argumentsLength","base64","ieee754","typedArraySupport","__proto__","foo","subarray","kMaxLength","TYPED_ARRAY_SUPPORT","RangeError","arg","encodingOrOffset","allocUnsafe","fromArrayBuffer","fromString","assertSize","alloc","checked","isEncoding","actual","fromArrayLike","byteOffset","isBuffer","isnan","SlowBuffer","isView","loweredCase","utf8ToBytes","base64ToBytes","slowToString","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","bidirectionalIndexOf","dir","arrayIndexOf","lastIndexOf","indexSize","arrLength","valLength","buf","readUInt16BE","foundIndex","found","hexWrite","remaining","strLen","utf8Write","blitBuffer","asciiWrite","asciiToBytes","latin1Write","base64Write","ucs2Write","utf16leToBytes","res","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","decodeCodePointsArray","INSPECT_MAX_BYTES","poolSize","_augment","species","defineProperty","configurable","allocUnsafeSlow","_isBuffer","compare","list","swap16","swap32","swap64","equals","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","_arr","MAX_ARGUMENTS_LENGTH","codePoints","fromCharCode","ret","out","bytes","checkOffset","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","maxBytes","writeUIntBE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","INVALID_BASE64_RE","base64clean","stringtrim","units","leadSurrogate","byteArray","hi","lo","genChildren","tag","genMessage","message","setTextColor","themeClasses","appendIcon","dense","hideDetails","hint","loading","persistentHint","prependIcon","hasMouseDown","computedId","messagesToDisplay","hasHint","validation","validationResult","showDetails","beforeCreate","$options","model","genContent","extraData","icon","hasListener","listeners$","mergeData","click","mouseup","mousedown","role","scopedSlots","genPrependSlot","activeClass","chipGroup","close","closeIcon","draggable","filterIcon","link","pill","textColor","proxyClass","groupClasses","hasClose","isClickable","breakingProps","replacement","genFilter","genClose","tabindex","inserted","binding","unbind"],"mappings":"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","file":"js/chunk-b3cdbe64.c43be7b6.js","sourcesContent":["// `SameValue` abstract operation\n// https://tc39.github.io/ecma262/#sec-samevalue\nmodule.exports = Object.is || function is(x, y) {\n  // eslint-disable-next-line no-self-compare\n  return x === y ? x !== 0 || 1 / x === 1 / y : x != x && y != y;\n};\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","import arrayLikeToArray from \"@babel/runtime/helpers/esm/arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"@babel/runtime/helpers/esm/arrayWithoutHoles\";\nimport iterableToArray from \"@babel/runtime/helpers/esm/iterableToArray\";\nimport unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nimport nonIterableSpread from \"@babel/runtime/helpers/esm/nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","var $ = require('../internals/export');\nvar is = require('../internals/same-value');\n\n// `Object.is` method\n// https://tc39.github.io/ecma262/#sec-object.is\n$({ target: 'Object', stat: true }, {\n  is: is\n});\n","// Mixins\nimport Colorable from '../colorable'\nimport Themeable from '../themeable'\nimport { inject as RegistrableInject } from '../registrable'\n\n// Utilities\nimport { deepEqual } from '../../util/helpers'\nimport { consoleError } from '../../util/console'\nimport mixins from '../../util/mixins'\n\n// Types\nimport { PropValidator } from 'vue/types/options'\nimport { InputMessage, InputValidationRules } from 'vuetify/types'\n\nconst baseMixins = mixins(\n  Colorable,\n  RegistrableInject<'form', any>('form'),\n  Themeable,\n)\n\n/* @vue/component */\nexport default baseMixins.extend({\n  name: 'validatable',\n\n  props: {\n    disabled: Boolean,\n    error: Boolean,\n    errorCount: {\n      type: [Number, String],\n      default: 1,\n    },\n    errorMessages: {\n      type: [String, Array],\n      default: () => [],\n    } as PropValidator<InputMessage | null>,\n    messages: {\n      type: [String, Array],\n      default: () => [],\n    } as PropValidator<InputMessage | null>,\n    readonly: Boolean,\n    rules: {\n      type: Array,\n      default: () => [],\n    } as PropValidator<InputValidationRules>,\n    success: Boolean,\n    successMessages: {\n      type: [String, Array],\n      default: () => [],\n    } as PropValidator<InputMessage | null>,\n    validateOnBlur: Boolean,\n    value: { required: false },\n  },\n\n  data () {\n    return {\n      errorBucket: [] as string[],\n      hasColor: false,\n      hasFocused: false,\n      hasInput: false,\n      isFocused: false,\n      isResetting: false,\n      lazyValue: this.value,\n      valid: false,\n    }\n  },\n\n  computed: {\n    computedColor (): string | undefined {\n      if (this.isDisabled) return undefined\n      if (this.color) return this.color\n      // It's assumed that if the input is on a\n      // dark background, the user will want to\n      // have a white color. If the entire app\n      // is setup to be dark, then they will\n      // like want to use their primary color\n      if (this.isDark && !this.appIsDark) return 'white'\n      else return 'primary'\n    },\n    hasError (): boolean {\n      return (\n        this.internalErrorMessages.length > 0 ||\n        this.errorBucket.length > 0 ||\n        this.error\n      )\n    },\n    // TODO: Add logic that allows the user to enable based\n    // upon a good validation\n    hasSuccess (): boolean {\n      return (\n        this.internalSuccessMessages.length > 0 ||\n        this.success\n      )\n    },\n    externalError (): boolean {\n      return this.internalErrorMessages.length > 0 || this.error\n    },\n    hasMessages (): boolean {\n      return this.validationTarget.length > 0\n    },\n    hasState (): boolean {\n      if (this.isDisabled) return false\n\n      return (\n        this.hasSuccess ||\n        (this.shouldValidate && this.hasError)\n      )\n    },\n    internalErrorMessages (): InputValidationRules {\n      return this.genInternalMessages(this.errorMessages)\n    },\n    internalMessages (): InputValidationRules {\n      return this.genInternalMessages(this.messages)\n    },\n    internalSuccessMessages (): InputValidationRules {\n      return this.genInternalMessages(this.successMessages)\n    },\n    internalValue: {\n      get (): unknown {\n        return this.lazyValue\n      },\n      set (val: any) {\n        this.lazyValue = val\n\n        this.$emit('input', val)\n      },\n    },\n    isDisabled (): boolean {\n      return this.disabled || (\n        !!this.form &&\n        this.form.disabled\n      )\n    },\n    isInteractive (): boolean {\n      return !this.isDisabled && !this.isReadonly\n    },\n    isReadonly (): boolean {\n      return this.readonly || (\n        !!this.form &&\n        this.form.readonly\n      )\n    },\n    shouldValidate (): boolean {\n      if (this.externalError) return true\n      if (this.isResetting) return false\n\n      return this.validateOnBlur\n        ? this.hasFocused && !this.isFocused\n        : (this.hasInput || this.hasFocused)\n    },\n    validations (): InputValidationRules {\n      return this.validationTarget.slice(0, Number(this.errorCount))\n    },\n    validationState (): string | undefined {\n      if (this.isDisabled) return undefined\n      if (this.hasError && this.shouldValidate) return 'error'\n      if (this.hasSuccess) return 'success'\n      if (this.hasColor) return this.computedColor\n      return undefined\n    },\n    validationTarget (): InputValidationRules {\n      if (this.internalErrorMessages.length > 0) {\n        return this.internalErrorMessages\n      } else if (this.successMessages && this.successMessages.length > 0) {\n        return this.internalSuccessMessages\n      } else if (this.messages && this.messages.length > 0) {\n        return this.internalMessages\n      } else if (this.shouldValidate) {\n        return this.errorBucket\n      } else return []\n    },\n  },\n\n  watch: {\n    rules: {\n      handler (newVal, oldVal) {\n        if (deepEqual(newVal, oldVal)) return\n        this.validate()\n      },\n      deep: true,\n    },\n    internalValue () {\n      // If it's the first time we're setting input,\n      // mark it with hasInput\n      this.hasInput = true\n      this.validateOnBlur || this.$nextTick(this.validate)\n    },\n    isFocused (val) {\n      // Should not check validation\n      // if disabled\n      if (\n        !val &&\n        !this.isDisabled\n      ) {\n        this.hasFocused = true\n        this.validateOnBlur && this.$nextTick(this.validate)\n      }\n    },\n    isResetting () {\n      setTimeout(() => {\n        this.hasInput = false\n        this.hasFocused = false\n        this.isResetting = false\n        this.validate()\n      }, 0)\n    },\n    hasError (val) {\n      if (this.shouldValidate) {\n        this.$emit('update:error', val)\n      }\n    },\n    value (val) {\n      this.lazyValue = val\n    },\n  },\n\n  beforeMount () {\n    this.validate()\n  },\n\n  created () {\n    this.form && this.form.register(this)\n  },\n\n  beforeDestroy () {\n    this.form && this.form.unregister(this)\n  },\n\n  methods: {\n    genInternalMessages (messages: InputMessage | null): InputValidationRules {\n      if (!messages) return []\n      else if (Array.isArray(messages)) return messages\n      else return [messages]\n    },\n    /** @public */\n    reset () {\n      this.isResetting = true\n      this.internalValue = Array.isArray(this.internalValue)\n        ? []\n        : undefined\n    },\n    /** @public */\n    resetValidation () {\n      this.isResetting = true\n    },\n    /** @public */\n    validate (force = false, value?: any): boolean {\n      const errorBucket = []\n      value = value || this.internalValue\n\n      if (force) this.hasInput = this.hasFocused = true\n\n      for (let index = 0; index < this.rules.length; index++) {\n        const rule = this.rules[index]\n        const valid = typeof rule === 'function' ? rule(value) : rule\n\n        if (valid === false || typeof valid === 'string') {\n          errorBucket.push(valid || '')\n        } else if (typeof valid !== 'boolean') {\n          consoleError(`Rules should return a string or boolean, received '${typeof valid}' instead`, this)\n        }\n      }\n\n      this.errorBucket = errorBucket\n      this.valid = errorBucket.length === 0\n\n      return this.valid\n    },\n  },\n})\n","/* build: `node build.js modules=ALL exclude=gestures,accessors requirejs minifier=uglifyjs` */\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: '4.2.0' };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n/* _AMD_START_ */\nelse if (typeof define === 'function' && define.amd) {\n  define([], function() { return fabric; });\n}\n/* _AMD_END_ */\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  if (document instanceof (typeof HTMLDocument !== 'undefined' ? HTMLDocument : Document)) {\n    fabric.document = document;\n  }\n  else {\n    fabric.document = document.implementation.createHTMLDocument('');\n  }\n  fabric.window = window;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  var jsdom = require('jsdom');\n  var virtualWindow = new jsdom.JSDOM(\n    decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),\n    {\n      features: {\n        FetchExternalResources: ['img']\n      },\n      resources: 'usable'\n    }).window;\n  fabric.document = virtualWindow.document;\n  fabric.jsdomImplForWrapper = require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;\n  fabric.nodeCanvas = require('jsdom/lib/jsdom/utils').Canvas;\n  fabric.window = virtualWindow;\n  DOMParser = fabric.window.DOMParser;\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||\n  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0);\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  'display',\n  'transform',\n  'fill', 'fill-opacity', 'fill-rule',\n  'opacity',\n  'stroke', 'stroke-dasharray', 'stroke-linecap', 'stroke-dashoffset',\n  'stroke-linejoin', 'stroke-miterlimit',\n  'stroke-opacity', 'stroke-width',\n  'id', 'paint-order', 'vector-effect',\n  'instantiated_by_use', 'clip-path',\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)';\nfabric.commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)'\nfabric.rePathCommand = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/ig;\nfabric.reNonWord = /[ \\n\\.,;!\\?\\-]/;\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.svgNS = 'http://www.w3.org/2000/svg';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */\nfabric.textureSize = 2048;\n\n/**\n * When 'true', style information is not retained when copy/pasting text, making\n * pasted text use destination style.\n * Defaults to 'false'.\n * @type Boolean\n * @default\n */\nfabric.disableStyleCopyPaste = false;\n\n/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */\nfabric.enableGLFiltering = true;\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */\nfabric.browserShadowBlurConstant = 1;\n\n/**\n * This object contains the result of arc to beizer conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.arcToSegmentsCache = { };\n\n/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.boundsOfCurveCache = { };\n\n/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */\nfabric.cachesBoundsOfCurve = true;\n\n/**\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\n * @type Boolean\n * @default false\n */\nfabric.forceGLPutImageData = false;\n\nfabric.initFilterBackend = function() {\n  if (fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize)) {\n    console.log('max texture size: ' + fabric.maxTextureSize);\n    return (new fabric.WebglFilterBackend({ tileSize: fabric.textureSize }));\n  }\n  else if (fabric.Canvas2dFilterBackend) {\n    return (new fabric.Canvas2dFilterBackend());\n  }\n};\n\n\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\n\n\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function on(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function off(eventName, handler) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @memberOf fabric.Observable\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return this;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    fire: fire,\n    on: on,\n    off: off,\n  };\n})();\n\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this._objects;\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this._objects,\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects.concat();\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this._objects[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this._objects.length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this._objects.length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function(object) {\n    return this._objects.indexOf(object) > -1;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this._objects.reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      this._set(key, value);\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n\n\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      PiBy180 = Math.PI / 180,\n      PiBy2 = Math.PI / 2;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    cos: function(angle) {\n      if (angle === 0) { return 1; }\n      if (angle < 0) {\n        // cos(a) = cos(-a)\n        angle = -angle;\n      }\n      var angleSlice = angle / PiBy2;\n      switch (angleSlice) {\n        case 1: case 3: return 0;\n        case 2: return -1;\n      }\n      return Math.cos(angle);\n    },\n\n    /**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    sin: function(angle) {\n      if (angle === 0) { return 0; }\n      var angleSlice = angle / PiBy2, sign = 1;\n      if (angle < 0) {\n        // sin(-a) = -sin(a)\n        sign = -1;\n      }\n      switch (angleSlice) {\n        case 1: return sign;\n        case 2: return 0;\n        case 3: return -sign;\n      }\n      return Math.sin(angle);\n    },\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      point.subtractEquals(origin);\n      var v = fabric.util.rotateVector(point, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = fabric.util.sin(radians),\n          cos = fabric.util.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points, transform) {\n      if (transform) {\n        for (var i = 0; i < points.length; i++) {\n          points[i] = fabric.util.transformPoint(points[i], transform);\n        }\n      }\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = maxX - minX,\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */\n    getSvgAttributes: function(type) {\n      var attributes = [\n        'instantiated_by_use',\n        'style',\n        'id',\n        'class'\n      ];\n      switch (type) {\n        case 'linearGradient':\n          attributes = attributes.concat(['x1', 'y1', 'x2', 'y2', 'gradientUnits', 'gradientTransform']);\n          break;\n        case 'radialGradient':\n          attributes = attributes.concat(['gradientUnits', 'gradientTransform', 'cx', 'cy', 'r', 'fx', 'fy', 'fr']);\n          break;\n        case 'stop':\n          attributes = attributes.concat(['offset', 'stop-color', 'stop-opacity']);\n          break;\n      }\n      return attributes;\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      var onLoadCallback = function () {\n        callback && callback.call(context, img, false);\n        img = img.onload = img.onerror = null;\n      };\n\n      img.onload = onLoadCallback;\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      // crossOrigin null is the same as not set.\n      if (url.indexOf('data') !== 0 &&\n        crossOrigin !== undefined &&\n        crossOrigin !== null) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      // IE10 / IE11-Fix: SVG contents from data: URI\n      // will only be available if the IMG is present\n      // in the DOM (and visible)\n      if (url.substring(0,14) === 'data:image/svg') {\n        img.onload = null;\n        fabric.util.loadImageInDom(img, onLoadCallback);\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */\n    loadImageInDom: function(img, onLoadCallback) {\n      var div = fabric.document.createElement('div');\n      div.style.width = div.style.height = '1px';\n      div.style.left = div.style.top = '-100%';\n      div.style.position = 'absolute';\n      div.appendChild(img);\n      fabric.document.querySelector('body').appendChild(div);\n      /**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */\n      img.onload = function () {\n        onLoadCallback();\n        div.parentNode.removeChild(div);\n        div = null;\n      };\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length;\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects.filter(function(obj) {\n            // filter out undefined objects (objects that gave error)\n            return obj;\n          }));\n        }\n      }\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        });\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n      if (elements && elements.length === 1) {\n        return elements[0];\n      }\n      if (options) {\n        if (options.width && options.height) {\n          options.centerPoint = {\n            x: options.width / 2,\n            y: options.height / 2\n          };\n        }\n        else {\n          delete options.width;\n          delete options.height;\n        }\n      }\n      object = new fabric.Group(elements, options);\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Object.prototype.toString.call(properties) === '[object Array]') {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */\n    drawDashedLine: function(ctx, x, y, x2, y2, da) {\n      var dx = x2 - x,\n          dy = y2 - y,\n          len = sqrt(dx * dx + dy * dy),\n          rot = atan2(dy, dx),\n          dc = da.length,\n          di = 0,\n          draw = true;\n\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.moveTo(0, 0);\n      ctx.rotate(rot);\n\n      x = 0;\n      while (len > x) {\n        x += da[di++ % dc];\n        if (x > len) {\n          x = len;\n        }\n        ctx[draw ? 'lineTo' : 'moveTo'](x, 0);\n        draw = !draw;\n      }\n\n      ctx.restore();\n    },\n\n    /**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function() {\n      return fabric.document.createElement('canvas');\n    },\n\n    /**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @param {CanvasElement} canvas to copy size and content of\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    copyCanvasElement: function(canvas) {\n      var newCanvas = fabric.util.createCanvasElement();\n      newCanvas.width = canvas.width;\n      newCanvas.height = canvas.height;\n      newCanvas.getContext('2d').drawImage(canvas, 0, 0);\n      return newCanvas;\n    },\n\n    /**\n     * since 2.6.0 moved from canvas instance to utility.\n     * @param {CanvasElement} canvasEl to copy size and content of\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\n     * @param {Number} quality <= 1 and > 0\n     * @static\n     * @memberOf fabric.util\n     * @return {String} data url\n     */\n    toDataURL: function(canvasEl, format, quality) {\n      return canvasEl.toDataURL('image/' + format, quality);\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.document.createElement('img');\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x3 matrix into transform components\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a[1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle] angle in degrees\n     * @return {Number[]} transform matrix\n     */\n    calcRotateMatrix: function(options) {\n      if (!options.angle) {\n        return fabric.iMatrix.concat();\n      }\n      var theta = fabric.util.degreesToRadians(options.angle),\n          cos = fabric.util.cos(theta),\n          sin = fabric.util.sin(theta);\n      return [cos, sin, -sin, cos, 0, 0];\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet.\n     * is called DimensionsTransformMatrix because those properties are the one that influence\n     * the size of the resulting box of the object.\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @return {Number[]} transform matrix\n     */\n    calcDimensionsMatrix: function(options) {\n      var scaleX = typeof options.scaleX === 'undefined' ? 1 : options.scaleX,\n          scaleY = typeof options.scaleY === 'undefined' ? 1 : options.scaleY,\n          scaleMatrix = [\n            options.flipX ? -scaleX : scaleX,\n            0,\n            0,\n            options.flipY ? -scaleY : scaleY,\n            0,\n            0],\n          multiply = fabric.util.multiplyTransformMatrices,\n          degreesToRadians = fabric.util.degreesToRadians;\n      if (options.skewX) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, 0, Math.tan(degreesToRadians(options.skewX)), 1],\n          true);\n      }\n      if (options.skewY) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, Math.tan(degreesToRadians(options.skewY)), 0, 1],\n          true);\n      }\n      return scaleMatrix;\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle]\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.translateX]\n     * @param  {Number} [options.translateY]\n     * @return {Number[]} transform matrix\n     */\n    composeMatrix: function(options) {\n      var matrix = [1, 0, 0, 1, options.translateX || 0, options.translateY || 0],\n          multiply = fabric.util.multiplyTransformMatrices;\n      if (options.angle) {\n        matrix = multiply(matrix, fabric.util.calcRotateMatrix(options));\n      }\n      if (options.scaleX !== 1 || options.scaleY !== 1 ||\n          options.skewX || options.skewY || options.flipX || options.flipY) {\n        matrix = multiply(matrix, fabric.util.calcDimensionsMatrix(options));\n      }\n      return matrix;\n    },\n\n    /**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.rotate(0);\n    },\n\n    /**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */\n    saveObjectTransform: function (target) {\n      return {\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        angle: target.angle,\n        left: target.left,\n        flipX: target.flipX,\n        flipY: target.flipY,\n        top: target.top\n      };\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\n          l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      fontFamily = (fontFamily || '').toLowerCase();\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    },\n\n    /**\n     * Finds the scale for the object source to fit inside the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to fit into destination\n     */\n    findScaleToFit: function(source, destination) {\n      return Math.min(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * Finds the scale for the object source to cover entirely the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to cover destination\n     */\n    findScaleToCover: function(source, destination) {\n      return Math.max(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\n     * @memberOf fabric.util\n     * @param {Array} trasnform an array with 6 numbers\n     * @return {String} transform matrix for svg\n     * @return {Object.y} Limited dimensions by Y\n     */\n    matrixToSVG: function(transform) {\n      return 'matrix(' + transform.map(function(value) {\n        return fabric.util.toFixed(value, fabric.Object.NUM_FRACTION_DIGITS);\n      }).join(' ') + ')';\n    },\n\n    /**\n     * given a width and height, return the size of the bounding box\n     * that can contains the box with width/height with applied transform\n     * described in options.\n     * Use to calculate the boxes around objects for controls.\n     * @memberOf fabric.util\n     * @param {Number} width\n     * @param {Number} height\n     * @param {Object} options\n     * @param {Number} options.scaleX\n     * @param {Number} options.scaleY\n     * @param {Number} options.skewX\n     * @param {Number} options.skewY\n     * @return {Object.x} width of containing\n     * @return {Object.y} height of containing\n     */\n    sizeAfterTransform: function(width, height, options) {\n      var dimX = width / 2, dimY = height / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          transformMatrix = fabric.util.calcDimensionsMatrix(options),\n          bbox = fabric.util.makeBoundingBoxFromPoints(points, transformMatrix);\n      return {\n        x: bbox.width,\n        y: bbox.height,\n      };\n    }\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  var _join = Array.prototype.join,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var costh2 = fabric.util.cos(th2),\n        sinth2 = fabric.util.sin(th2),\n        costh3 = fabric.util.cos(th3),\n        sinth3 = fabric.util.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    return ['C',\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n  }\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = fabric.util.sin(th),\n        cosTh = fabric.util.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][5];\n      fromY = result[i][6];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    return result;\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of beizer\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  // TODO: can we normalize this with the starting points set at 0 and then translated the bbox?\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString;\n    if (fabric.cachesBoundsOfCurve) {\n      argsString = _join.call(arguments);\n      if (fabric.boundsOfCurveCache[argsString]) {\n        return fabric.boundsOfCurveCache[argsString];\n      }\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    if (fabric.cachesBoundsOfCurve) {\n      fabric.boundsOfCurveCache[argsString] = result;\n    }\n    return result;\n  }\n\n  /**\n   * Converts arc to a bunch of beizer curves\n   * @param {Number} fx starting point x\n   * @param {Number} fy starting point y\n   * @param {Array} coords Arc command\n   */\n  function fromArcToBeizers(fx, fy, coords) {\n    var rx = coords[1],\n        ry = coords[2],\n        rot = coords[3],\n        large = coords[4],\n        sweep = coords[5],\n        tx = coords[6],\n        ty = coords[7],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segsNorm[i][1] += fx;\n      segsNorm[i][2] += fy;\n      segsNorm[i][3] += fx;\n      segsNorm[i][4] += fy;\n      segsNorm[i][5] += fx;\n      segsNorm[i][6] += fy;\n    }\n    return segsNorm;\n  };\n\n\n  function makePathSimpler(path) {\n    // x and y represent the last point of the path. the previous command point.\n    // we add them to each relative command to make it an absolute comment.\n    // we also swap the v V h H with L, because are easier to transform.\n    var x = 0, y = 0, len = path.length,\n        // x1 and y1 represent the last point of the subpath. the subpath is started with\n        // m or M command. When a z or Z command is drawn, x and y need to be resetted to\n        // the last x1 and y1.\n        x1 = 0, y1 = 0, current, i, converted,\n        // previous will host the letter of the previous command, to handle S and T.\n        // controlX and controlY will host the previous reflected control point\n        destinationPath = [], previous, controlX, controlY;\n    for (i = 0; i < len; ++i) {\n      converted = false;\n      current = path[i].slice(0);\n      switch (current[0]) { // first letter\n        case 'l': // lineto, relative\n          current[0] = 'L';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'L':\n          x = current[1];\n          y = current[2];\n          break;\n        case 'h': // horizontal lineto, relative\n          current[1] += x;\n          // falls through\n        case 'H':\n          current[0] = 'L';\n          current[2] = y;\n          x = current[1];\n          break;\n        case 'v': // vertical lineto, relative\n          current[1] += y;\n          // falls through\n        case 'V':\n          current[0] = 'L';\n          y = current[1];\n          current[1] = x;\n          current[2] = y;\n          break;\n        case 'm': // moveTo, relative\n          current[0] = 'M';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'M':\n          x = current[1];\n          y = current[2];\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'c': // bezierCurveTo, relative\n          current[0] = 'C';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          current[5] += x;\n          current[6] += y;\n          // falls through\n        case 'C':\n          controlX = current[3];\n          controlY = current[4];\n          x = current[5];\n          y = current[6];\n          break;\n        case 's': // shorthand cubic bezierCurveTo, relative\n          current[0] = 'S';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'S':\n          // would be sScC but since we are swapping sSc for C, we check just that.\n          if (previous === 'C') {\n            // calculate reflection of previous control points\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a C, c, S, or s,\n            // the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          x = current[3];\n          y = current[4];\n          current[0] = 'C';\n          current[5] = current[3];\n          current[6] = current[4];\n          current[3] = current[1];\n          current[4] = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          // current[3] and current[4] are NOW the second control point.\n          // we keep it for the next reflection.\n          controlX = current[3];\n          controlY = current[4];\n          break;\n        case 'q': // quadraticCurveTo, relative\n          current[0] = 'Q';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'Q':\n          controlX = current[1];\n          controlY = current[2];\n          x = current[3];\n          y = current[4];\n          break;\n        case 't': // shorthand quadraticCurveTo, relative\n          current[0] = 'T';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'T':\n          if (previous === 'Q') {\n            // calculate reflection of previous control point\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          current[0] = 'Q';\n          x = current[1];\n          y = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          current[3] = x;\n          current[4] = y;\n          break;\n        case 'a':\n          current[0] = 'A';\n          current[6] += x;\n          current[7] += y;\n          // falls through\n        case 'A':\n          converted = true;\n          destinationPath = destinationPath.concat(fromArcToBeizers(x, y, current));\n          x = current[6];\n          y = current[7];\n          break;\n        case 'z':\n        case 'Z':\n          x = x1;\n          y = y1;\n          break;\n        default:\n      }\n      if (!converted) {\n        destinationPath.push(current);\n      }\n      previous = current[0];\n    }\n    return destinationPath;\n  };\n\n  /**\n   * Calc length from point x1,y1 to x2,y2\n   * @param {Number} x1 starting point x\n   * @param {Number} y1 starting point y\n   * @param {Number} x2 starting point x\n   * @param {Number} y2 starting point y\n   * @return {Number} length of segment\n   */\n  function calcLineLength(x1, y1, x2, y2) {\n    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  }\n\n  // functions for the Cubic beizer\n  // taken from: https://github.com/konvajs/konva/blob/7.0.5/src/shapes/Path.ts#L350\n  function CB1(t) {\n    return t * t * t;\n  }\n  function CB2(t) {\n    return 3 * t * t * (1 - t);\n  }\n  function CB3(t) {\n    return 3 * t * (1 - t) * (1 - t);\n  }\n  function CB4(t) {\n    return (1 - t) * (1 - t) * (1 - t);\n  }\n\n  function getPointOnCubicBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function(pct) {\n      var c1 = CB1(pct), c2 = CB2(pct), c3 = CB3(pct), c4 = CB4(pct);\n      return {\n        x: p4x * c1 + p3x * c2 + p2x * c3 + p1x * c4,\n        y: p4y * c1 + p3y * c2 + p2y * c3 + p1y * c4\n      };\n    };\n  }\n\n  function QB1(t) {\n    return t * t;\n  }\n\n  function QB2(t) {\n    return 2 * t * (1 - t);\n  }\n\n  function QB3(t) {\n    return (1 - t) * (1 - t);\n  }\n\n  function getPointOnQuadraticBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function(pct) {\n      var c1 = QB1(pct), c2 = QB2(pct), c3 = QB3(pct);\n      return {\n        x: p3x * c1 + p2x * c2 + p1x * c3,\n        y: p3y * c1 + p2y * c2 + p1y * c3\n      };\n    };\n  }\n\n  function pathIterator(iterator, x1, y1) {\n    var tempP = { x: x1, y: y1 }, p, tmpLen = 0, perc;\n    for (perc = 0.01; perc <= 1; perc += 0.01) {\n      p = iterator(perc);\n      tmpLen += calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      tempP = p;\n    }\n    return tmpLen;\n  }\n\n  //measures the length of a pre-simplified path\n  function getPathSegmentsInfo(path) {\n    var totalLength = 0, len = path.length, current,\n        //x2 and y2 are the coords of segment start\n        //x1 and y1 are the coords of the current point\n        x1 = 0, y1 = 0, x2 = 0, y2 = 0, info = [], iterator, tempInfo;\n    for (var i = 0; i < len; i++) {\n      current = path[i];\n      tempInfo = {\n        x: x1,\n        y: y1,\n        command: current[0],\n      };\n      switch (current[0]) { //first letter\n        case 'M':\n          tempInfo.length = 0;\n          x2 = x1 = current[1];\n          y2 = y1 = current[2];\n          break;\n        case 'L':\n          tempInfo.length = calcLineLength(x1, y1, current[1], current[2]);\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'C':\n          iterator = getPointOnCubicBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[5];\n          y1 = current[6];\n          break;\n        case 'Q':\n          iterator = getPointOnQuadraticBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[3];\n          y1 = current[4];\n          break;\n        case 'Z':\n        case 'z':\n          // we add those in order to ease calculations later\n          tempInfo.destX = x2;\n          tempInfo.destY = y2;\n          tempInfo.length = calcLineLength(x1, y1, x2, y2);\n          x1 = x2;\n          y1 = y2;\n          break;\n      }\n      totalLength += tempInfo.length;\n      info.push(tempInfo);\n    }\n    info.push({ length: totalLength, x: x1, y: y1 });\n    return info;\n  }\n\n  function getPointOnPath(path, perc, infos) {\n    if (!infos) {\n      infos = getPathSegmentsInfo(path);\n    }\n    var distance = infos[infos.length - 1] * perc, i = 0;\n    while ((distance - infos[i] > 0) && i < infos.length) {\n      distance -= infos[i];\n      i++;\n    }\n    var segInfo = infos[i], segPercent = distance / segInfo.length,\n        command = segInfo.length, segment = path[i];\n    switch (command) {\n      case 'Z':\n      case 'z':\n        return new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segInfo.destX, segInfo.destY),\n          segPercent\n        );\n        break;\n      case 'L':\n        return new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segment[1], segment[2]),\n          segPercent\n        );\n        break;\n      case 'C':\n        return getPointOnCubicBezierIterator(\n          segInfo.x,\n          segInfo.y,\n          segment[1],\n          segment[2],\n          segment[3],\n          segment[4],\n          segment[5],\n          segment[6]\n        )(segPercent);\n        break;\n      case 'Q':\n        return getPointOnQuadraticBezierIterator(\n          segInfo.x,\n          segInfo.y,\n          segment[1],\n          segment[2],\n          segment[3],\n          segment[4]\n        )(segPercent);\n        break;\n    }\n  }\n\n  function parsePath(pathString) {\n    var result = [],\n        coords = [],\n        currentPath,\n        parsed,\n        re = fabric.rePathCommand,\n        rNumber = '[-+]?(?:\\\\d*\\\\.\\\\d+|\\\\d+\\\\.?)(?:[eE][-+]?\\\\d+)?\\\\s*',\n        rNumberCommaWsp = '(' + rNumber + ')' + fabric.commaWsp,\n        rFlagCommaWsp = '([01])' + fabric.commaWsp + '?',\n        rArcSeq = rNumberCommaWsp + '?' + rNumberCommaWsp + '?' + rNumberCommaWsp + rFlagCommaWsp + rFlagCommaWsp +\n          rNumberCommaWsp + '?(' + rNumber + ')',\n        regArcArgumentSequence = new RegExp(rArcSeq, 'g'),\n        match,\n        coordsStr,\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        path;\n    if (!pathString || !pathString.match) {\n      return result;\n    }\n    path = pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n    for (var i = 0, coordsParsed, len = path.length; i < len; i++) {\n      currentPath = path[i];\n\n      coordsStr = currentPath.slice(1).trim();\n      coords.length = 0;\n\n      var command = currentPath.charAt(0);\n      coordsParsed = [command];\n\n      if (command.toLowerCase() === 'a') {\n        // arcs have special flags that apparently don't require spaces so handle special\n        for (var args; (args = regArcArgumentSequence.exec(coordsStr));) {\n          for (var j = 1; j < args.length; j++) {\n            coords.push(args[j]);\n          }\n        }\n      }\n      else {\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n      }\n\n      for (var j = 0, jlen = coords.length; j < jlen; j++) {\n        parsed = parseFloat(coords[j]);\n        if (!isNaN(parsed)) {\n          coordsParsed.push(parsed);\n        }\n      }\n\n      var commandLength = commandLengths[command.toLowerCase()],\n          repeatedCommand = repeatedCommands[command] || command;\n\n      if (coordsParsed.length - 1 > commandLength) {\n        for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n          result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n          command = repeatedCommand;\n        }\n      }\n      else {\n        result.push(coordsParsed);\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Calculate bounding box of a elliptic-arc\n   * @deprecated\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axis\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */\n  function getBoundsOfArc(fx, fy, rx, ry, rot, large, sweep, tx, ty) {\n\n    var fromX = 0, fromY = 0, bound, bounds = [],\n        segs = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segs.length; i < len; i++) {\n      bound = getBoundsOfCurve(fromX, fromY, segs[i][1], segs[i][2], segs[i][3], segs[i][4], segs[i][5], segs[i][6]);\n      bounds.push({ x: bound[0].x + fx, y: bound[0].y + fy });\n      bounds.push({ x: bound[1].x + fx, y: bound[1].y + fy });\n      fromX = segs[i][5];\n      fromY = segs[i][6];\n    }\n    return bounds;\n  };\n\n  /**\n   * Draws arc\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords coords of the arc, without the front 'A/a'\n   */\n  function drawArc(ctx, fx, fy, coords) {\n    coords = coords.slice(0).unshift('X'); // command A or a does not matter\n    var beizers = fromArcToBeizers(fx, fy, coords);\n    beizers.forEach(function(beizer) {\n      ctx.bezierCurveTo.apply(ctx, beizer.slice(1));\n    });\n  };\n\n  fabric.util.parsePath = parsePath;\n  fabric.util.makePathSimpler = makePathSimpler;\n  fabric.util.getPathSegmentsInfo = getPathSegmentsInfo;\n  fabric.util.fromArcToBeizers = fromArcToBeizers;\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n  fabric.util.getPointOnPath = getPointOnPath;\n  // kept because we do not want to make breaking changes.\n  // but useless and deprecated.\n  fabric.util.getBoundsOfArc = getBoundsOfArc;\n  fabric.util.drawArc = drawArc;\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n\n\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas and group properties in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (property === 'canvas' || property === 'group') {\n            // we do not want to clone this props at all.\n            // we want to keep the keys in the copy\n            destination[property] = null;\n          }\n          else if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * TODO: this function return an empty object if you try to clone null\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n})();\n\n\n(function() {\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&apos;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */\n  function graphemeSplit(textstring) {\n    var i = 0, chr, graphemes = [];\n    for (i = 0, chr; i < textstring.length; i++) {\n      if ((chr = getWholeChar(textstring, i)) === false) {\n        continue;\n      }\n      graphemes.push(chr);\n    }\n    return graphemes;\n  }\n\n  // taken from mdn in the charAt doc page.\n  function getWholeChar(str, i) {\n    var code = str.charCodeAt(i);\n\n    if (isNaN(code)) {\n      return ''; // Position not found\n    }\n    if (code < 0xD800 || code > 0xDFFF) {\n      return str.charAt(i);\n    }\n\n    // High surrogate (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 <= code && code <= 0xDBFF) {\n      if (str.length <= (i + 1)) {\n        throw 'High surrogate without following low surrogate';\n      }\n      var next = str.charCodeAt(i + 1);\n      if (0xDC00 > next || next > 0xDFFF) {\n        throw 'High surrogate without following low surrogate';\n      }\n      return str.charAt(i) + str.charAt(i + 1);\n    }\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\n    if (i === 0) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n\n    // (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 > prev || prev > 0xDBFF) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    // We can pass over low surrogates now as the second component\n    // in a pair which we have already processed\n    return false;\n  }\n\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml,\n    graphemeSplit: graphemeSplit\n  };\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n\n(function () {\n  // since ie11 can use addEventListener but they do not support options, i need to check\n  var couldUseAttachEvent = !!fabric.document.createElement('div').attachEvent,\n      touchEvents = ['touchstart', 'touchmove', 'touchend'];\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = function(element, eventName, handler, options) {\n    element && element.addEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = function(element, eventName, handler, options) {\n    element && element.removeEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  function getTouchInfo(event) {\n    var touchProp = event.changedTouches;\n    if (touchProp && touchProp[0]) {\n      return touchProp[0];\n    }\n    return event;\n  }\n\n  fabric.util.getPointer = function(event) {\n    var element = event.target,\n        scroll = fabric.util.getScrollLeftTop(element),\n        _evt = getTouchInfo(event);\n    return {\n      x: _evt.clientX + scroll.left,\n      y: _evt.clientY + scroll.top\n    };\n  };\n\n  fabric.util.isTouchEvent = function(event) {\n    return touchEvents.indexOf(event.type) > -1 || event.pointerType === 'touch';\n  };\n})();\n\n\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n\n\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 && element.style.position === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  function getNodeCanvas(element) {\n    var impl = fabric.jsdomImplForWrapper(element);\n    return impl._canvas || impl._image;\n  };\n\n  function cleanUpJsdomNode(element) {\n    if (!fabric.isLikelyNode) {\n      return;\n    }\n    var impl = fabric.jsdomImplForWrapper(element);\n    if (impl) {\n      impl._image = null;\n      impl._canvas = null;\n      // unsure if necessary\n      impl._currentSrc = null;\n      impl._attributes = null;\n      impl._classList = null;\n    }\n  }\n\n  function setImageSmoothing(ctx, value) {\n    ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n      || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n    ctx.imageSmoothingEnabled = value;\n  }\n\n  /**\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\n   * Used by canvas and by ImageObject.\n   * @memberOf fabric.util\n   * @since 4.0.0\n   * @param {HTMLRenderingContext2D} ctx to set on\n   * @param {Boolean} value true or false\n   */\n  fabric.util.setImageSmoothing = setImageSmoothing;\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.addClass = addClass;\n  fabric.util.makeElement = makeElement;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getNodeCanvas = getNodeCanvas;\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\n\n})();\n\n\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = new fabric.window.XMLHttpRequest(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = console.log;\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = console.warn;\n\n\n(function() {\n\n  function noop() {\n    return false;\n  }\n\n  function defaultEasing(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */\n  function animate(options) {\n\n    requestAnimFrame(function(timestamp) {\n      options || (options = { });\n\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || defaultEasing,\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || endValue - startValue;\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        // TODO: move abort call after calculation\n        // and pass (current,valuePerc, timePerc) as arguments\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = easing(currentTime, startValue, byValue, duration),\n            valuePerc = Math.abs((current - startValue) / byValue);\n        if (abort()) {\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        if (time > finish) {\n          onChange(endValue, 1, 1);\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        else {\n          onChange(current, valuePerc, timePerc);\n          requestAnimFrame(tick);\n        }\n      })(start);\n    });\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            return fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  var _cancelAnimFrame = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  function cancelAnimFrame() {\n    return _cancelAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\n})();\n\n\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource(),\n        originalOnComplete = options.onComplete,\n        originalOnChange = options.onChange;\n    options = options || {};\n\n    fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n          ? options.colorEasing(currentTime, duration)\n          : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      },\n      // has to take in account for color restoring;\n      onComplete: function(current, valuePerc, timePerc) {\n        if (originalOnComplete) {\n          return originalOnComplete(\n            calculateColor(endColor, endColor, 0),\n            valuePerc,\n            timePerc\n          );\n        }\n      },\n      onChange: function(current, valuePerc, timePerc) {\n        if (originalOnChange) {\n          if (Array.isArray(current)) {\n            return originalOnChange(\n              calculateColor(current, current, 0),\n              valuePerc,\n              timePerc\n            );\n          }\n          originalOnChange(current, valuePerc, timePerc);\n        }\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n\n\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      svgValidTagNames = ['path', 'circle', 'polygon', 'polyline', 'ellipse', 'rect', 'line',\n        'image', 'text'],\n      svgViewBoxElements = ['symbol', 'image', 'marker', 'pattern', 'view', 'svg'],\n      svgInvalidAncestors = ['pattern', 'defs', 'symbol', 'metadata', 'clipPath', 'mask', 'desc'],\n      svgValidParents = ['symbol', 'g', 'a', 'svg', 'clipPath', 'defs'],\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'letter-spacing':     'charSpacing',\n        'paint-order':        'paintFirst',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-dashoffset':  'strokeDashOffset',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'textAnchor',\n        opacity:              'opacity',\n        'clip-path':          'clipPath',\n        'clip-rule':          'clipRule',\n        'vector-effect':      'strokeUniform',\n        'image-rendering':    'imageSmoothing',\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      },\n\n      fSize = 'font-size', cPath = 'clip-path';\n\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n  fabric.clipPaths = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Object.prototype.toString.call(value) === '[object Array]',\n        parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeUniform') {\n      return (value === 'non-scaling-stroke');\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(parseFloat);\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = value !== 'none' && value !== 'hidden';\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'textAnchor' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else if (attr === 'charSpacing') {\n      // parseUnit returns px and we convert it to em\n      parsed = parseUnit(value, fontSize) / fontSize * 1000;\n    }\n    else if (attr === 'paintFirst') {\n      var fillIndex = value.indexOf('fill');\n      var strokeIndex = value.indexOf('stroke');\n      var value = 'fill';\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\n        value = 'stroke';\n      }\n      else if (fillIndex === -1 && strokeIndex > -1) {\n        value = 'stroke';\n      }\n    }\n    else if (attr === 'href' || attr === 'xlink:href' || attr === 'font') {\n      return value;\n    }\n    else if (attr === 'imageSmoothing') {\n      return (value === 'optimizeQuality' ? true : false);\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n    * @private\n    */\n  function getSvgRegex(arr) {\n    return new RegExp('^(' + arr.join('|') + ')\\\\b', 'i');\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList, i, len;\n    for (i = 0, len = nodeNames.length; i < len; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = fabric.util.cos(args[0]), sin = fabric.util.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = fabric.iMatrix,\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = fabric.commaWsp,\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher, i;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, len, nodelist = doc.getElementsByTagName('*');\n    for (i = 0, len = nodelist.length; i < len; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlink = (el.getAttribute('xlink:href') || el.getAttribute('href')).substr(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode, oldLength = nodelist.length, attr, j, attrs, len, namespace = fabric.svgNS;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElementNS(namespace, 'g');\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\n          attr = attrs.item(j);\n          el3.setAttributeNS(namespace, attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' ||\n          attr.nodeName === 'xlink:href' || attr.nodeName === 'href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n    if (!fabric.svgViewBoxElementsRegEx.test(element.nodeName)) {\n      return;\n    }\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '', widthDiff = 0, heightDiff = 0;\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (missingViewBox) {\n      if (((x || y) && element.parentNode.nodeName !== '#document')) {\n        translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n        matrix = (element.getAttribute('transform') || '') + translateMatrix;\n        element.setAttribute('transform', matrix);\n        element.removeAttribute('x');\n        element.removeAttribute('y');\n      }\n    }\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      // set a transform for elements that have x y and are inner(only) SVGs\n      return parsedDim;\n    }\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n    parsedDim.minX = minX;\n    parsedDim.minY = minY;\n    parsedDim.viewBoxWidth = viewBoxWidth;\n    parsedDim.viewBoxHeight = viewBoxHeight;\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      if (preserveAspectRatio.meetOrSlice === 'meet') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n        // calculate additional translation to move the viewbox\n      }\n      if (preserveAspectRatio.meetOrSlice === 'slice') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleX : scaleY);\n        // calculate additional translation to move the viewbox\n      }\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\n      if (preserveAspectRatio.alignX === 'Mid') {\n        widthDiff /= 2;\n      }\n      if (preserveAspectRatio.alignY === 'Mid') {\n        heightDiff /= 2;\n      }\n      if (preserveAspectRatio.alignX === 'Min') {\n        widthDiff = 0;\n      }\n      if (preserveAspectRatio.alignY === 'Min') {\n        heightDiff = 0;\n      }\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n    if ((x || y) && element.parentNode.nodeName !== '#document') {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX + widthDiff) + ' ' +\n                  (minY * scaleY + heightDiff) + ') ';\n    // seems unused.\n    // parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElementNS(fabric.svgNS, 'g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      el.removeAttribute('x');\n      el.removeAttribute('y');\n      matrix = el.getAttribute('transform') + matrix;\n    }\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++, i, len,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n    var clipPaths = { };\n    descendants.filter(function(el) {\n      return el.nodeName.replace('svg:', '') === 'clipPath';\n    }).forEach(function(el) {\n      var id = el.getAttribute('id');\n      clipPaths[id] = fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el) {\n        return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', ''));\n      });\n    });\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    fabric.clipPaths[svgUid] = clipPaths;\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances, elements) {\n      if (callback) {\n        callback(instances, options, elements, descendants);\n        delete fabric.gradientDefs[svgUid];\n        delete fabric.cssRules[svgUid];\n        delete fabric.clipPaths[svgUid];\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  function recursivelyParseGradientsXlink(doc, gradient) {\n    var gradientsAttrs = ['gradientTransform', 'x1', 'x2', 'y1', 'y2', 'gradientUnits', 'cx', 'cy', 'r', 'fx', 'fy'],\n        xlinkAttr = 'xlink:href',\n        xLink = gradient.getAttribute(xlinkAttr).substr(1),\n        referencedGradient = elementById(doc, xLink);\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\n      recursivelyParseGradientsXlink(doc, referencedGradient);\n    }\n    gradientsAttrs.forEach(function(attr) {\n      if (referencedGradient && !gradient.hasAttribute(attr) && referencedGradient.hasAttribute(attr)) {\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\n      }\n    });\n    if (!gradient.children.length) {\n      var referenceClone = referencedGradient.cloneNode(true);\n      while (referenceClone.firstChild) {\n        gradient.appendChild(referenceClone.firstChild);\n      }\n    }\n    gradient.removeAttribute(xlinkAttr);\n  }\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, gradientDefs = { };\n      j = elList.length;\n      while (j--) {\n        el = elList[j];\n        if (el.getAttribute('xlink:href')) {\n          recursivelyParseGradientsXlink(doc, el);\n        }\n        gradientDefs[el.getAttribute('id')] = el;\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize, parentFontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      var cssAttrs = extend(\n        getGlobalStylesForElement(element, svgUid),\n        fabric.parseStyleAttribute(element)\n      );\n      ownAttributes = extend(\n        ownAttributes,\n        cssAttrs\n      );\n      if (cssAttrs[cPath]) {\n        element.setAttribute(cPath, cssAttrs[cPath]);\n      }\n      fontSize = parentFontSize = parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      if (ownAttributes[fSize]) {\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\n        ownAttributes[fSize] = fontSize = parseUnit(ownAttributes[fSize], parentFontSize);\n      }\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return fabric.svgValidParentsRegEx.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      for (i = 0, len = points.length; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'), i, len,\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (i = 0, len = styles.length; i < len; i++) {\n        // <style/> could produce `undefined`, covering this case with ''\n        var styleContents = styles[i].textContent || '';\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = rules.map(function(rule) { return rule.trim(); });\n        // eslint-disable-next-line no-loop-func\n        rules.forEach(function(rule) {\n\n          var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n              ruleObj = { }, declaration = match[2].trim(),\n              propertyValuePairs = declaration.replace(/;$/, '').split(/\\s*;\\s*/);\n\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n                property = pair[0],\n                value = pair[1];\n            ruleObj[property] = value;\n          }\n          rule = match[1];\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n          return false;\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options, elements, allElements) {\n          callback && callback(results, _options, elements, allElements);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      var parser = new fabric.window.DOMParser(),\n          doc = parser.parseFromString(string.trim(), 'text/xml');\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options, elements, allElements) {\n        callback(results, _options, elements, allElements);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions, doc) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\n  this.doc = doc;\n};\n\n(function(proto) {\n  proto.parse = function() {\n    this.instances = new Array(this.elements.length);\n    this.numElements = this.elements.length;\n    this.createObjects();\n  };\n\n  proto.createObjects = function() {\n    var _this = this;\n    this.elements.forEach(function(element, i) {\n      element.setAttribute('svgUid', _this.svgUid);\n      _this.createObject(element, i);\n    });\n  };\n\n  proto.findTag = function(el) {\n    return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  };\n\n  proto.createObject = function(el, index) {\n    var klass = this.findTag(el);\n    if (klass && klass.fromElement) {\n      try {\n        klass.fromElement(el, this.createCallback(index, el), this.options);\n      }\n      catch (err) {\n        fabric.log(err);\n      }\n    }\n    else {\n      this.checkIfDone();\n    }\n  };\n\n  proto.createCallback = function(index, el) {\n    var _this = this;\n    return function(obj) {\n      var _options;\n      _this.resolveGradient(obj, el, 'fill');\n      _this.resolveGradient(obj, el, 'stroke');\n      if (obj instanceof fabric.Image && obj._originalElement) {\n        _options = obj.parsePreserveAspectRatioAttribute(el);\n      }\n      obj._removeTransformMatrix(_options);\n      _this.resolveClipPath(obj, el);\n      _this.reviver && _this.reviver(el, obj);\n      _this.instances[index] = obj;\n      _this.checkIfDone();\n    };\n  };\n\n  proto.extractPropertyDefinition = function(obj, property, storage) {\n    var value = obj[property], regex = this.regexUrl;\n    if (!regex.test(value)) {\n      return;\n    }\n    regex.lastIndex = 0;\n    var id = regex.exec(value)[1];\n    regex.lastIndex = 0;\n    return fabric[storage][this.svgUid][id];\n  };\n\n  proto.resolveGradient = function(obj, el, property) {\n    var gradientDef = this.extractPropertyDefinition(obj, property, 'gradientDefs');\n    if (gradientDef) {\n      var opacityAttr = el.getAttribute(property + '-opacity');\n      var gradient = fabric.Gradient.fromElement(gradientDef, obj, opacityAttr, this.options);\n      obj.set(property, gradient);\n    }\n  };\n\n  proto.createClipPathCallback = function(obj, container) {\n    return function(_newObj) {\n      _newObj._removeTransformMatrix();\n      _newObj.fillRule = _newObj.clipRule;\n      container.push(_newObj);\n    };\n  };\n\n  proto.resolveClipPath = function(obj, usingElement) {\n    var clipPath = this.extractPropertyDefinition(obj, 'clipPath', 'clipPaths'),\n        element, klass, objTransformInv, container, gTransform, options;\n    if (clipPath) {\n      container = [];\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\n      // move the clipPath tag as sibling to the real element that is using it\n      var clipPathTag = clipPath[0].parentNode;\n      var clipPathOwner = usingElement;\n      while (clipPathOwner.parentNode && clipPathOwner.getAttribute('clip-path') !== obj.clipPath) {\n        clipPathOwner = clipPathOwner.parentNode;\n      }\n      clipPathOwner.parentNode.appendChild(clipPathTag);\n      for (var i = 0; i < clipPath.length; i++) {\n        element = clipPath[i];\n        klass = this.findTag(element);\n        klass.fromElement(\n          element,\n          this.createClipPathCallback(obj, container),\n          this.options\n        );\n      }\n      if (container.length === 1) {\n        clipPath = container[0];\n      }\n      else {\n        clipPath = new fabric.Group(container);\n      }\n      gTransform = fabric.util.multiplyTransformMatrices(\n        objTransformInv,\n        clipPath.calcTransformMatrix()\n      );\n      if (clipPath.clipPath) {\n        this.resolveClipPath(clipPath, clipPathOwner);\n      }\n      var options = fabric.util.qrDecompose(gTransform);\n      clipPath.flipX = false;\n      clipPath.flipY = false;\n      clipPath.set('scaleX', options.scaleX);\n      clipPath.set('scaleY', options.scaleY);\n      clipPath.angle = options.angle;\n      clipPath.skewX = options.skewX;\n      clipPath.skewY = 0;\n      clipPath.setPositionByOrigin({ x: options.translateX, y: options.translateY }, 'center', 'center');\n      obj.clipPath = clipPath;\n    }\n    else {\n      // if clip-path does not resolve to any element, delete the property.\n      delete obj.clipPath;\n    }\n  };\n\n  proto.checkIfDone = function() {\n    if (--this.numElements === 0) {\n      this.instances = this.instances.filter(function(el) {\n        // eslint-disable-next-line no-eq-null, eqeqeq\n        return el != null;\n      });\n      this.callback(this.instances, this.elements);\n    }\n  };\n})(fabric.ElementsParser.prototype);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter, i;\n\n    for (i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length, i;\n\n    for (i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = Math.round(source[3] * 255);\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource(), i;\n\n      for (i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */\n  fabric.Color.colorNameMap = {\n    aliceblue:            '#F0F8FF',\n    antiquewhite:         '#FAEBD7',\n    aqua:                 '#00FFFF',\n    aquamarine:           '#7FFFD4',\n    azure:                '#F0FFFF',\n    beige:                '#F5F5DC',\n    bisque:               '#FFE4C4',\n    black:                '#000000',\n    blanchedalmond:       '#FFEBCD',\n    blue:                 '#0000FF',\n    blueviolet:           '#8A2BE2',\n    brown:                '#A52A2A',\n    burlywood:            '#DEB887',\n    cadetblue:            '#5F9EA0',\n    chartreuse:           '#7FFF00',\n    chocolate:            '#D2691E',\n    coral:                '#FF7F50',\n    cornflowerblue:       '#6495ED',\n    cornsilk:             '#FFF8DC',\n    crimson:              '#DC143C',\n    cyan:                 '#00FFFF',\n    darkblue:             '#00008B',\n    darkcyan:             '#008B8B',\n    darkgoldenrod:        '#B8860B',\n    darkgray:             '#A9A9A9',\n    darkgrey:             '#A9A9A9',\n    darkgreen:            '#006400',\n    darkkhaki:            '#BDB76B',\n    darkmagenta:          '#8B008B',\n    darkolivegreen:       '#556B2F',\n    darkorange:           '#FF8C00',\n    darkorchid:           '#9932CC',\n    darkred:              '#8B0000',\n    darksalmon:           '#E9967A',\n    darkseagreen:         '#8FBC8F',\n    darkslateblue:        '#483D8B',\n    darkslategray:        '#2F4F4F',\n    darkslategrey:        '#2F4F4F',\n    darkturquoise:        '#00CED1',\n    darkviolet:           '#9400D3',\n    deeppink:             '#FF1493',\n    deepskyblue:          '#00BFFF',\n    dimgray:              '#696969',\n    dimgrey:              '#696969',\n    dodgerblue:           '#1E90FF',\n    firebrick:            '#B22222',\n    floralwhite:          '#FFFAF0',\n    forestgreen:          '#228B22',\n    fuchsia:              '#FF00FF',\n    gainsboro:            '#DCDCDC',\n    ghostwhite:           '#F8F8FF',\n    gold:                 '#FFD700',\n    goldenrod:            '#DAA520',\n    gray:                 '#808080',\n    grey:                 '#808080',\n    green:                '#008000',\n    greenyellow:          '#ADFF2F',\n    honeydew:             '#F0FFF0',\n    hotpink:              '#FF69B4',\n    indianred:            '#CD5C5C',\n    indigo:               '#4B0082',\n    ivory:                '#FFFFF0',\n    khaki:                '#F0E68C',\n    lavender:             '#E6E6FA',\n    lavenderblush:        '#FFF0F5',\n    lawngreen:            '#7CFC00',\n    lemonchiffon:         '#FFFACD',\n    lightblue:            '#ADD8E6',\n    lightcoral:           '#F08080',\n    lightcyan:            '#E0FFFF',\n    lightgoldenrodyellow: '#FAFAD2',\n    lightgray:            '#D3D3D3',\n    lightgrey:            '#D3D3D3',\n    lightgreen:           '#90EE90',\n    lightpink:            '#FFB6C1',\n    lightsalmon:          '#FFA07A',\n    lightseagreen:        '#20B2AA',\n    lightskyblue:         '#87CEFA',\n    lightslategray:       '#778899',\n    lightslategrey:       '#778899',\n    lightsteelblue:       '#B0C4DE',\n    lightyellow:          '#FFFFE0',\n    lime:                 '#00FF00',\n    limegreen:            '#32CD32',\n    linen:                '#FAF0E6',\n    magenta:              '#FF00FF',\n    maroon:               '#800000',\n    mediumaquamarine:     '#66CDAA',\n    mediumblue:           '#0000CD',\n    mediumorchid:         '#BA55D3',\n    mediumpurple:         '#9370DB',\n    mediumseagreen:       '#3CB371',\n    mediumslateblue:      '#7B68EE',\n    mediumspringgreen:    '#00FA9A',\n    mediumturquoise:      '#48D1CC',\n    mediumvioletred:      '#C71585',\n    midnightblue:         '#191970',\n    mintcream:            '#F5FFFA',\n    mistyrose:            '#FFE4E1',\n    moccasin:             '#FFE4B5',\n    navajowhite:          '#FFDEAD',\n    navy:                 '#000080',\n    oldlace:              '#FDF5E6',\n    olive:                '#808000',\n    olivedrab:            '#6B8E23',\n    orange:               '#FFA500',\n    orangered:            '#FF4500',\n    orchid:               '#DA70D6',\n    palegoldenrod:        '#EEE8AA',\n    palegreen:            '#98FB98',\n    paleturquoise:        '#AFEEEE',\n    palevioletred:        '#DB7093',\n    papayawhip:           '#FFEFD5',\n    peachpuff:            '#FFDAB9',\n    peru:                 '#CD853F',\n    pink:                 '#FFC0CB',\n    plum:                 '#DDA0DD',\n    powderblue:           '#B0E0E6',\n    purple:               '#800080',\n    rebeccapurple:        '#663399',\n    red:                  '#FF0000',\n    rosybrown:            '#BC8F8F',\n    royalblue:            '#4169E1',\n    saddlebrown:          '#8B4513',\n    salmon:               '#FA8072',\n    sandybrown:           '#F4A460',\n    seagreen:             '#2E8B57',\n    seashell:             '#FFF5EE',\n    sienna:               '#A0522D',\n    silver:               '#C0C0C0',\n    skyblue:              '#87CEEB',\n    slateblue:            '#6A5ACD',\n    slategray:            '#708090',\n    slategrey:            '#708090',\n    snow:                 '#FFFAFA',\n    springgreen:          '#00FF7F',\n    steelblue:            '#4682B4',\n    tan:                  '#D2B48C',\n    teal:                 '#008080',\n    thistle:              '#D8BFD8',\n    tomato:               '#FF6347',\n    turquoise:            '#40E0D0',\n    violet:               '#EE82EE',\n    wheat:                '#F5DEB3',\n    white:                '#FFFFFF',\n    whitesmoke:           '#F5F5F5',\n    yellow:               '#FFFF00',\n    yellowgreen:          '#9ACD32'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      scaleMap = ['e', 'se', 's', 'sw', 'w', 'nw', 'n', 'ne', 'e'],\n      skewMap = ['ns', 'nesw', 'ew', 'nwse'],\n      controls = {},\n      LEFT = 'left', TOP = 'top', RIGHT = 'right', BOTTOM = 'bottom', CENTER = 'center',\n      opposite = {\n        top: BOTTOM,\n        bottom: TOP,\n        left: RIGHT,\n        right: LEFT,\n        center: CENTER,\n      }, radiansToDegrees = fabric.util.radiansToDegrees,\n      sign = (Math.sign || function(x) { return ((x > 0) - (x < 0)) || +x; });\n\n  /**\n   * Combine control position and object angle to find the control direction compared\n   * to the object center.\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   * @param {fabric.Control} control the control class\n   * @return {Number} 0 - 7 a quadrant number\n   */\n  function findCornerQuadrant(fabricObject, control) {\n    var cornerAngle = fabricObject.angle + radiansToDegrees(Math.atan2(control.y, control.x)) + 360;\n    return Math.round((cornerAngle % 360) / 45);\n  }\n\n  function fireEvent(eventName, options) {\n    var target = options.transform.target,\n        canvas = target.canvas,\n        canvasOptions = fabric.util.object.clone(options);\n    canvasOptions.target = target;\n    canvas && canvas.fire('object:' + eventName, canvasOptions);\n    target.fire(eventName, options);\n  }\n\n  /**\n   * Inspect event and fabricObject properties to understand if the scaling action\n   * @param {Event} eventData from the user action\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @return {Boolean} true if scale is proportional\n   */\n  function scaleIsProportional(eventData, fabricObject) {\n    var canvas = fabricObject.canvas, uniScaleKey = canvas.uniScaleKey,\n        uniformIsToggled = eventData[uniScaleKey];\n    return (canvas.uniformScaling && !uniformIsToggled) ||\n    (!canvas.uniformScaling && uniformIsToggled);\n  }\n\n  /**\n   * Checks if transform is centered\n   * @param {Object} transform transform data\n   * @return {Boolean} true if transform is centered\n   */\n  function isTransformCentered(transform) {\n    return transform.originX === CENTER && transform.originY === CENTER;\n  }\n\n  /**\n   * Inspect fabricObject to understand if the current scaling action is allowed\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @param {String} by 'x' or 'y' or ''\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\n   * @return {Boolean} true if scaling is not allowed at current conditions\n   */\n  function scalingIsForbidden(fabricObject, by, scaleProportionally) {\n    var lockX = fabricObject.lockScalingX, lockY = fabricObject.lockScalingY;\n    if (lockX && lockY) {\n      return true;\n    }\n    if (!by && (lockX || lockY) && scaleProportionally) {\n      return true;\n    }\n    if (lockX && by === 'x') {\n      return true;\n    }\n    if (lockY && by === 'y') {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * return the correct cursor style for the scale action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed',\n        scaleProportionally = scaleIsProportional(eventData, fabricObject),\n        by = '';\n    if (control.x !== 0 && control.y === 0) {\n      by = 'x';\n    }\n    else if (control.x === 0 && control.y !== 0) {\n      by = 'y';\n    }\n    if (scalingIsForbidden(fabricObject, by, scaleProportionally)) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control);\n    return scaleMap[n] + '-resize';\n  }\n\n  /**\n   * return the correct cursor style for the skew action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function skewCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed';\n    if (control.x !== 0 && fabricObject.lockSkewingY) {\n      return notAllowed;\n    }\n    if (control.y !== 0 && fabricObject.lockSkewingX) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control) % 4;\n    return skewMap[n] + '-resize';\n  }\n\n  /**\n   * Combine skew and scale style handlers to cover fabric standard use case\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleSkewCursorStyleHandler(eventData, control, fabricObject) {\n    if (eventData[fabricObject.canvas.altActionKey]) {\n      return controls.skewCursorStyleHandler(eventData, control, fabricObject);\n    }\n    return controls.scaleCursorStyleHandler(eventData, control, fabricObject);\n  }\n\n  /**\n   * Inspect event, control and fabricObject to return the correct action name\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} an action name\n   */\n  function scaleOrSkewActionName(eventData, control, fabricObject) {\n    var isAlternative = eventData[fabricObject.canvas.altActionKey];\n    if (control.x === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewX' : 'scaleY';\n    }\n    if (control.y === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewY' : 'scaleX';\n    }\n  }\n\n  /**\n   * Find the correct style for the control that is used for rotation.\n   * this function is very simple and it just take care of not-allowed or standard cursor\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function rotationStyleHandler(eventData, control, fabricObject) {\n    if (fabricObject.lockRotation) {\n      return 'not-allowed';\n    }\n    return control.cursorStyle;\n  }\n\n  function commonEventInfo(eventData, transform, x, y) {\n    return {\n      e: eventData,\n      transform: transform,\n      pointer: {\n        x: x,\n        y: y,\n      }\n    };\n  }\n\n  /**\n   * Wrap an action handler with saving/restoring object position on the transform.\n   * this is the code that permits to objects to keep their position while transforming.\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFixedAnchor(actionHandler) {\n    return function(eventData, transform, x, y) {\n      var target = transform.target, centerPoint = target.getCenterPoint(),\n          constraint = target.translateToOriginPoint(centerPoint, transform.originX, transform.originY),\n          actionPerformed = actionHandler(eventData, transform, x, y);\n      target.setPositionByOrigin(constraint, transform.originX, transform.originY);\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Transforms a point described by x and y in a distance from the top left corner of the object\n   * bounding box.\n   * @param {Object} transform\n   * @param {String} originX\n   * @param {String} originY\n   * @param {number} x\n   * @param {number} y\n   * @return {Fabric.Point} the normalized point\n   */\n  function getLocalPoint(transform, originX, originY, x, y) {\n    var target = transform.target,\n        control = target.controls[transform.corner],\n        zoom = target.canvas.getZoom(),\n        padding = target.padding / zoom,\n        localPoint = target.toLocalPoint(new fabric.Point(x, y), originX, originY);\n    if (localPoint.x >= padding) {\n      localPoint.x -= padding;\n    }\n    if (localPoint.x <= -padding) {\n      localPoint.x += padding;\n    }\n    if (localPoint.y >= padding) {\n      localPoint.y -= padding;\n    }\n    if (localPoint.y <= padding) {\n      localPoint.y += padding;\n    }\n    localPoint.x -= control.offsetX;\n    localPoint.y -= control.offsetY;\n    return localPoint;\n  }\n\n  /**\n   * Detect if the fabric object is flipped on one side.\n   * @param {fabric.Object} target\n   * @return {Boolean} true if one flip, but not two.\n   */\n  function targetHasOneFlip(target) {\n    return (target.flipX && !target.flipY) || (!target.flipX && target.flipY);\n  }\n\n  /**\n   * Utility function to compensate the scale factor when skew is applied on both axes\n   * @private\n   */\n  function compensateScaleForSkew(target, oppositeSkew, scaleToCompensate, axis, reference) {\n    if (target[oppositeSkew] !== 0) {\n      var newDim = target._getTransformedDimensions()[axis];\n      var newValue = reference / newDim * target[scaleToCompensate];\n      target.set(scaleToCompensate, newValue);\n    }\n  }\n\n  /**\n   * Action handler for skewing on the X axis\n   * @private\n   */\n  function skewObjectX(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(0, target.skewY),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.x * 2) - dimNoSkew.x,\n        currentSkew = target.skewX, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleX), (dimNoSkew.y / target.scaleY))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().y;\n      target.set('skewX', newSkew);\n      compensateScaleForSkew(target, 'skewY', 'scaleY', 'y', dimBeforeSkewing);\n      fireEvent('skewing', commonEventInfo(eventData, transform, x, y));\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Action handler for skewing on the Y axis\n   * @private\n   */\n  function skewObjectY(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(target.skewX, 0),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.y * 2) - dimNoSkew.y,\n        currentSkew = target.skewY, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleY), (dimNoSkew.x / target.scaleX))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().x;\n      target.set('skewY', newSkew);\n      compensateScaleForSkew(target, 'skewX', 'scaleX', 'x', dimBeforeSkewing);\n      fireEvent('skewing', commonEventInfo(eventData, transform, x, y));\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerX(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewX > 0 and originY bottom we anchor on right\n    // if skewX > 0 and originY top we anchor on left\n    // if skewX < 0 and originY bottom we anchor on left\n    // if skewX < 0 and originY top we anchor on right\n    // if skewX is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewX, originX, originY = transform.originY;\n    if (target.lockSkewingX) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.x > 0) {\n        // we are pulling right, anchor left;\n        originX = LEFT;\n      }\n      else {\n        // we are pulling right, anchor right\n        originX = RIGHT;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originX = originY === TOP ? LEFT : RIGHT;\n      }\n      if (currentSkew < 0) {\n        originX = originY === TOP ? RIGHT : LEFT;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originX = originX === LEFT ? RIGHT : LEFT;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originX = originX;\n    var finalHandler = wrapWithFixedAnchor(skewObjectX);\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerY(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewY > 0 and originX left we anchor on top\n    // if skewY > 0 and originX right we anchor on bottom\n    // if skewY < 0 and originX left we anchor on bottom\n    // if skewY < 0 and originX right we anchor on top\n    // if skewY is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewY, originY, originX = transform.originX;\n    if (target.lockSkewingY) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.y > 0) {\n        // we are pulling down, anchor up;\n        originY = TOP;\n      }\n      else {\n        // we are pulling up, anchor down\n        originY = BOTTOM;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originY = originX === LEFT ? TOP : BOTTOM;\n      }\n      if (currentSkew < 0) {\n        originY = originX === LEFT ? BOTTOM : TOP;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originY = originY === TOP ? BOTTOM : TOP;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originY = originY;\n    var finalHandler = wrapWithFixedAnchor(skewObjectY);\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler for rotation and snapping, without anchor point.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function rotationWithSnapping(eventData, transform, x, y) {\n    var t = transform,\n        target = t.target,\n        pivotPoint = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);\n\n    if (target.lockRotation) {\n      return false;\n    }\n\n    var lastAngle = Math.atan2(t.ey - pivotPoint.y, t.ex - pivotPoint.x),\n        curAngle = Math.atan2(y - pivotPoint.y, x - pivotPoint.x),\n        angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n        hasRotated = true;\n\n    if (target.snapAngle > 0) {\n      var snapAngle  = target.snapAngle,\n          snapThreshold  = target.snapThreshold || snapAngle,\n          rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n          leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n      if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n        angle = leftAngleLocked;\n      }\n      else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n        angle = rightAngleLocked;\n      }\n    }\n\n    // normalize angle to positive value\n    if (angle < 0) {\n      angle = 360 + angle;\n    }\n    angle %= 360;\n\n    hasRotated = target.angle !== angle;\n    target.angle = angle;\n    if (hasRotated) {\n      fireEvent('rotating', commonEventInfo(eventData, transform, x, y));\n    }\n    return hasRotated;\n  }\n\n  /**\n   * Basic scaling logic, reused with different constrain for scaling X,Y, freely or equally.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @param {Object} options additional information for scaling\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function scaleObject(eventData, transform, x, y, options) {\n    options = options || {};\n    var target = transform.target,\n        lockScalingX = target.lockScalingX, lockScalingY = target.lockScalingY,\n        by = options.by, newPoint, scaleX, scaleY, dim,\n        scaleProportionally = scaleIsProportional(eventData, target),\n        forbidScaling = scalingIsForbidden(target, by, scaleProportionally),\n        signX, signY, gestureScale = transform.gestureScale;\n\n    if (forbidScaling) {\n      return false;\n    }\n    if (gestureScale) {\n      scaleX = transform.scaleX * gestureScale;\n      scaleY = transform.scaleY * gestureScale;\n    }\n    else {\n      newPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y);\n      // use of sign: We use sign to detect change of direction of an action. sign usually change when\n      // we cross the origin point with the mouse. So a scale flip for example. There is an issue when scaling\n      // by center and scaling using one middle control ( default: mr, mt, ml, mb), the mouse movement can easily\n      // cross many time the origin point and flip the object. so we need a way to filter out the noise.\n      // This ternary here should be ok to filter out X scaling when we want Y only and vice versa.\n      signX = by !== 'y' ? sign(newPoint.x) : 1;\n      signY = by !== 'x' ? sign(newPoint.y) : 1;\n      if (!transform.signX) {\n        transform.signX = signX;\n      }\n      if (!transform.signY) {\n        transform.signY = signY;\n      }\n\n      if (target.lockScalingFlip &&\n        (transform.signX !== signX || transform.signY !== signY)\n      ) {\n        return false;\n      }\n\n      dim = target._getTransformedDimensions();\n      // missing detection of flip and logic to switch the origin\n      if (scaleProportionally && !by) {\n        // uniform scaling\n        var distance = Math.abs(newPoint.x) + Math.abs(newPoint.y),\n            original = transform.original,\n            originalDistance = Math.abs(dim.x * original.scaleX / target.scaleX) +\n              Math.abs(dim.y * original.scaleY / target.scaleY),\n            scale = distance / originalDistance, hasScaled;\n        scaleX = original.scaleX * scale;\n        scaleY = original.scaleY * scale;\n      }\n      else {\n        scaleX = Math.abs(newPoint.x * target.scaleX / dim.x);\n        scaleY = Math.abs(newPoint.y * target.scaleY / dim.y);\n      }\n      // if we are scaling by center, we need to double the scale\n      if (isTransformCentered(transform)) {\n        scaleX *= 2;\n        scaleY *= 2;\n      }\n      if (transform.signX !== signX && by !== 'y') {\n        transform.originX = opposite[transform.originX];\n        scaleX *= -1;\n        transform.signX = signX;\n      }\n      if (transform.signY !== signY && by !== 'x') {\n        transform.originY = opposite[transform.originY];\n        scaleY *= -1;\n        transform.signY = signY;\n      }\n    }\n    // minScale is taken are in the setter.\n    var oldScaleX = target.scaleX, oldScaleY = target.scaleY;\n    if (!by) {\n      !lockScalingX && target.set('scaleX', scaleX);\n      !lockScalingY && target.set('scaleY', scaleY);\n    }\n    else {\n      // forbidden cases already handled on top here.\n      by === 'x' && target.set('scaleX', scaleX);\n      by === 'y' && target.set('scaleY', scaleY);\n    }\n    hasScaled = oldScaleX !== target.scaleX || oldScaleY !== target.scaleY;\n    if (hasScaled) {\n      fireEvent('scaling', commonEventInfo(eventData, transform, x, y));\n    }\n    return hasScaled;\n  }\n\n  /**\n   * Generic scaling logic, to scale from corners either equally or freely.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectFromCorner(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y);\n  }\n\n  /**\n   * Scaling logic for the X axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectX(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'x' });\n  }\n\n  /**\n   * Scaling logic for the Y axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectY(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'y' });\n  }\n\n  /**\n   * Composed action handler to either scale Y or skew X\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingYOrSkewingX(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerX(eventData, transform, x, y);\n    }\n    return controls.scalingY(eventData, transform, x, y);\n  }\n\n  /**\n   * Composed action handler to either scale X or skew Y\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingXOrSkewingY(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerY(eventData, transform, x, y);\n    }\n    return controls.scalingX(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler to change textbox width\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function changeWidth(eventData, transform, x, y) {\n    var target = transform.target, localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        strokePadding = target.strokeWidth / (target.strokeUniform ? target.scaleX : 1),\n        multiplier = isTransformCentered(transform) ? 2 : 1,\n        oldWidth = target.width, hasResized,\n        newWidth = Math.abs(localPoint.x * multiplier / target.scaleX) - strokePadding;\n    target.set('width', Math.max(newWidth, 0));\n    hasResized = oldWidth !== newWidth;\n    if (hasResized) {\n      fireEvent('resizing', commonEventInfo(eventData, transform, x, y));\n    }\n    return hasResized;\n  }\n\n  /**\n   * Action handler\n   * @private\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if the translation occurred\n   */\n  function dragHandler(eventData, transform, x, y) {\n    var target = transform.target,\n        newLeft = x - transform.offsetX,\n        newTop = y - transform.offsetY,\n        moveX = !target.get('lockMovementX') && target.left !== newLeft,\n        moveY = !target.get('lockMovementY') && target.top !== newTop;\n    moveX && target.set('left', newLeft);\n    moveY && target.set('top', newTop);\n    if (moveX || moveY) {\n      fireEvent('moving', commonEventInfo(eventData, transform, x, y));\n    }\n    return moveX || moveY;\n  }\n\n  controls.scaleCursorStyleHandler = scaleCursorStyleHandler;\n  controls.skewCursorStyleHandler = skewCursorStyleHandler;\n  controls.scaleSkewCursorStyleHandler = scaleSkewCursorStyleHandler;\n  controls.rotationWithSnapping = wrapWithFixedAnchor(rotationWithSnapping);\n  controls.scalingEqually = wrapWithFixedAnchor(scaleObjectFromCorner);\n  controls.scalingX = wrapWithFixedAnchor(scaleObjectX);\n  controls.scalingY = wrapWithFixedAnchor(scaleObjectY);\n  controls.scalingYOrSkewingX = scalingYOrSkewingX;\n  controls.scalingXOrSkewingY = scalingXOrSkewingY;\n  controls.changeWidth = wrapWithFixedAnchor(changeWidth);\n  controls.skewHandlerX = skewHandlerX;\n  controls.skewHandlerY = skewHandlerY;\n  controls.dragHandler = dragHandler;\n  controls.scaleOrSkewActionName = scaleOrSkewActionName;\n  controls.rotationStyleHandler = rotationStyleHandler;\n  controls.fireEvent = fireEvent;\n  controls.wrapWithFixedAnchor = wrapWithFixedAnchor;\n  controls.getLocalPoint = getLocalPoint;\n  fabric.controlsUtils = controls;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      degreesToRadians = fabric.util.degreesToRadians,\n      controls = fabric.controlsUtils;\n\n  /**\n   * Render a round control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderCircleControl (ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var size = styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : this.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor);\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(left, top, size / 2, 0, 2 * Math.PI, false);\n    ctx[methodName]();\n    if (stroke) {\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  /**\n   * Render a square control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderSquareControl(ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var size = styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (\n          styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor\n        ), sizeBy2 = size / 2;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.strokeCornerColor || fabricObject.strokeCornerColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.translate(left, top);\n    ctx.rotate(degreesToRadians(fabricObject.angle));\n    // this does not work, and fixed with ( && ) does not make sense.\n    // to have real transparent corners we need the controls on upperCanvas\n    // transparentCorners || ctx.clearRect(-sizeBy2, -sizeBy2, size, size);\n    ctx[methodName + 'Rect'](-sizeBy2, -sizeBy2, size, size);\n    if (stroke) {\n      ctx.strokeRect(-sizeBy2, -sizeBy2, size, size);\n    }\n    ctx.restore();\n  }\n\n  controls.renderCircleControl = renderCircleControl;\n  controls.renderSquareControl = renderSquareControl;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  function Control(options) {\n    for (var i in options) {\n      this[i] = options[i];\n    }\n  }\n\n  fabric.Control = Control;\n\n  fabric.Control.prototype = /** @lends fabric.Control.prototype */ {\n\n    /**\n     * keep track of control visibility.\n     * mainly for backward compatibility.\n     * if you do not want to see a control, you can remove it\n     * from the controlset.\n     * @type {Boolean}\n     * @default true\n     */\n    visible: true,\n\n    /**\n     * Name of the action that the controll will likely execute.\n     * This is optional. FabricJS uses to identify what the user is doing for some\n     * extra optimizations. If you are writing a custom control and you want to know\n     * somewhere else in the code what is going on, you can use this string here.\n     * you can also provide a custom getActionName if your control run multiple actions\n     * depending on some external state.\n     * default to scale since is the most common, used on 4 corners by default\n     * @type {String}\n     * @default 'scale'\n     */\n    actionName: 'scale',\n\n    /**\n     * Drawing angle of the control.\n     * NOT used for now, but name marked as needed for internal logic\n     * example: to reuse the same drawing function for different rotated controls\n     * @type {Number}\n     * @default 0\n     */\n    angle: 0,\n\n    /**\n     * Relative position of the control. X\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    x: 0,\n\n    /**\n     * Relative position of the control. Y\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    y: 0,\n\n    /**\n     * Horizontal offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the right, negative to the left.\n     * It used when you want to have position of control that does not scale with\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\n     * the boundindbox, with an offset of 30 pixels vertivally. Those 30 pixels will\n     * stay 30 pixels no matter how the object is big. Another example is having 2\n     * controls in the corner, that stay in the same position when the object scale.\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the bottom, negative to the top.\n     * @type {Number}\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Css cursor style to display when the control is hovered.\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\n     * @type {String}\n     * @default 'crosshair'\n     */\n    cursorStyle: 'crosshair',\n\n    /**\n     * If controls has an offsetY or offsetX, draw a line that connects\n     * the control to the bounding box\n     * @type {Boolean}\n     * @default false\n     */\n    withConnection: false,\n\n    /**\n     * The control actionHandler, provide one to handle action ( control being moved )\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    actionHandler: function(/* eventData, transformData, fabricObject */) { },\n\n    /**\n     * The control handler for mouse down, provide one to handle mouse down on control\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    mouseDownHandler: function(/* eventData, transformData, fabricObject */) { },\n\n    /**\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    mouseUpHandler: function(/* eventData, transformData, fabricObject */) { },\n\n    /**\n     * Returns control actionHandler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    getActionHandler: function(/* eventData, transformData, fabricObject */) {\n      return this.actionHandler;\n    },\n\n    /**\n     * Returns control mouseDown handler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    getMouseDownHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseDownHandler;\n    },\n\n    /**\n     * Returns control mouseUp handler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    getMouseUpHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseUpHandler;\n    },\n\n    /**\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\n     * function you can pass one in the constructor\n     * the cursorStyle property\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    cursorStyleHandler: function(eventData, control /* fabricObject */) {\n      return control.cursorStyle;\n    },\n\n    /**\n     * Returns the action name. The basic implementation just return the actionName property.\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    getActionName: function(eventData, control /* fabricObject */) {\n      return control.actionName;\n    },\n\n    /**\n     * Returns controls visibility\n     * @param {fabric.Object} object on which the control is displayed\n     * @param {String} controlKey key where the control is memorized on the\n     * @return {Boolean}\n     */\n    getVisibility: function(fabricObject, controlKey) {\n      var objectVisibility = fabricObject._controlsVisibility;\n      if (objectVisibility && typeof objectVisibility[controlKey] !== 'undefined') {\n        return objectVisibility[controlKey];\n      }\n      return this.visible;\n    },\n\n    /**\n     * Sets controls visibility\n     * @param {Boolean} visibility for the object\n     * @return {Void}\n     */\n    setVisibility: function(visibility /* name, fabricObject */) {\n      this.visible = visibility;\n    },\n\n\n    positionHandler: function(dim, finalMatrix /*, fabricObject, currentControl */) {\n      var point = fabric.util.transformPoint({\n        x: this.x * dim.x + this.offsetX,\n        y: this.y * dim.y + this.offsetY }, finalMatrix);\n      return point;\n    },\n\n    /**\n    * Render function for the control.\n    * When this function runs the context is unscaled. unrotate. Just retina scaled.\n    * all the functions will have to translate to the point left,top before starting Drawing\n    * if they want to draw a control where the position is detected.\n    * left and top are the result of the positionHandler function\n    * @param {RenderingContext2D} ctx the context where the control will be drawn\n    * @param {Number} left position of the canvas where we are about to render the control.\n    * @param {Number} top position of the canvas where we are about to render the control.\n    * @param {Object} styleOverride\n    * @param {fabric.Object} fabricObject the object where the control is about to be rendered\n    */\n    render: function(ctx, left, top, styleOverride, fabricObject) {\n      styleOverride = styleOverride || {};\n      switch (styleOverride.cornerStyle || fabricObject.cornerStyle) {\n        case 'circle':\n          fabric.controlsUtils.renderCircleControl.call(this, ctx, left, top, styleOverride, fabricObject);\n          break;\n        default:\n          fabric.controlsUtils.renderSquareControl.call(this, ctx, left, top, styleOverride, fabricObject);\n      }\n    },\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el, multiplier) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity, i;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha * multiplier;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * A transform matrix to apply to the gradient before painting.\n     * Imported from svg gradients, is not applied with the current transform in the center.\n     * Before this transform is applied, the origin point is at the top left corner of the object\n     * plus the addition of offsetY and offsetX.\n     * @type Number[]\n     * @default null\n     */\n    gradientTransform: null,\n\n    /**\n     * coordinates units for coords.\n     * If `pixels`, the number of coords are in the same unit of width / height.\n     * If set as `percentage` the coords are still a number, but 1 means 100% of width\n     * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\n     * allowed values pixels or percentage.\n     * @type String\n     * @default 'pixels'\n     */\n    gradientUnits: 'pixels',\n\n    /**\n     * Gradient type linear or radial\n     * @type String\n     * @default 'pixels'\n     */\n    type: 'linear',\n\n    /**\n     * Constructor\n     * @param {Object} options Options object with type, coords, gradientUnits and colorStops\n     * @param {Object} [options.type] gradient type linear or radial\n     * @param {Object} [options.gradientUnits] gradient units\n     * @param {Object} [options.offsetX] SVG import compatibility\n     * @param {Object} [options.offsetY] SVG import compatibility\n     * @param {Object[]} options.colorStops contains the colorstops.\n     * @param {Object} options.coords contains the coords of the gradient\n     * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\n     * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n      options.coords || (options.coords = { });\n\n      var coords, _this = this;\n\n      // sets everything, then coords and colorstops get sets again\n      Object.keys(options).forEach(function(option) {\n        _this[option] = options[option];\n      });\n\n      if (this.id) {\n        this.id += '_' + fabric.Object.__uid++;\n      }\n      else {\n        this.id = fabric.Object.__uid++;\n      }\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientUnits: this.gradientUnits,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object, options) {\n      var coords = clone(this.coords, true), i, len, options = options || {},\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2,\n          transform = this.gradientTransform ? this.gradientTransform.concat() : fabric.iMatrix.concat(),\n          offsetX = -this.offsetX, offsetY = -this.offsetY,\n          withViewport = !!options.additionalTransform,\n          gradientUnits = this.gradientUnits === 'pixels' ? 'userSpaceOnUse' : 'objectBoundingBox';\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n\n      if (gradientUnits === 'objectBoundingBox') {\n        offsetX /= object.width;\n        offsetY /= object.height;\n      }\n      else {\n        offsetX += object.width / 2;\n        offsetY += object.height / 2;\n      }\n      if (object.type === 'path') {\n        offsetX -= object.pathOffset.x;\n        offsetY -= object.pathOffset.y;\n      }\n\n\n      transform[4] -= offsetX;\n      transform[5] -= offsetY;\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"' + gradientUnits + '\"';\n      commonAttributes += ' gradientTransform=\"' + (withViewport ?\n        options.additionalTransform + ' ' : '') + fabric.util.matrixToSVG(transform) + '\" ';\n\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (i = 0, len = colorStops.length; i < len; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n          'offset=\"', (colorStop.offset * 100) + '%',\n          '\" style=\"stop-color:', colorStop.color,\n          (typeof colorStop.opacity !== 'undefined' ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx) {\n      var gradient, coords = fabric.util.object.clone(this.coords), i, len;\n\n      if (!this.type) {\n        return;\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly graidents\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance, opacityAttr, svgOptions) {\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var multiplier = parseFloat(opacityAttr) / (/%$/.test(opacityAttr) ? 100 : 1);\n      multiplier = multiplier < 0 ? 0 : multiplier > 1 ? 1 : multiplier;\n      if (isNaN(multiplier)) {\n        multiplier = 1;\n      }\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') === 'userSpaceOnUse' ?\n            'pixels' : 'percentage',\n          gradientTransform = el.getAttribute('gradientTransform') || '',\n          colorStops = [],\n          coords, i, offsetX = 0, offsetY = 0,\n          transformMatrix;\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n        coords = getLinearCoords(el);\n      }\n      else {\n        type = 'radial';\n        coords = getRadialCoords(el);\n      }\n\n      for (i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i], multiplier));\n      }\n\n      transformMatrix = fabric.parseTransformAttribute(gradientTransform);\n\n      __convertPercentUnitsToValues(instance, coords, svgOptions, gradientUnits);\n\n      if (gradientUnits === 'pixels') {\n        offsetX = -instance.left;\n        offsetY = -instance.top;\n      }\n\n      var gradient = new fabric.Gradient({\n        id: el.getAttribute('id'),\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        gradientUnits: gradientUnits,\n        gradientTransform: transformMatrix,\n        offsetX: offsetX,\n        offsetY: offsetY,\n      });\n\n      return gradient;\n    }\n    /* _FROM_SVG_END_ */\n  });\n\n  /**\n   * @private\n   */\n  function __convertPercentUnitsToValues(instance, options, svgOptions, gradientUnits) {\n    var propValue, finalValue;\n    Object.keys(options).forEach(function(prop) {\n      propValue = options[prop];\n      if (propValue === 'Infinity') {\n        finalValue = 1;\n      }\n      else if (propValue === '-Infinity') {\n        finalValue = 0;\n      }\n      else {\n        finalValue = parseFloat(options[prop], 10);\n        if (typeof propValue === 'string' && /^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)) {\n          finalValue *= 0.01;\n          if (gradientUnits === 'pixels') {\n            // then we need to fix those percentages here in svg parsing\n            if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n              finalValue *= svgOptions.viewBoxWidth || svgOptions.width;\n            }\n            if (prop === 'y1' || prop === 'y2') {\n              finalValue *= svgOptions.viewBoxHeight || svgOptions.height;\n            }\n          }\n        }\n      }\n      options[prop] = finalValue;\n    });\n  }\n})();\n\n\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * transform matrix to change the pattern, imported from svgs.\n     * @type Array\n     * @default\n     */\n    patternTransform: null,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img, isError) {\n          _this.source = img;\n          callback && callback(_this, isError);\n        }, null, this.crossOrigin);\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // <img> element\n      if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        crossOrigin: this.crossOrigin,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n        patternTransform: this.patternTransform ? this.patternTransform.concat() : null\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n        if (patternOffsetY) {\n          patternHeight += Math.abs(patternOffsetY);\n        }\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n        if (patternOffsetX) {\n          patternWidth += Math.abs(patternOffsetX);\n        }\n\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = this.source;\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * When `false`, the shadow will scale with the object.\n     * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\n     * default to false\n     * @type Boolean\n     * @default\n     */\n    nonScaling: false,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseInt(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseInt(offsetsAndBlur[2], 10) || 0,\n        blur: parseInt(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20, color = new fabric.Color(this.color);\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + color.toRgb() + '\" flood-opacity=\"' + color.getAlpha() + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke,\n          nonScaling: this.nonScaling\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke', 'nonScaling'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:px)?(?:\\s?|$))?(-?\\d+(?:px)?(?:\\s?|$))?(\\d+(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n      getNodeCanvas = fabric.util.getNodeCanvas,\n      createCanvasElement = fabric.util.createCanvasElement,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as background, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * if set to false, takes precedence over the object value.\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n     * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n     * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n     * since the renders are quequed and executed one per frame.\n     * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n     * Left default to true to do not break documentation and old app, fiddles.\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (in the format of Canvas transform) which focuses the viewport\n     * @type Array\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     * @type Boolean\n     * @default\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     * @type Boolean\n     * @default\n     */\n    skipOffscreen: true,\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n     * top left corner of the canvas.\n     * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = this.requestRenderAllBound;\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio !== 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? fabric.devicePixelRatio : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      var scaleRatio = fabric.devicePixelRatio;\n      this.__initRetinaScaling(scaleRatio, this.lowerCanvasEl, this.contextContainer);\n      if (this.upperCanvasEl) {\n        this.__initRetinaScaling(scaleRatio, this.upperCanvasEl, this.contextTop);\n      }\n    },\n\n    __initRetinaScaling: function(scaleRatio, canvas, context) {\n      canvas.setAttribute('width', this.width * scaleRatio);\n      canvas.setAttribute('height', this.height * scaleRatio);\n      context.scale(scaleRatio, scaleRatio);\n    },\n\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    // TODO: fix stretched examples\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n     * @param {Function} callback Callback to invoke when foreground color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occured or not.\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img, isError) {\n          if (img) {\n            var instance = new fabric.Image(img, options);\n            this[property] = instance;\n            instance.canvas = this;\n          }\n          callback && callback(img, isError);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        image && (image.canvas = this);\n        callback && callback(image, false);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function() {\n      var element = createCanvasElement();\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (!element.style) {\n        element.style = { };\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      var lowerCanvasEl = this.lowerCanvasEl;\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      lowerCanvasEl.width = this.width;\n      lowerCanvasEl.height = this.height;\n\n      lowerCanvasEl.style.width = this.width + 'px';\n      lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\n      if (canvasEl && canvasEl.getContext) {\n        this.lowerCanvasEl = canvasEl;\n      }\n      else {\n        this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\n      }\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n          this.hasLostContext = true;\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      if (this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles();\n      }\n      this._initRetinaScaling();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.requestRenderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transform of this canvas instance\n     * @param {Array} vpt the transform in the form of context.transform\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeObject = this._activeObject, object, i, len;\n      this.viewportTransform = vpt;\n      for (i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(true);\n      }\n      if (activeObject) {\n        activeObject.setCoords();\n      }\n      this.calcViewportBoundaries();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, zoom centered around point\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this._objects.length = 0;\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Function created to be instance bound at initialization\n     * used in requestAnimationFrame rendering\n     * Let the fabricJS call it. If you call it manually you could have more\n     * animationFrame stacking on to of each other\n     * for an imperative rendering, use canvas.renderAll\n     * @private\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAndReset: function() {\n      this.isRendering = 0;\n      this.renderAll();\n    },\n\n    /**\n     * Append a renderAll request to next animation frame.\n     * unless one is already in progress, in that case nothing is done\n     * a boolean flag will avoid appending more.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    requestRenderAll: function () {\n      if (!this.isRendering) {\n        this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound);\n      }\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.width, height = this.height,\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    cancelRequestedRender: function() {\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      var v = this.viewportTransform, path = this.clipPath;\n      this.cancelRequestedRender();\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothingEnabled);\n      this.fire('before:render', { ctx: ctx, });\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (path) {\n        path.canvas = this;\n        // needed to setup a couple of variables\n        path.shouldCache();\n        path._transformDone = true;\n        path.renderCache({ forClipping: true });\n        this.drawClipPathOnCanvas(ctx);\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render', { ctx: ctx, });\n    },\n\n    /**\n     * Paint the cached clipPath on the lowerCanvasEl\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCanvas: function(ctx) {\n      var v = this.viewportTransform, path = this.clipPath;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4;\n      ctx.globalCompositeOperation = 'destination-in';\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      var i, len;\n      for (i = 0, len = objects.length; i < len; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var fill = this[property + 'Color'], object = this[property + 'Image'],\n          v = this.viewportTransform, needsVpt = this[property + 'Vpt'];\n      if (!fill && !object) {\n        return;\n      }\n      if (fill) {\n        ctx.save();\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(this.width, 0);\n        ctx.lineTo(this.width, this.height);\n        ctx.lineTo(0, this.height);\n        ctx.closePath();\n        ctx.fillStyle = fill.toLive\n          ? fill.toLive(ctx, this)\n          : fill;\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        ctx.transform(1, 0, 0, 1, fill.offsetX || 0, fill.offsetY || 0);\n        var m = fill.gradientTransform || fill.patternTransform;\n        m && ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n        ctx.fill();\n        ctx.restore();\n      }\n      if (object) {\n        ctx.save();\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        object.render(ctx);\n        ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     */\n    getCenter: function () {\n      return {\n        top: this.height / 2,\n        left: this.width / 2\n      };\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenter().left, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenter().top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenter();\n\n      return this._centerObject(object, new fabric.Point(center.left, center.top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenter(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint({ x: center.left, y: center.top }, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      object.setCoords();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Returs dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var clipPath = this.clipPath, data = {\n        version: fabric.version,\n        objects: this._toObjects(methodName, propertiesToInclude),\n      };\n      if (clipPath) {\n        data.clipPath = this._toObject(this.clipPath, methodName, propertiesToInclude);\n      }\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this._objects.filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = { }, bgImage = this.backgroundImage, overlay = this.overlayImage;\n\n      if (this.backgroundColor) {\n        data.background = this.backgroundColor.toObject\n          ? this.backgroundColor.toObject(propertiesToInclude)\n          : this.backgroundColor;\n      }\n\n      if (this.overlayColor) {\n        data.overlay = this.overlayColor.toObject\n          ? this.overlayColor.toObject(propertiesToInclude)\n          : this.overlayColor;\n      }\n      if (bgImage && !bgImage.excludeFromExport) {\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\n      }\n      if (overlay && !overlay.excludeFromExport) {\n        data.overlayImage = this._toObject(overlay, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-cooridnate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n      options.reviver = reviver;\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n      if (this.clipPath) {\n        markup.push('<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'background');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n      this._setSVGObjects(markup, reviver);\n      if (this.clipPath) {\n        markup.push('</g>\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'overlay');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n        '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n        'xmlns=\"http://www.w3.org/2000/svg\" ',\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n        'version=\"1.1\" ',\n        'width=\"', width, '\" ',\n        'height=\"', height, '\" ',\n        viewBox,\n        'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n        this.createSVGFontFacesMarkup(),\n        this.createSVGRefElementsMarkup(),\n        this.createSVGClipPathMarkup(options),\n        '</defs>\\n'\n      );\n    },\n\n    createSVGClipPathMarkup: function(options) {\n      var clipPath = this.clipPath;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        return  '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          this.clipPath.toClipPathSVG(options.reviver) +\n          '</clipPath>\\n';\n      }\n      return '';\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['background', 'overlay'].map(function(prop) {\n            var fill = _this[prop + 'Color'];\n            if (fill && fill.toLive) {\n              var shouldTransform = _this[prop + 'Vpt'], vpt = _this.viewportTransform,\n                  object = {\n                    width: _this.width / (shouldTransform ? vpt[0] : 1),\n                    height: _this.height / (shouldTransform ? vpt[3] : 1)\n                  };\n              return fill.toSVG(\n                object,\n                { additionalTransform: shouldTransform ? fabric.util.matrixToSVG(vpt) : '' }\n              );\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex, i, len,\n          fontPaths = fabric.fontPaths, objects = [];\n\n      this._objects.forEach(function add(object) {\n        objects.push(object);\n        if (object._objects) {\n          object._objects.forEach(add);\n        }\n      });\n\n      for (i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance, i, len, objects = this._objects;\n      for (i = 0, len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && !this[property].excludeFromExport && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property + 'Color'], vpt = this.viewportTransform, finalWidth = this.width,\n          finalHeight = this.height;\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat, iVpt = fabric.util.invertTransform(vpt), shouldInvert = this[property + 'Vpt'],\n            additionalTransform = shouldInvert ? fabric.util.matrixToSVG(iVpt) : '';\n        markup.push(\n          '<rect transform=\"' + additionalTransform + ' translate(', finalWidth / 2, ',', finalHeight / 2, ')\"',\n          ' x=\"', filler.offsetX - finalWidth / 2,\n          '\" y=\"', filler.offsetY - finalHeight / 2, '\" ',\n          'width=\"',\n          (repeat === 'repeat-y' || repeat === 'no-repeat'\n            ? filler.source.width\n            : finalWidth ),\n          '\" height=\"',\n          (repeat === 'repeat-x' || repeat === 'no-repeat'\n            ? filler.source.height\n            : finalHeight),\n          '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\n          'fill=\"', filler, '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * An optional paramter, intersecting allowes to move the object in behind\n     * the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx > 0 + objsMoved) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx, i;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * An optional paramter, intersecting allowes to move the object in front\n     * of the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx < this._objects.length - 1 - objsMoved) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx, i, len;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (i = idx + 1, len = this._objects.length; i < len; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderOnAddRemove && this.requestRenderAll();\n    },\n\n    /**\n     * Clears a canvas element and dispose objects\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      // cancel eventually ongoing renders\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n      this.forEachObject(function(object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n      if (this.backgroundImage && this.backgroundImage.dispose) {\n        this.backgroundImage.dispose();\n      }\n      this.backgroundImage = null;\n      if (this.overlayImage && this.overlayImage.dispose) {\n        this.overlayImage.dispose();\n      }\n      this.overlayImage = null;\n      this._iTextInstances = null;\n      this.contextContainer = null;\n      fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\n      this.lowerCanvasEl = undefined;\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this._objects.length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns JSON representation of canvas\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {String} JSON string\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n  if (fabric.isLikelyNode) {\n    fabric.StaticCanvas.prototype.createPNGStream = function() {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createPNGStream();\n    };\n    fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createJPEGStream(opts);\n    };\n  }\n})();\n\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush, has to be a Number, no string literals\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n   * @type Number\n   * @default\n   */\n  strokeMiterLimit:         10,\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * Sets brush styles\n   * @private\n   */\n  _setBrushStyles: function() {\n    var ctx = this.canvas.contextTop;\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.miterLimit = this.strokeMiterLimit;\n    ctx.lineJoin = this.strokeLineJoin;\n    if (fabric.StaticCanvas.supports('setLineDash')) {\n      ctx.setLineDash(this.strokeDashArray || []);\n    }\n  },\n\n  /**\n   * Sets the transformation on given context\n   * @param {RenderingContext2d} ctx context to render on\n   * @private\n   */\n  _saveAndTransform: function(ctx) {\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var canvas = this.canvas,\n        shadow = this.shadow,\n        ctx = canvas.contextTop,\n        zoom = canvas.getZoom();\n    if (canvas && canvas._isRetinaScaling()) {\n      zoom *= fabric.devicePixelRatio;\n    }\n\n    ctx.shadowColor = shadow.color;\n    ctx.shadowBlur = shadow.blur * zoom;\n    ctx.shadowOffsetX = shadow.offsetX * zoom;\n    ctx.shadowOffsetY = shadow.offsetY * zoom;\n  },\n\n  needsFullRender: function() {\n    var color = new fabric.Color(this.color);\n    return color.getAlpha() < 1 || !!this.shadow;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  }\n});\n\n\n(function() {\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Discard points that are less than `decimate` pixel distant from each other\n     * @type Number\n     * @default 0.4\n     */\n    decimate: 0.4,\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    /**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */\n    _drawSegment: function (ctx, p1, p2) {\n      var midPoint = p1.midPointFrom(p2);\n      ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n      return midPoint;\n    },\n\n    /**\n     * Inovoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Inovoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      if (this._captureDrawingPath(pointer) && this._points.length > 1) {\n        if (this.needsFullRender()) {\n          // redraw curve\n          // clear top canvas\n          this.canvas.clearContext(this.canvas.contextTop);\n          this._render();\n        }\n        else {\n          var points = this._points, length = points.length, ctx = this.canvas.contextTop;\n          // draw the curve update\n          this._saveAndTransform(ctx);\n          if (this.oldEnd) {\n            ctx.beginPath();\n            ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\n          }\n          this.oldEnd = this._drawSegment(ctx, points[length - 2], points[length - 1], true);\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function(options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return true;\n      }\n      this.oldEnd = undefined;\n      this._finalizeAndAddPath();\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      if (this._points.length > 1 && point.eq(this._points[this._points.length - 1])) {\n        return false;\n      }\n      this._points.push(point);\n      return true;\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points = [];\n      this._setBrushStyles();\n      this._setShadow();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      return this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     */\n    _render: function() {\n      var ctx  = this.canvas.contextTop, i, len,\n          p1 = this._points[0],\n          p2 = this._points[1];\n\n      this._saveAndTransform(ctx);\n      ctx.beginPath();\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        var width = this.width / 1000;\n        p1 = new fabric.Point(p1.x, p1.y);\n        p2 = new fabric.Point(p2.x, p2.y);\n        p1.x -= width;\n        p2.x += width;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        this._drawSegment(ctx, p1, p2);\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {String} SVG path\n     */\n    convertPointsToSVGPath: function(points) {\n      var path = [], i, width = this.width / 1000,\n          p1 = new fabric.Point(points[0].x, points[0].y),\n          p2 = new fabric.Point(points[1].x, points[1].y),\n          len = points.length, multSignX = 1, multSignY = 0, manyPoints = len > 2;\n\n      if (manyPoints) {\n        multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\n        multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\n      }\n      path.push('M ', p1.x - multSignX * width, ' ', p1.y - multSignY * width, ' ');\n      for (i = 1; i < len; i++) {\n        if (!p1.eq(p2)) {\n          var midPoint = p1.midPointFrom(p2);\n          // p1 is our bezier control point\n          // midpoint is our endpoint\n          // start point is p(i-1) value.\n          path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');\n        }\n        p1 = points[i];\n        if ((i + 1) < points.length) {\n          p2 = points[i + 1];\n        }\n      }\n      if (manyPoints) {\n        multSignX = p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\n        multSignY = p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\n      }\n      path.push('L ', p1.x + multSignX * width, ' ', p1.y + multSignY * width);\n      return path;\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {String} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeMiterLimit: this.strokeMiterLimit,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n      });\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.shadow = new fabric.Shadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * Decimate poins array with the decimate value\n     */\n    decimatePoints: function(points, distance) {\n      if (points.length <= 2) {\n        return points;\n      }\n      var zoom = this.canvas.getZoom(), adjustedDistance = Math.pow(distance / zoom, 2),\n          i, l = points.length - 1, lastPoint = points[0], newPoints = [lastPoint],\n          cDistance;\n      for (i = 1; i < l; i++) {\n        cDistance = Math.pow(lastPoint.x - points[i].x, 2) + Math.pow(lastPoint.y - points[i].y, 2);\n        if (cDistance >= adjustedDistance) {\n          lastPoint = points[i];\n          newPoints.push(lastPoint);\n        }\n      }\n      if (newPoints.length === 1) {\n        newPoints.push(new fabric.Point(newPoints[0].x, newPoints[0].y));\n      }\n      return newPoints;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n      if (this.decimate) {\n        this._points = this.decimatePoints(this._points, this.decimate);\n      }\n      var pathData = this.convertPointsToSVGPath(this._points).join('');\n      if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.requestRenderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.canvas.fire('before:path:created', { path: path });\n      this.canvas.add(path);\n      this.canvas.requestRenderAll();\n      path.setCoords();\n      this._resetShadow();\n\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop;\n    this._saveAndTransform(ctx);\n    this.dot(ctx, point);\n    ctx.restore();\n  },\n\n  dot: function(ctx, point) {\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Render the full state of the brush\n   * @private\n   */\n  _render: function() {\n    var ctx  = this.canvas.contextTop, i, len,\n        points = this.points;\n    this._saveAndTransform(ctx);\n    for (i = 0, len = points.length; i < len; i++) {\n      this.dot(ctx, points[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.needsFullRender()) {\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.addPoint(pointer);\n      this._render();\n    }\n    else {\n      this.drawDot(pointer);\n    }\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove, i, len;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && (circle.shadow = new fabric.Shadow(this.shadow));\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles);\n    group.canvas = this.canvas;\n\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n          Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n          .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects);\n    this.shadow && group.set('shadow', new fabric.Shadow(this.shadow));\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key, i, len;\n\n    for (i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Render new chunk of spray brush\n   */\n  render: function(sprayChunk) {\n    var ctx = this.canvas.contextTop, i, len;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, len = sprayChunk.length; i < len; i++) {\n      var point = sprayChunk[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Render all spray chunks\n   */\n  _render: function() {\n    var ctx = this.canvas.contextTop, i, ilen;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      this.render(this.sprayChunks[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2, i;\n\n    for (i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.util.createCanvasElement(),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   */\n  getPattern: function() {\n    return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   */\n  _setBrushStyles: function() {\n    this.callSuper('_setBrushStyles');\n    this.canvas.contextTop.strokeStyle = this.getPattern();\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n\n\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      abs = Math.abs,\n      supportLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      isTouchEvent = fabric.util.isTouchEvent,\n      STROKE_OFFSET = 0.5;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified at the end of a transform or any change when statefull is true\n   * @fires object:rotating while an object is being rotated from the control\n   * @fires object:scaling while an object is being scaled by controls\n   * @fires object:moving while an object is being dragged\n   * @fires object:skewing while an object is being skewed from the controls\n   *\n   * @fires before:transform before a transform is is started\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created after a drawing operation ends and the path is added\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   * @fires after:render at the end of the render process, receives the context in the callback\n   * @fires before:render at start the render process, receives the context in the callback\n   *\n   * the following events are deprecated:\n   * @fires object:rotated at the end of a rotation transform\n   * @fires object:scaled at the end of a scale transform\n   * @fires object:moved at the end of translation transform\n   * @fires object:skewed at the end of a skew transform\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * when dragged on the corners that normally would not do that.\n     * @type Boolean\n     * @default\n     * @since fabric 4.0 // changed name and default value\n     */\n    uniformScaling:      true,\n\n    /**\n     * Indicates which key switches uniform scaling.\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * totally wrong named. this sounds like `uniform scaling`\n     * if Canvas.uniformScaling is true, pressing this will set it to false\n     * and viceversa.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transform\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key or keys enable multiple click selection\n     * Pass value as a string or array of strings\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or empty or containing any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.2\n     * @type String|Array\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * For a series of reason that come from the general expectations on how\n     * things should work, this feature works only for preserveObjectStacking true.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Select only shapes that are fully contained in the dragged selection rectangle.\n     * @type Boolean\n     * @default\n     */\n    selectionFullyContained: false,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for rotation point\n     * @type String\n     * @default\n     */\n    rotationCursor:         'crosshair',\n\n    /**\n     * Cursor value used for disabled elements ( corners with disabled action )\n     * @type String\n     * @since 2.0.0\n     * @default\n     */\n    notAllowedCursor:         'not-allowed',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped. Target detection will return always undefined.\n     * click selection won't work anymore, events will fire with no targets.\n     * if something is selected before setting it to true, it will be deselected at the first click.\n     * area selection will still work. check the `selection` property too.\n     * if you deactivate both, you should look into staticCanvas.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * Keep track of the subTargets for Mouse Events\n     * @type fabric.Object[]\n     */\n    targets: [],\n\n    /**\n     * Keep track of the hovered target\n     * @type fabric.Object\n     * @private\n     */\n    _hoveredTarget: null,\n\n    /**\n     * hold the list of nested targets hovered\n     * @type fabric.Object[]\n     * @private\n     */\n    _hoveredTargets: [],\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeObjects = this.getActiveObjects(),\n          object, objsToRender, activeGroupObjects;\n\n      if (activeObjects.length > 0 && !this.preserveObjectStacking) {\n        objsToRender = [];\n        activeGroupObjects = [];\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if (activeObjects.indexOf(object) === -1 ) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeObjects.length > 1) {\n          this._activeObject._objects = activeGroupObjects;\n        }\n        objsToRender.push.apply(objsToRender, activeGroupObjects);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      if (this.hasLostContext) {\n        this.renderTopLayer(this.contextTop);\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    renderTopLayer: function(ctx) {\n      ctx.save();\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._render();\n        this.contextTopDirty = true;\n      }\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n        this.contextTopDirty = true;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n      this.renderTopLayer(ctx);\n      this.fire('after:render');\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      // in case the target is the activeObject, we cannot execute this optimization\n      // because we need to draw controls too.\n      if (target.shouldCache() && target._cacheCanvas && target !== this._activeObject) {\n        var normalizedPointer = this._normalizePointer(target, {x: x, y: y}),\n            targetRelativeX = Math.max(target.cacheTranslationX + (normalizedPointer.x * target.zoomX), 0),\n            targetRelativeY = Math.max(target.cacheTranslationY + (normalizedPointer.y * target.zoomY), 0);\n\n        var isTransparent = fabric.util.isTransparent(\n          target._cacheContext, Math.round(targetRelativeX), Math.round(targetRelativeY), this.targetFindTolerance);\n\n        return isTransparent;\n      }\n\n      var ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor, v = this.viewportTransform;\n\n      target.selectionBackgroundColor = '';\n\n      this.clearContext(ctx);\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      target.render(ctx);\n      ctx.restore();\n\n      target === this._activeObject && target._renderControls(ctx, {\n        hasBorders: false,\n        transparentCorners: false\n      }, {\n        hasBorders: false,\n      });\n\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      return isTransparent;\n    },\n\n    /**\n     * takes an event and determins if selection key has been pressed\n     * @private\n     * @param {Event} e Event object\n     */\n    _isSelectionKeyPressed: function(e) {\n      var selectionKeyPressed = false;\n\n      if (Object.prototype.toString.call(this.selectionKey) === '[object Array]') {\n        selectionKeyPressed = !!this.selectionKey.find(function(key) { return e[key] === true; });\n      }\n      else {\n        selectionKeyPressed = e[this.selectionKey];\n      }\n\n      return selectionKeyPressed;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeObjects = this.getActiveObjects(),\n          activeObject = this._activeObject;\n\n      return (\n        !target\n        ||\n        (target &&\n          activeObject &&\n          activeObjects.length > 1 &&\n          activeObjects.indexOf(target) === -1 &&\n          activeObject !== target &&\n          !this._isSelectionKeyPressed(e))\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * centeredScaling from object can't override centeredScaling from canvas.\n     * this should be fixed, since object setting should take precedence over canvas.\n     * also this should be something that will be migrated in the control properties.\n     * as ability to define the origin of the transformation that the control provide.\n     * @private\n     * @param {fabric.Object} target\n     * @param {String} action\n     * @param {Boolean} altKey\n     */\n    _shouldCenterTransform: function (target, action, altKey) {\n      if (!target) {\n        return;\n      }\n\n      var centerTransform;\n\n      if (action === 'scale' || action === 'scaleX' || action === 'scaleY' || action === 'resizing') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !altKey : altKey;\n    },\n\n    /**\n     * should disappear before release 4.0\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n      else if (corner === 'mtr') {\n        origin.x = 'center';\n        origin.y = 'center';\n      }\n      return origin;\n    },\n\n    /**\n     * @private\n     * @param {Boolean} alreadySelected true if target is already selected\n     * @param {String} corner a string representing the corner ml, mr, tl ...\n     * @param {Event} e Event object\n     * @param {fabric.Object} [target] inserted back to help overriding. Unused\n     */\n    _getActionFromCorner: function(alreadySelected, corner, e, target) {\n      if (!corner || !alreadySelected) {\n        return 'drag';\n      }\n      var control = target.controls[corner];\n      return control.getActionName(e, control, target);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target, alreadySelected) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e), corner = target.__corner,\n          actionHandler = (alreadySelected && corner) ?\n            target.controls[corner].getActionHandler() : fabric.controlsUtils.dragHandler,\n          action = this._getActionFromCorner(alreadySelected, corner, e, target),\n          origin = this._getOriginFromCorner(target, corner),\n          altKey = e[this.centeredKey],\n          transform = {\n            target: target,\n            action: action,\n            actionHandler: actionHandler,\n            corner: corner,\n            scaleX: target.scaleX,\n            scaleY: target.scaleY,\n            skewX: target.skewX,\n            skewY: target.skewY,\n            // used by transation\n            offsetX: pointer.x - target.left,\n            offsetY: pointer.y - target.top,\n            originX: origin.x,\n            originY: origin.y,\n            ex: pointer.x,\n            ey: pointer.y,\n            lastX: pointer.x,\n            lastY: pointer.y,\n            // unsure they are useful anymore.\n            // left: target.left,\n            // top: target.top,\n            theta: degreesToRadians(target.angle),\n            // end of unsure\n            width: target.width * target.scaleX,\n            shiftKey: e.shiftKey,\n            altKey: altKey,\n            original: fabric.util.saveObjectTransform(target),\n          };\n\n      if (this._shouldCenterTransform(target, action, altKey)) {\n        transform.originX = 'center';\n        transform.originY = 'center';\n      }\n      transform.original.originX = origin.x;\n      transform.original.originY = origin.y;\n      this._currentTransform = transform;\n      this._beforeTransform(e);\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n\n        ctx.fillRect(\n          groupSelector.ex - ((left > 0) ? 0 : -left),\n          groupSelector.ey - ((top > 0) ? 0 : -top),\n          aleft,\n          atop\n        );\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      // selection border\n      if (this.selectionDashArray.length > 1 && !supportLineDash) {\n\n        var px = groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n            py = groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop);\n\n        ctx.beginPath();\n\n        fabric.util.drawDashedLine(ctx, px, py, px + aleft, py, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py + atop - 1, px + aleft, py + atop - 1, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py, px, py + atop, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px + aleft - 1, py, px + aleft - 1, py + atop, this.selectionDashArray);\n\n        ctx.closePath();\n        ctx.stroke();\n      }\n      else {\n        fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n        ctx.strokeRect(\n          groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n          groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),\n          aleft,\n          atop\n        );\n      }\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n     * or the outside part of the corner.\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     * @return {fabric.Object} the target found\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeObject = this._activeObject,\n          aObjects = this.getActiveObjects(),\n          activeTarget, activeTargetSubs,\n          isTouch = isTouchEvent(e);\n\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n\n      if (aObjects.length > 1 && !skipGroup && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        return activeObject;\n      }\n      // if we hit the corner of an activeObject, let's return that.\n      if (aObjects.length === 1 && activeObject._findTargetCorner(pointer, isTouch)) {\n        return activeObject;\n      }\n      if (aObjects.length === 1 &&\n        activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n          activeTargetSubs = this.targets;\n          this.targets = [];\n        }\n      }\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n        this.targets = activeTargetSubs;\n      }\n      return target;\n    },\n\n    /**\n     * Checks point is inside the object.\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @param {fabric.Object} obj Object to test against\n     * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n     * @return {Boolean} true if point is contained within an area of given object\n     * @private\n     */\n    _checkTarget: function(pointer, obj, globalPointer) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n          // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n          (obj.containsPoint(pointer) || !!obj._findTargetCorner(pointer))\n      ) {\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, globalPointer.x, globalPointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n     * @param {Array} [objects] objects array to look into\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @return {fabric.Object} object that contains pointer\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // until we call this function specifically to search inside the activeGroup\n      while (i--) {\n        var objToCheck = objects[i];\n        var pointerToUse = objToCheck.group ?\n          this._normalizePointer(objToCheck.group, pointer) : pointer;\n        if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\n          target = objects[i];\n          if (target.subTargetCheck && target instanceof fabric.Group) {\n            subTarget = this._searchPossibleTargets(target._objects, pointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * ignoreZoom true = HTMLElement coordinates relative to top,left\n     * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom) {\n      // return cached values if we are in the event processing chain\n      if (this._absolutePointer && !ignoreZoom) {\n        return this._absolutePointer;\n      }\n      if (this._pointer && ignoreZoom) {\n        return this._pointer;\n      }\n\n      var pointer = getPointer(e),\n          upperCanvasEl = this.upperCanvasEl,\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      var retinaScaling = this.getRetinaScaling();\n      if (retinaScaling !== 1) {\n        pointer.x /= retinaScaling;\n        pointer.y /= retinaScaling;\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, ''),\n          lowerCanvasEl = this.lowerCanvasEl, upperCanvasEl = this.upperCanvasEl;\n\n      // there is no need to create a new upperCanvas element if we have already one.\n      if (upperCanvasEl) {\n        upperCanvasEl.className = '';\n      }\n      else {\n        upperCanvasEl = this._createCanvasElement();\n        this.upperCanvasEl = upperCanvasEl;\n      }\n      fabric.util.addClass(upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(upperCanvasEl);\n\n      this._copyCanvasStyle(lowerCanvasEl, upperCanvasEl);\n      this._applyCanvasStyle(upperCanvasEl);\n      this.contextTop = upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.width + 'px',\n        height: this.height + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.width || element.width,\n          height = this.height || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': this.allowTouchScrolling ? 'manipulation' : 'none',\n        '-ms-touch-action': this.allowTouchScrolling ? 'manipulation' : 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copy the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * Returns an array with the current selected objects\n     * @return {fabric.Object} active object\n     */\n    getActiveObjects: function () {\n      var active = this._activeObject;\n      if (active) {\n        if (active.type === 'activeSelection' && active._objects) {\n          return active._objects.slice(0);\n        }\n        else {\n          return [active];\n        }\n      }\n      return [];\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (obj === this._activeObject) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (obj === this._hoveredTarget){\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     * Compares the old activeObject with the current one and fires correct events\n     * @param {fabric.Object} obj old activeObject\n     */\n    _fireSelectionEvents: function(oldObjects, e) {\n      var somethingChanged = false, objects = this.getActiveObjects(),\n          added = [], removed = [], opt = { e: e };\n      oldObjects.forEach(function(oldObject) {\n        if (objects.indexOf(oldObject) === -1) {\n          somethingChanged = true;\n          oldObject.fire('deselected', opt);\n          removed.push(oldObject);\n        }\n      });\n      objects.forEach(function(object) {\n        if (oldObjects.indexOf(object) === -1) {\n          somethingChanged = true;\n          object.fire('selected', opt);\n          added.push(object);\n        }\n      });\n      if (oldObjects.length > 0 && objects.length > 0) {\n        opt.selected = added;\n        opt.deselected = removed;\n        // added for backward compatibility\n        opt.updated = added[0] || removed[0];\n        opt.target = this._activeObject;\n        somethingChanged && this.fire('selection:updated', opt);\n      }\n      else if (objects.length > 0) {\n        opt.selected = added;\n        // added for backward compatibility\n        opt.target = this._activeObject;\n        this.fire('selection:created', opt);\n      }\n      else if (oldObjects.length > 0) {\n        opt.deselected = removed;\n        this.fire('selection:cleared', opt);\n      }\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActives = this.getActiveObjects();\n      this._setActiveObject(object, e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Object} object to set as active\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {Boolean} true if the selection happened\n     */\n    _setActiveObject: function(object, e) {\n      if (this._activeObject === object) {\n        return false;\n      }\n      if (!this._discardActiveObject(e, object)) {\n        return false;\n      }\n      if (object.onSelect({ e: e })) {\n        return false;\n      }\n      this._activeObject = object;\n      return true;\n    },\n\n    /**\n     * @private\n     */\n    _discardActiveObject: function(e, object) {\n      var obj = this._activeObject;\n      if (obj) {\n        // onDeselect return TRUE to cancel selection;\n        if (obj.onDeselect({ e: e, object: object })) {\n          return false;\n        }\n        this._activeObject = null;\n      }\n      return true;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parameter and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var currentActives = this.getActiveObjects(), activeObject = this.getActiveObject();\n      if (currentActives.length) {\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\n      }\n      this._discardActiveObject(e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      this.contextCache = null;\n      this.contextTop = null;\n      ['upperCanvasEl', 'cacheCanvasEl'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      fabric.StaticCanvas.prototype.dispose.call(this);\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      // this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeObject = this._activeObject;\n\n      if (activeObject) {\n        activeObject._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group.type === 'activeSelection' && this._activeObject === instance.group) {\n        var layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        //Copy all the positionally relevant properties across now\n        var originalValues = {};\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        this._activeObject.realizeTransform(instance);\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      var originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n\n    setViewportTransform: function (vpt) {\n      if (this.renderOnAddRemove && this._activeObject && this._activeObject.isEditing) {\n        this._activeObject.clearContextTop();\n      }\n      fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\n    }\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n})();\n\n\n(function() {\n\n  var addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1,\n      addEventOptions = { passive: false };\n\n  function checkClick(e, value) {\n    return e.button && (e.button === value - 1);\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Contains the id of the touch event that owns the fabric transform\n     * @type Number\n     * @private\n     */\n    mainTouchId: null,\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n      this.addOrRemove(addListener, 'add');\n    },\n\n    /**\n     * return an event prefix pointer or mouse.\n     * @private\n     */\n    _getEventPrefix: function () {\n      return this.enablePointerEvents ? 'pointer' : 'mouse';\n    },\n\n    addOrRemove: function(functor, eventjsFunctor) {\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      functor(fabric.window, 'resize', this._onResize);\n      functor(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n      functor(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      functor(canvasElement, eventTypePrefix + 'out', this._onMouseOut);\n      functor(canvasElement, eventTypePrefix + 'enter', this._onMouseEnter);\n      functor(canvasElement, 'wheel', this._onMouseWheel);\n      functor(canvasElement, 'contextmenu', this._onContextMenu);\n      functor(canvasElement, 'dblclick', this._onDoubleClick);\n      functor(canvasElement, 'dragover', this._onDragOver);\n      functor(canvasElement, 'dragenter', this._onDragEnter);\n      functor(canvasElement, 'dragleave', this._onDragLeave);\n      functor(canvasElement, 'drop', this._onDrop);\n      if (!this.enablePointerEvents) {\n        functor(canvasElement, 'touchstart', this._onTouchStart, addEventOptions);\n      }\n      if (typeof eventjs !== 'undefined' && eventjsFunctor in eventjs) {\n        eventjs[eventjsFunctor](canvasElement, 'gesture', this._onGesture);\n        eventjs[eventjsFunctor](canvasElement, 'drag', this._onDrag);\n        eventjs[eventjsFunctor](canvasElement, 'orientation', this._onOrientationChange);\n        eventjs[eventjsFunctor](canvasElement, 'shake', this._onShake);\n        eventjs[eventjsFunctor](canvasElement, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      this.addOrRemove(removeListener, 'remove');\n      // if you dispose on a mouseDown, before mouse up, you need to clean document to...\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBound) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onTouchStart = this._onTouchStart.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onTouchEnd = this._onTouchEnd.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this._onDoubleClick = this._onDoubleClick.bind(this);\n      this._onDragOver = this._onDragOver.bind(this);\n      this._onDragEnter = this._simpleEventHandler.bind(this, 'dragenter');\n      this._onDragLeave = this._simpleEventHandler.bind(this, 'dragleave');\n      this._onDrop = this._simpleEventHandler.bind(this, 'drop');\n      this.eventsBound = true;\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n\n      var _this = this;\n      this._hoveredTargets.forEach(function(_target){\n        _this.fire('mouse:out', { target: target, e: e });\n        _target && target.fire('mouseout', { e: e });\n      });\n      this._hoveredTargets = [];\n\n      if (this._iTextInstances) {\n        this._iTextInstances.forEach(function(obj) {\n          if (obj.isEditing) {\n            obj.hiddenTextarea.focus();\n          }\n        });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      // This find target and consequent 'mouse:over' is used to\n      // clear old instances on hovered target.\n      // calling findTarget has the side effect of killing target.__corner.\n      // as a short term fix we are not firing this if we are currently transforming.\n      // as a long term fix we need to separate the action of finding a target with the\n      // side effects we added to it.\n      if (!this._currentTransform && !this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * prevent default to allow drop event to be fired\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     */\n    _onDragOver: function(e) {\n      e.preventDefault();\n      var target = this._simpleEventHandler('dragover', e);\n      this._fireEnterLeaveEvents(target, e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onDoubleClick: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'dblclick');\n      this._resetTransformEventData(e);\n    },\n\n    /**\n     * Return a the id of an event.\n     * returns either the pointerId or the identifier or 0 for the mouse event\n     * @private\n     * @param {Event} evt Event object\n     */\n    getPointerId: function(evt) {\n      var changedTouches = evt.changedTouches;\n\n      if (changedTouches) {\n        return changedTouches[0] && changedTouches[0].identifier;\n      }\n\n      if (this.enablePointerEvents) {\n        return evt.pointerId;\n      }\n\n      return -1;\n    },\n\n    /**\n     * Determines if an event has the id of the event that is considered main\n     * @private\n     * @param {evt} event Event object\n     */\n    _isMainEvent: function(evt) {\n      if (evt.isPrimary === true) {\n        return true;\n      }\n      if (evt.isPrimary === false) {\n        return false;\n      }\n      if (evt.type === 'touchend' && evt.touches.length === 0) {\n        return true;\n      }\n      if (evt.changedTouches) {\n        return evt.changedTouches[0].identifier === this.mainTouchId;\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchStart: function(e) {\n      e.preventDefault();\n      if (this.mainTouchId === null) {\n        this.mainTouchId = this.getPointerId(e);\n      }\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      addListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      addListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      // Unbind mousedown to prevent double triggers from touch devices\n      removeListener(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      removeListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      addListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      addListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchEnd: function(e) {\n      if (e.touches.length > 0) {\n        // if there are still touches stop here\n        return;\n      }\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      this.mainTouchId = null;\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      var _this = this;\n      if (this._willAddMouseDown) {\n        clearTimeout(this._willAddMouseDown);\n      }\n      this._willAddMouseDown = setTimeout(function() {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        addListener(_this.upperCanvasEl, eventTypePrefix + 'down', _this._onMouseDown);\n        _this._willAddMouseDown = 0;\n      }, 400);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      if (this._isMainEvent(e)) {\n        removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n        removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n        addListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     */\n    _shouldRender: function(target) {\n      var activeObject = this._activeObject;\n\n      if (\n        !!activeObject !== !!target ||\n        (activeObject && target && (activeObject !== target))\n      ) {\n        // this covers: switch of target, from target to no target, selection of target\n        // multiSelection with key and mouse\n        return true;\n      }\n      else if (activeObject && activeObject.isEditing) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return false;\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n      var target, transform = this._currentTransform,\n          groupSelector = this._groupSelector, shouldRender = false,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n      this._cacheTransformEventData(e);\n      target = this._target;\n      this._handleEvent(e, 'up:before');\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', RIGHT_CLICK, isClick);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', MIDDLE_CLICK, isClick);\n        }\n        this._resetTransformEventData();\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        shouldRender = transform.actionPerformed;\n      }\n      if (!isClick) {\n        var targetWasActive = target === this._activeObject;\n        this._maybeGroupObjects(e);\n        if (!shouldRender) {\n          shouldRender = (\n            this._shouldRender(target) ||\n            (!targetWasActive && target === this._activeObject)\n          );\n        }\n      }\n      if (target) {\n        var corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        var control = target.controls[corner],\n            mouseUpHandler = control && control.getMouseUpHandler(e, target, control);\n        if (mouseUpHandler) {\n          mouseUpHandler(e, target, control);\n        }\n        target.isMoving = false;\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', LEFT_CLICK, isClick);\n      this._groupSelector = null;\n      this._currentTransform = null;\n      // reset the target information about which corner is selected\n      target && (target.__corner = 0);\n      if (shouldRender) {\n        this.requestRenderAll();\n      }\n      else if (!isClick) {\n        this.renderTop();\n      }\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @return {Fabric.Object} target return the the target found, for internal reasons.\n     */\n    _simpleEventHandler: function(eventType, e) {\n      var target = this.findTarget(e),\n          targets = this.targets,\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n          };\n      this.fire(eventType, options);\n      target && target.fire(eventType, options);\n      if (!targets) {\n        return target;\n      }\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire(eventType, options);\n      }\n      return target;\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, button, isClick) {\n      var target = this._target,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false,\n            pointer: this._pointer,\n            absolutePointer: this._absolutePointer,\n            transform: this._currentTransform\n          };\n      if (eventType === 'up') {\n        options.currentTarget = this.findTarget(e);\n        options.currentSubTargets = this.targets;\n      }\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target,\n          eventName,\n          options = {\n            e: e,\n            target: target,\n            transform: transform,\n            action: transform.action,\n          };\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        if (transform.actionPerformed) {\n          // this is not friendly to the new control api.\n          // is deprecated.\n          eventName = this._addEventOptions(options, transform);\n          this._fire(eventName, options);\n        }\n        this._fire('modified', options);\n      }\n    },\n\n    /**\n     * Mutate option object in order to add by property and give back the event name.\n     * @private\n     * @deprecated since 4.2.0\n     * @param {Object} options to mutate\n     * @param {Object} transform to inspect action from\n     */\n    _addEventOptions: function(options, transform) {\n      // we can probably add more details at low cost\n      // scale change, rotation changes, translation changes\n      var eventName, by;\n      switch (transform.action) {\n        case 'scaleX':\n          eventName = 'scaled';\n          by = 'x';\n          break;\n        case 'scaleY':\n          eventName = 'scaled';\n          by = 'y';\n          break;\n        case 'skewX':\n          eventName = 'skewed';\n          by = 'x';\n          break;\n        case 'skewY':\n          eventName = 'skewed';\n          by = 'y';\n          break;\n        case 'scale':\n          eventName = 'scaled';\n          by = 'equally';\n          break;\n        case 'rotate':\n          eventName = 'rotated';\n          break;\n        case 'drag':\n          eventName = 'moved';\n          break;\n      }\n      options.by = by;\n      return eventName;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      if (this.getActiveObject()) {\n        this.discardActiveObject(e).requestRenderAll();\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer, { e: e, pointer: pointer });\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer, { e: e, pointer: pointer });\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      var pointer = this.getPointer(e);\n      this._isCurrentlyDrawing = this.freeDrawingBrush.onMouseUp({ e: e, pointer: pointer });\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'down:before');\n      var target = this._target;\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      var pointer = this._pointer;\n      // save pointer for check in __onMouseUp event\n      this._previousPointer = pointer;\n      var shouldRender = this._shouldRender(target),\n          shouldGroup = this._shouldGroup(e, target);\n      if (this._shouldClearSelection(e, target)) {\n        this.discardActiveObject(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this._activeObject;\n      }\n\n      if (this.selection && (!target ||\n        (!target.selectable && !target.isEditing && target !== this._activeObject))) {\n        this._groupSelector = {\n          ex: pointer.x,\n          ey: pointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        var alreadySelected = target === this._activeObject;\n        if (target.selectable) {\n          this.setActiveObject(target, e);\n        }\n        var corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        target.__corner = corner;\n        if (target === this._activeObject && (corner || !shouldGroup)) {\n          var control = target.controls[corner],\n              mouseDownHandler = control && control.getMouseDownHandler(e, target, control);\n          if (mouseDownHandler) {\n            mouseDownHandler(e, target, control);\n          }\n          this._setupCurrentTransform(e, target, alreadySelected);\n        }\n      }\n      this._handleEvent(e, 'down');\n      // we must renderAll so that we update the visuals\n      (shouldRender || shouldGroup) && this.requestRenderAll();\n    },\n\n    /**\n     * reset cache form common information needed during event processing\n     * @private\n     */\n    _resetTransformEventData: function() {\n      this._target = null;\n      this._pointer = null;\n      this._absolutePointer = null;\n    },\n\n    /**\n     * Cache common information needed during event processing\n     * @private\n     * @param {Event} e Event object fired on event\n     */\n    _cacheTransformEventData: function(e) {\n      // reset in order to avoid stale caching\n      this._resetTransformEventData();\n      this._pointer = this.getPointer(e, true);\n      this._absolutePointer = this.restorePointerVpt(this._pointer);\n      this._target = this._currentTransform ? this._currentTransform.target : this.findTarget(e) || null;\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e) {\n      var t = this._currentTransform;\n      this.stateful && t.target.saveState();\n      this.fire('before:transform', {\n        e: e,\n        transform: t,\n      });\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will define whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n      this._handleEvent(e, 'move:before');\n      this._cacheTransformEventData(e);\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this._pointer;\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e) || null;\n        this._setCursorFromEvent(e, target);\n        this._fireOverOutEvents(target, e);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * Manage the mouseout, mouseover events for the fabric object on the canvas\n     * @param {Fabric.Object} target the target where the target from the mousemove event\n     * @param {Event} e Event object fired on mousemove\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      var _hoveredTarget = this._hoveredTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _hoveredTarget,\n        evtOut: 'mouseout',\n        canvasEvtOut: 'mouse:out',\n        evtIn: 'mouseover',\n        canvasEvtIn: 'mouse:over',\n      });\n      for (var i = 0; i < length; i++){\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'mouseout',\n          evtIn: 'mouseover',\n        });\n      }\n      this._hoveredTarget = target;\n      this._hoveredTargets = this.targets.concat();\n    },\n\n    /**\n     * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the onDrag event\n     * @param {Event} e Event object fired on ondrag\n     * @private\n     */\n    _fireEnterLeaveEvents: function(target, e) {\n      var _draggedoverTarget = this._draggedoverTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _draggedoverTarget,\n        evtOut: 'dragleave',\n        evtIn: 'dragenter',\n      });\n      for (var i = 0; i < length; i++) {\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'dragleave',\n          evtIn: 'dragenter',\n        });\n      }\n      this._draggedoverTarget = target;\n    },\n\n    /**\n     * Manage the synthetic in/out events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the supported events\n     * @param {Event} e Event object fired\n     * @param {Object} config configuration for the function to work\n     * @param {String} config.targetName property on the canvas where the old target is stored\n     * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n     * @param {String} config.evtOut name of the event to fire for out\n     * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n     * @param {String} config.evtIn name of the event to fire for in\n     * @private\n     */\n    fireSyntheticInOutEvents: function(target, e, config) {\n      var inOpt, outOpt, oldTarget = config.oldTarget, outFires, inFires,\n          targetChanged = oldTarget !== target, canvasEvtIn = config.canvasEvtIn, canvasEvtOut = config.canvasEvtOut;\n      if (targetChanged) {\n        inOpt = { e: e, target: target, previousTarget: oldTarget };\n        outOpt = { e: e, target: oldTarget, nextTarget: target };\n      }\n      inFires = target && targetChanged;\n      outFires = oldTarget && targetChanged;\n      if (outFires) {\n        canvasEvtOut && this.fire(canvasEvtOut, outOpt);\n        oldTarget.fire(config.evtOut, outOpt);\n      }\n      if (inFires) {\n        canvasEvtIn && this.fire(canvasEvtIn, inOpt);\n        target.fire(config.evtIn, inOpt);\n      }\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'wheel');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n      transform.reset = false;\n      transform.target.isMoving = true;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._performTransformAction(e, transform, pointer);\n      transform.actionPerformed && this.requestRenderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          action = transform.action,\n          actionPerformed = false,\n          actionHandler = transform.actionHandler;\n          // this object could be created from the function in the control handlers\n\n\n      if (actionHandler) {\n        actionPerformed = actionHandler(e, transform, x, y);\n      }\n      if (action === 'drag' && actionPerformed) {\n        this.setCursor(transform.target.moveCursor || this.moveCursor);\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: fabric.controlsUtils.fireEvent,\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeSelection = this._activeObject && this._activeObject.type === 'activeSelection' ?\n            this._activeObject : null,\n          // only show proper corner when group selection is not active\n          corner = (!activeSelection || !activeSelection.contains(target))\n          // here we call findTargetCorner always with undefined for the touch parameter.\n          // we assume that if you are using a cursor you do not need to interact with\n          // the bigger touch area.\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        if (target.subTargetCheck){\n          // hoverCursor should come from top-most subTarget,\n          // so we walk the array backwards\n          this.targets.concat().reverse().map(function(_target){\n            hoverCursor = _target.hoverCursor || hoverCursor;\n          });\n        }\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this.setCursor(this.getCornerCursor(corner, target, e));\n      }\n    },\n\n    /**\n     * @private\n     */\n    getCornerCursor: function(corner, target, e) {\n      var control = target.controls[corner];\n      return control.cursorStyleHandler(e, control, target);\n    }\n  });\n})();\n\n\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this._activeObject;\n      return activeObject && this._isSelectionKeyPressed(e) && target && target.selectable && this.selection &&\n            (activeObject !== target || activeObject.type === 'activeSelection') && !target.onSelect({ e: e });\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeObject = this._activeObject;\n      // avoid multi select when shift click on a corner\n      if (activeObject.__corner) {\n        return;\n      }\n      if (target === activeObject) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found or we are on activeObjectCorner, bail out\n        if (!target || !target.selectable) {\n          return;\n        }\n      }\n      if (activeObject && activeObject.type === 'activeSelection') {\n        this._updateActiveSelection(target, e);\n      }\n      else {\n        this._createActiveSelection(target, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveSelection: function(target, e) {\n      var activeSelection = this._activeObject,\n          currentActiveObjects = activeSelection._objects.slice(0);\n      if (activeSelection.contains(target)) {\n        activeSelection.removeWithUpdate(target);\n        this._hoveredTarget = target;\n        this._hoveredTargets = this.targets.concat();\n        if (activeSelection.size() === 1) {\n          // activate last remaining object\n          this._setActiveObject(activeSelection.item(0), e);\n        }\n      }\n      else {\n        activeSelection.addWithUpdate(target);\n        this._hoveredTarget = activeSelection;\n        this._hoveredTargets = this.targets.concat();\n      }\n      this._fireSelectionEvents(currentActiveObjects, e);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveSelection: function(target, e) {\n      var currentActives = this.getActiveObjects(), group = this._createGroup(target);\n      this._hoveredTarget = group;\n      // ISSUE 4115: should we consider subTargets here?\n      // this._hoveredTargets = [];\n      // this._hoveredTargets = this.targets.concat();\n      this._setActiveObject(group, e);\n      this._fireSelectionEvents(currentActives, e);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n      var objects = this._objects,\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.ActiveSelection(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects(e),\n          aGroup;\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        aGroup = new fabric.ActiveSelection(group.reverse(), {\n          canvas: this\n        });\n        this.setActiveObject(aGroup, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function(e) {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          allowIntersect = !this.selectionFullyContained,\n          isClick = x1 === x2 && y1 === y2;\n      // we iterate reverse order to collect top first in case of click.\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\n          continue;\n        }\n\n        if ((allowIntersect && currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2)) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1)) ||\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2))\n        ) {\n          group.push(currentObject);\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      if (group.length > 1) {\n        group = group.filter(function(object) {\n          return !object.onSelect({ e: e });\n        });\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n      this.setCursor(this.defaultCursor);\n      // clear selection and current transformation\n      this._groupSelector = null;\n    }\n  });\n\n})();\n\n\n(function () {\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? this.getRetinaScaling() : 1),\n          canvasEl = this.toCanvasElement(multiplier, options);\n      return fabric.util.toDataURL(canvasEl, format, quality);\n    },\n\n    /**\n     * Create a new HTMLCanvas element painted with the current canvas content.\n     * No need to resize the actual one or repaint it.\n     * Will transfer object ownership to a new canvas, paint it, and set everything back.\n     * This is an intermediary step used to get to a dataUrl but also it is useful to\n     * create quick image copies of a canvas without passing for the dataUrl string\n     * @param {Number} [multiplier] a zoom factor.\n     * @param {Object} [cropping] Cropping informations\n     * @param {Number} [cropping.left] Cropping left offset.\n     * @param {Number} [cropping.top] Cropping top offset.\n     * @param {Number} [cropping.width] Cropping width.\n     * @param {Number} [cropping.height] Cropping height.\n     */\n    toCanvasElement: function(multiplier, cropping) {\n      multiplier = multiplier || 1;\n      cropping = cropping || { };\n      var scaledWidth = (cropping.width || this.width) * multiplier,\n          scaledHeight = (cropping.height || this.height) * multiplier,\n          zoom = this.getZoom(),\n          originalWidth = this.width,\n          originalHeight = this.height,\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - (cropping.left || 0)) * multiplier,\n          translateY = (vp[5] - (cropping.top || 0)) * multiplier,\n          originalInteractive = this.interactive,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalRetina = this.enableRetinaScaling,\n          canvasEl = fabric.util.createCanvasElement(),\n          originalContextTop = this.contextTop;\n      canvasEl.width = scaledWidth;\n      canvasEl.height = scaledHeight;\n      this.contextTop = null;\n      this.enableRetinaScaling = false;\n      this.interactive = false;\n      this.viewportTransform = newVp;\n      this.width = scaledWidth;\n      this.height = scaledHeight;\n      this.calcViewportBoundaries();\n      this.renderCanvas(canvasEl.getContext('2d'), this._objects);\n      this.viewportTransform = vp;\n      this.width = originalWidth;\n      this.height = originalHeight;\n      this.calcViewportBoundaries();\n      this.interactive = originalInteractive;\n      this.enableRetinaScaling = originalRetina;\n      this.contextTop = originalContextTop;\n      return canvasEl;\n    },\n  });\n\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        clipPath = serialized.clipPath,\n        renderOnAddRemove = this.renderOnAddRemove;\n\n    this.renderOnAddRemove = false;\n\n    delete serialized.clipPath;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        if (clipPath) {\n          _this._enlivenObjects([clipPath], function (enlivenedCanvasClip) {\n            _this.clipPath = enlivenedCanvasClip[0];\n            _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n          });\n        }\n        else {\n          _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n        }\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Array} restored canvas objects\n   * @param {Function} cached renderOnAddRemove callback\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  __setupCanvas: function(serialized, enlivenedObjects, renderOnAddRemove, callback) {\n    var _this = this;\n    enlivenedObjects.forEach(function(obj, index) {\n      // we splice the array just in case some custom classes restored from JSON\n      // will add more object to canvas at canvas init.\n      _this.insertAt(obj, index);\n    });\n    this.renderOnAddRemove = renderOnAddRemove;\n    // remove parts i cannot set as options\n    delete serialized.objects;\n    delete serialized.backgroundImage;\n    delete serialized.overlayImage;\n    delete serialized.background;\n    delete serialized.overlay;\n    // this._initOptions does too many things to just\n    // call it. Normally loading an Object from JSON\n    // create the Object instance. Here the Canvas is\n    // already an instance and we are just loading things over it\n    this._setOptions(serialized);\n    this.renderAll();\n    callback && callback();\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.util.createCanvasElement();\n\n    el.width = this.width;\n    el.height = this.height;\n\n    var clone = new fabric.Canvas(el);\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * Size of object's controlling corners when touch interaction is detected\n     * @type Number\n     * @default\n     */\n    touchCornerSize:               24,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgb(178,204,255)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgb(178,204,255)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line offset of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeDashOffset: 0,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevil\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         4,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * bigger number will make a thicker border\n     * border is 1, so this is basically a border tickness\n     * since there is no way to change the border itself.\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in OBJECT/JSON\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * When `false`, object is not cached unless necessary ( clipPath )\n     * default to true\n     * @since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When `false`, the stoke width will scale with the object.\n     * When `true`, the stroke will always match the exact pixel size entered for stroke width.\n     * default to false\n     * @since 2.6.0\n     * @type Boolean\n     * @default false\n     * @type Boolean\n     * @default false\n     */\n    strokeUniform:              false,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * keeps the value of the last hovered corner during mouse move.\n     * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n     * It should be private, but there is no harm in using it as\n     * a read-only property.\n     * @type number|string|any\n     * @default 0\n     */\n    __corner: 0,\n\n    /**\n     * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n     * @type String\n     * @default\n     */\n    paintFirst:           'fill',\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow visible backgroundColor ' +\n      'skewX skewY fillRule paintFirst clipPath strokeUniform'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform' +\n      ' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath'\n    ).split(' '),\n\n    /**\n     * List of properties to consider for animating colors.\n     * @type Array\n     */\n    colorProperties: (\n      'fill stroke backgroundColor'\n    ).split(' '),\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the object has rendered, and the context is placed in the center\n     * of the object cacheCanvas.\n     * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will make the object clip to the outside of the clipPath\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    inverted: false,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will have its top and left relative to canvas, and will\n     * not be influenced by the object transform. This will make the clipPath relative\n     * to the canvas, but clipping just a particular object.\n     * WARNING this is beta, this feature may change or be renamed.\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    absolutePositioned: false,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.util.createCanvasElement();\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n      // if canvas gets created, is empty, so dirty.\n      this.dirty = true;\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          width = dims.width, height = dims.height,\n          max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit;\n      if (width <= max && height <= max && width * height <= perfLimitSizeTotal) {\n        if (width < min) {\n          dims.width = min;\n        }\n        if (height < min) {\n          dims.height = min;\n        }\n        return dims;\n      }\n      var ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\n          capValue = fabric.util.capValue,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n        dims.capped = true;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n        dims.capped = true;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.x width of object to be cached\n     * @return {Object}.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var objectScale = this.getTotalObjectScaling(),\n          // caculate dimensions without skewing\n          dim = this._getTransformedDimensions(0, 0),\n          neededX = dim.x * objectScale.scaleX / this.scaleX,\n          neededY = dim.y * objectScale.scaleY / this.scaleY;\n      return {\n        // for sure this ALIASING_LIMIT is slightly creating problem\n        // in situation in which the cache canvas gets an upper limit\n        // also objectScale contains already scaleX and scaleY\n        width: neededX + ALIASING_LIMIT,\n        height: neededY + ALIASING_LIMIT,\n        zoomX: objectScale.scaleX,\n        zoomY: objectScale.scaleY,\n        x: neededX,\n        y: neededY\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      var targetCanvas = this.canvas;\n      if (this.noScaleCache && targetCanvas && targetCanvas._currentTransform) {\n        var target = targetCanvas._currentTransform.target,\n            action = targetCanvas._currentTransform.action;\n        if (this === target && action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var canvas = this._cacheCanvas,\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height, drawingWidth, drawingHeight,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing && !dims.capped && (width > minCacheSize || height > minCacheSize)) {\n          additionalWidth = width * 0.1;\n          additionalHeight = height * 0.1;\n        }\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          canvas.width = Math.ceil(width + additionalWidth);\n          canvas.height = Math.ceil(height + additionalHeight);\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        drawingWidth = dims.x / 2;\n        drawingHeight = dims.y / 2;\n        this.cacheTranslationX = Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\n        this.cacheTranslationY = Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     */\n    transform: function(ctx) {\n      var needFullTransform = (this.group && !this.group._transformDone) ||\n         (this.group && this.canvas && ctx === this.canvas.contextTop);\n      var m = this.calcTransformMatrix(!needFullTransform);\n      ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            version:                  fabric.version,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeDashOffset:         this.strokeDashOffset,\n            strokeLineJoin:           this.strokeLineJoin,\n            // strokeUniform:            this.strokeUniform,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.angle, NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            paintFirst:               this.paintFirst,\n            globalCompositeOperation: this.globalCompositeOperation,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS),\n          };\n\n      if (this.clipPath) {\n        object.clipPath = this.clipPath.toObject(propertiesToInclude);\n        object.clipPath.inverted = this.clipPath.inverted;\n        object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\n      }\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (prop === 'left' || prop === 'top') {\n          return;\n        }\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        var isArray = Object.prototype.toString.call(object[prop]) === '[object Array]' &&\n                      Object.prototype.toString.call(prototype[prop]) === '[object Array]';\n\n        // basically a check for [] === []\n        if (isArray && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      var options = fabric.util.qrDecompose(this.calcTransformMatrix());\n      return { scaleX: Math.abs(options.scaleX), scaleY: Math.abs(options.scaleY) };\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling, zoom and retina\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getTotalObjectScaling: function() {\n      var scale = this.getObjectScaling(), scaleX = scale.scaleX, scaleY = scale.scaleY;\n      if (this.canvas) {\n        var zoom = this.canvas.getZoom();\n        var retina = this.canvas.getRetinaScaling();\n        scaleX *= zoom * retina;\n        scaleY *= zoom * retina;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * Return the object opacity counting also the group property\n     * @return {Number}\n     */\n    getObjectOpacity: function() {\n      var opacity = this.opacity;\n      if (this.group) {\n        opacity *= this.group.getObjectOpacity();\n      }\n      return opacity;\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY'),\n          isChanged = this[key] !== value, groupNeedsUpdate = false;\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (isChanged) {\n        groupNeedsUpdate = this.group && this.group.isOnACache();\n        if (this.cacheProperties.indexOf(key) > -1) {\n          this.dirty = true;\n          groupNeedsUpdate && this.group.set('dirty', true);\n        }\n        else if (groupNeedsUpdate && this.stateProperties.indexOf(key) > -1) {\n          this.group.set('dirty', true);\n        }\n      }\n\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Array}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 ||\n        (!this.width && !this.height && this.strokeWidth === 0) ||\n        !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      this.transform(ctx);\n      this._setOpacity(ctx);\n      this._setShadow(ctx, this);\n      if (this.shouldCache()) {\n        this.renderCache();\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this._removeCacheCanvas();\n        this.dirty = false;\n        this.drawObject(ctx);\n        if (this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      ctx.restore();\n    },\n\n    renderCache: function(options) {\n      options = options || {};\n      if (!this._cacheCanvas) {\n        this._createCacheCanvas();\n      }\n      if (this.isCacheDirty()) {\n        this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n        this.drawObject(this._cacheContext, options.forClipping);\n        this.dirty = false;\n      }\n    },\n\n    /**\n     * Remove cacheCanvas and its dimensions from the objects\n     */\n    _removeCacheCanvas: function() {\n      this._cacheCanvas = null;\n      this.cacheWidth = 0;\n      this.cacheHeight = 0;\n    },\n\n    /**\n     * return true if the object will draw a stroke\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an aproximation and be fast.\n     * wrote to avoid extra caching, it has to return true when stroke happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the stroke is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasStroke: function() {\n      return this.stroke && this.stroke !== 'transparent' && this.strokeWidth !== 0;\n    },\n\n    /**\n     * return true if the object will draw a fill\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an aproximation and be fast.\n     * wrote to avoid extra caching, it has to return true when fill happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the fill is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasFill: function() {\n      return this.fill && this.fill !== 'transparent';\n    },\n\n    /**\n     * When set to `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * Created to be overridden\n     * since 1.7.12\n     * @returns Boolean\n     */\n    needsItsOwnCache: function() {\n      if (this.paintFirst === 'stroke' &&\n        this.hasFill() && this.hasStroke() && typeof this.shadow === 'object') {\n        return true;\n      }\n      if (this.clipPath) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      this.ownCaching = this.needsItsOwnCache() || (\n        this.objectCaching &&\n        (!this.group || !this.group.isOnACache())\n      );\n      return this.ownCaching;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object clipPath\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCache: function(ctx) {\n      var path = this.clipPath;\n      ctx.save();\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4\n      if (path.inverted) {\n        ctx.globalCompositeOperation = 'destination-out';\n      }\n      else {\n        ctx.globalCompositeOperation = 'destination-in';\n      }\n      //ctx.scale(1 / 2, 1 / 2);\n      if (path.absolutePositioned) {\n        var m = fabric.util.invertTransform(this.calcTransformMatrix());\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx, forClipping) {\n      var originalFill = this.fill, originalStroke = this.stroke;\n      if (forClipping) {\n        this.fill = 'black';\n        this.stroke = '';\n        this._setClippingProperties(ctx);\n      }\n      else {\n        this._renderBackground(ctx);\n        this._setStrokeStyles(ctx, this);\n        this._setFillStyles(ctx, this);\n      }\n      this._render(ctx);\n      this._drawClipPath(ctx);\n      this.fill = originalFill;\n      this.stroke = originalStroke;\n    },\n\n    _drawClipPath: function(ctx) {\n      var path = this.clipPath;\n      if (!path) { return; }\n      // needed to setup a couple of variables\n      // path canvas gets overridden with this one.\n      // TODO find a better solution?\n      path.canvas = this.canvas;\n      path.shouldCache();\n      path._transformDone = true;\n      path.renderCache({ forClipping: true });\n      this.drawClipPathOnCache(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty ||\n          (this.clipPath && this.clipPath.absolutePositioned) ||\n          (this.statefullCache && this.hasStateChanged('cacheProperties'))\n        ) {\n          if (this._cacheCanvas && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untransformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      if (this.group && !this.group._transformDone) {\n        ctx.globalAlpha = this.getObjectOpacity();\n      }\n      else {\n        ctx.globalAlpha *= this.opacity;\n      }\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      if (decl.stroke) {\n        ctx.lineWidth = decl.strokeWidth;\n        ctx.lineCap = decl.strokeLineCap;\n        ctx.lineDashOffset = decl.strokeDashOffset;\n        ctx.lineJoin = decl.strokeLineJoin;\n        ctx.miterLimit = decl.strokeMiterLimit;\n        ctx.strokeStyle = decl.stroke.toLive\n          ? decl.stroke.toLive(ctx, this)\n          : decl.stroke;\n      }\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      if (decl.fill) {\n        ctx.fillStyle = decl.fill.toLive\n          ? decl.fill.toLive(ctx, this)\n          : decl.fill;\n      }\n    },\n\n    _setClippingProperties: function(ctx) {\n      ctx.globalAlpha = 1;\n      ctx.strokeStyle = 'transparent';\n      ctx.fillStyle = '#000000';\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     * @param {Function} alternative function to call if browser does not support lineDash\n     */\n    _setLineDash: function(ctx, dashArray, alternative) {\n      if (!dashArray || dashArray.length === 0) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      if (supportsLineDash) {\n        ctx.setLineDash(dashArray);\n      }\n      else {\n        alternative && alternative(ctx);\n      }\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     */\n    _renderControls: function(ctx, styleOverride) {\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options, drawBorders, drawControls;\n      styleOverride = styleOverride || { };\n      drawBorders = typeof styleOverride.hasBorders !== 'undefined' ? styleOverride.hasBorders : this.hasBorders;\n      drawControls = typeof styleOverride.hasControls !== 'undefined' ? styleOverride.hasControls : this.hasControls;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (styleOverride.forActiveSelection) {\n        ctx.rotate(degreesToRadians(options.angle));\n        drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\n      }\n      else {\n        ctx.rotate(degreesToRadians(this.angle));\n        drawBorders && this.drawBorders(ctx, styleOverride);\n      }\n      drawControls && this.drawControls(ctx, styleOverride);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var shadow = this.shadow, canvas = this.canvas, scaling,\n          multX = (canvas && canvas.viewportTransform[0]) || 1,\n          multY = (canvas && canvas.viewportTransform[3]) || 1;\n      if (shadow.nonScaling) {\n        scaling = { scaleX: 1, scaleY: 1 };\n      }\n      else {\n        scaling = this.getObjectScaling();\n      }\n      if (canvas && canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = shadow.color;\n      ctx.shadowBlur = shadow.blur * fabric.browserShadowBlurConstant *\n        (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     * @return {Object} offset.offsetX offset for text rendering\n     * @return {Object} offset.offsetY offset for text rendering\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler || !filler.toLive) {\n        return { offsetX: 0, offsetY: 0 };\n      }\n      var t = filler.gradientTransform || filler.patternTransform;\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n\n      if (filler.gradientUnits === 'percentage') {\n        ctx.transform(this.width, 0, 0, this.height, offsetX, offsetY);\n      }\n      else {\n        ctx.transform(1, 0, 0, 1, offsetX, offsetY);\n      }\n      if (t) {\n        ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\n      }\n      return { offsetX: offsetX, offsetY: offsetY };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderPaintInOrder: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderStroke(ctx);\n        this._renderFill(ctx);\n      }\n      else {\n        this._renderFill(ctx);\n        this._renderStroke(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * function that actually render something on the context.\n     * empty here to allow Obects to work on tests to benchmark fabric functionalites\n     * not related to rendering\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(/* ctx */) {\n\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._applyPatternGradientTransform(ctx, this.fill);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      if (this.strokeUniform && this.group) {\n        var scaling = this.getObjectScaling();\n        ctx.scale(1 / scaling.scaleX, 1 / scaling.scaleY);\n      }\n      else if (this.strokeUniform) {\n        ctx.scale(1 / this.scaleX, 1 / this.scaleY);\n      }\n      this._setLineDash(ctx, this.strokeDashArray, this._renderDashedStroke);\n      if (this.stroke.toLive && this.stroke.gradientUnits === 'percentage') {\n        // need to transform gradient in a pattern.\n        // this is a slow process. If you are hitting this codepath, and the object\n        // is not using caching, you should consider switching it on.\n        // we need a canvas as big as the current object caching canvas.\n        this._applyPatternForTransformedGradient(ctx, this.stroke);\n      }\n      else {\n        this._applyPatternGradientTransform(ctx, this.stroke);\n      }\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     */\n    _applyPatternForTransformedGradient: function(ctx, filler) {\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          pCanvas = fabric.util.createCanvasElement(), pCtx, retinaScaling = this.canvas.getRetinaScaling(),\n          width = dims.x / this.scaleX / retinaScaling, height = dims.y / this.scaleY / retinaScaling;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.scale(\n        dims.zoomX / this.scaleX / retinaScaling,\n        dims.zoomY / this.scaleY / retinaScaling\n      );\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fillStyle = filler.toLive(ctx);\n      pCtx.fill();\n      ctx.translate(-this.width / 2 - this.strokeWidth / 2, -this.height / 2 - this.strokeWidth / 2);\n      ctx.scale(\n        retinaScaling * this.scaleX / dims.zoomX,\n        retinaScaling * this.scaleY / dims.zoomY\n      );\n      ctx.strokeStyle = pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\n    },\n\n    /**\n     * This function is an helper for svg import. it decompose the transformMatrix\n     * and assign properties to object.\n     * untransformed coordinates\n     * @private\n     * @chainable\n     */\n    _assignTransformMatrixProps: function() {\n      if (this.transformMatrix) {\n        var options = fabric.util.qrDecompose(this.transformMatrix);\n        this.flipX = false;\n        this.flipY = false;\n        this.set('scaleX', options.scaleX);\n        this.set('scaleY', options.scaleY);\n        this.angle = options.angle;\n        this.skewX = options.skewX;\n        this.skewY = 0;\n      }\n    },\n\n    /**\n     * This function is an helper for svg import. it removes the transform matrix\n     * and set to object properties that fabricjs can handle\n     * @private\n     * @param {Object} preserveAspectRatioOptions\n     * @return {thisArg}\n     */\n    _removeTransformMatrix: function(preserveAspectRatioOptions) {\n      var center = this._findCenterFromElement();\n      if (this.transformMatrix) {\n        this._assignTransformMatrixProps();\n        center = fabric.util.transformPoint(center, this.transformMatrix);\n      }\n      this.transformMatrix = null;\n      if (preserveAspectRatioOptions) {\n        this.scaleX *= preserveAspectRatioOptions.scaleX;\n        this.scaleY *= preserveAspectRatioOptions.scaleY;\n        this.cropX = preserveAspectRatioOptions.cropX;\n        this.cropY = preserveAspectRatioOptions.cropY;\n        center.x += preserveAspectRatioOptions.offsetLeft;\n        center.y += preserveAspectRatioOptions.offsetTop;\n        this.width = preserveAspectRatioOptions.width;\n        this.height = preserveAspectRatioOptions.height;\n      }\n      this.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * Clones an instance, using a callback method will work for every object.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     */\n    clone: function(callback, propertiesToInclude) {\n      var objectForm = this.toObject(propertiesToInclude);\n      if (this.constructor.fromObject) {\n        this.constructor.fromObject(objectForm, callback);\n      }\n      else {\n        fabric.Object._fromObject('Object', objectForm, callback);\n      }\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * could make use of both toDataUrl or toCanvasElement.\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var canvasEl = this.toCanvasElement(options);\n      if (callback) {\n        callback(new fabric.Image(canvasEl));\n      }\n      return this;\n    },\n\n    /**\n     * Converts an object into a HTMLCanvas element\n     * @param {Object} options Options object\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\n     */\n    toCanvasElement: function(options) {\n      options || (options = { });\n\n      var utils = fabric.util, origParams = utils.saveObjectTransform(this),\n          originalGroup = this.group,\n          originalShadow = this.shadow, abs = Math.abs,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? fabric.devicePixelRatio : 1);\n      delete this.group;\n      if (options.withoutTransform) {\n        utils.resetObjectTransform(this);\n      }\n      if (options.withoutShadow) {\n        this.shadow = null;\n      }\n\n      var el = fabric.util.createCanvasElement(),\n          // skip canvas zoom and calculate with setCoords now.\n          boundingRect = this.getBoundingRect(true, true),\n          shadow = this.shadow, scaling,\n          shadowOffset = { x: 0, y: 0 }, shadowBlur,\n          width, height;\n\n      if (shadow) {\n        shadowBlur = shadow.blur;\n        if (shadow.nonScaling) {\n          scaling = { scaleX: 1, scaleY: 1 };\n        }\n        else {\n          scaling = this.getObjectScaling();\n        }\n        // consider non scaling shadow.\n        shadowOffset.x = 2 * Math.round(abs(shadow.offsetX) + shadowBlur) * (abs(scaling.scaleX));\n        shadowOffset.y = 2 * Math.round(abs(shadow.offsetY) + shadowBlur) * (abs(scaling.scaleY));\n      }\n      width = boundingRect.width + shadowOffset.x;\n      height = boundingRect.height + shadowOffset.y;\n      // if the current width/height is not an integer\n      // we need to make it so.\n      el.width = Math.ceil(width);\n      el.height = Math.ceil(height);\n      var canvas = new fabric.StaticCanvas(el, {\n        enableRetinaScaling: false,\n        renderOnAddRemove: false,\n        skipOffscreen: false,\n      });\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n      this.setPositionByOrigin(new fabric.Point(canvas.width / 2, canvas.height / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var canvasEl = canvas.toCanvasElement(multiplier || 1, options);\n      this.shadow = originalShadow;\n      this.set('canvas', originalCanvas);\n      if (originalGroup) {\n        this.group = originalGroup;\n      }\n      this.set(origParams).setCoords();\n      // canvas.dispose will call image.dispose that will nullify the elements\n      // since this canvas is a simple element for the process, we remove references\n      // to objects in this way in order to avoid object trashing.\n      canvas._objects = [];\n      canvas.dispose();\n      canvas = null;\n\n      return canvasEl;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n      return fabric.util.toDataURL(this.toCanvasElement(options), options.format || 'png', options.quality || 1);\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets \"angle\" of an instance with centered rotation\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    rotate: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specified using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    }\n  });\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  fabric.Object._fromObject = function(className, object, callback, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n      if (typeof patterns[0] !== 'undefined') {\n        object.fill = patterns[0];\n      }\n      if (typeof patterns[1] !== 'undefined') {\n        object.stroke = patterns[1];\n      }\n      fabric.util.enlivenObjects([object.clipPath], function(enlivedProps) {\n        object.clipPath = enlivedProps[0];\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    });\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getScaledWidth(),\n          xFull = fabric.util.cos(angle) * hypotFull,\n          yFull = fabric.util.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n  });\n\n})();\n\n\n(function() {\n\n  function arrayFromCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var util = fabric.util,\n      degreesToRadians = util.degreesToRadians,\n      multiplyMatrices = util.multiplyTransformMatrices,\n      transformPoint = util.transformPoint;\n\n  util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are depending on control keys and padding the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from the controls positionHandler and are used\n     * to draw and locate controls\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are useful to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcACoords();\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * includes padding. Used of object detection.\n     * set and refreshed with setCoords and calcCoords.\n     * @memberOf fabric.Object.prototype\n     */\n    lineCoords: null,\n\n    /**\n     * storage for object transform matrix\n     */\n    ownMatrixCache: null,\n\n    /**\n     * storage for object full transform matrix\n     */\n    matrixCache: null,\n\n    /**\n     * custom controls interface\n     * controls are added by default_controls.js\n     */\n    controls: { },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * @param {Boolean} absolute will return aCoords if true or lineCoords\n     * @return {Object} {tl, tr, br, bl} points\n     */\n    _getCoords: function(absolute, calculate) {\n      if (calculate) {\n        return (absolute ? this.calcACoords() : this.calcLineCoords());\n      }\n      if (!this.aCoords || !this.lineCoords) {\n        this.setCoords(true);\n      }\n      return (absolute ? this.aCoords : this.lineCoords);\n    },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * The coords are returned in an array.\n     * @return {Array} [tl, tr, br, bl] of points\n     */\n    getCoords: function(absolute, calculate) {\n      return arrayFromCoords(this._getCoords(absolute, calculate));\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n        this.getCoords(absolute, calculate),\n        other.getCoords(absolute, calculate)\n      );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          otherCoords = absolute ? other.aCoords : other.lineCoords,\n          i = 0, lines = other._getImageLines(otherCoords);\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var coords = this._getCoords(absolute, calculate),\n          lines = lines || this._getImageLines(coords),\n          xPoints = this._findCrossPoints(point, lines);\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appears on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\n     * @return {Boolean} true if object is fully or partially contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate);\n      // if some point is on screen, the object is on screen.\n      if (points.some(function(point) {\n        return point.x <= pointBR.x && point.x >= pointTL.x &&\n        point.y <= pointBR.y && point.y >= pointTL.y;\n      })) {\n        return true;\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Checks if the object contains the midpoint between canvas extremities\n     * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n     * @private\n     * @param {Fabric.Point} pointTL Top Left point\n     * @param {Fabric.Point} pointBR Top Right point\n     * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if the object contains the point\n     */\n    _containsCenterOfCanvas: function(pointTL, pointBR, calculate) {\n      // worst case scenario the object is so big that contains the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true, calculate)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Checks if object is partially contained within the canvas with current viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is partially contained within canvas\n     */\n    isPartiallyOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      var allPointsAreOutside = this.getCoords(true, calculate).every(function(point) {\n        return (point.x >= pointBR.x || point.x <= pointTL.x) &&\n        (point.y >= pointBR.y || point.y <= pointTL.y);\n      });\n      return allPointsAreOutside && this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n\n      var lines = {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n\n      // // debugging\n      // if (this.canvas.contextTop) {\n      //   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n      // }\n\n      return lines;\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n    // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intended as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object's bounding box counting transformations\n     * before 2.0 it was named getWidth();\n     * @return {Number} width value\n     */\n    getScaledWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * before 2.0 it was named getHeight();\n     * @return {Number} height value\n     */\n    getScaledHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      else if (value === 0) {\n        return 0.0001;\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      this._set('scaleX', value);\n      this._set('scaleY', value);\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).width / this.getScaledWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).height / this.getScaledHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    /**\n     * Calculates and returns the .coords of an object.\n     * unused by the library, only for the end dev.\n     * @return {Object} Object with tl, tr, br, bl ....\n     * @chainable\n     * @deprecated\n     */\n    calcCoords: function(absolute) {\n      // this is a compatibility function to avoid removing calcCoords now.\n      if (absolute) {\n        return this.calcACoords();\n      }\n      return this.calcOCoords();\n    },\n\n    calcLineCoords: function() {\n      var vpt = this.getViewportTransform(),\n          padding = this.padding, angle = degreesToRadians(this.angle),\n          cos = util.cos(angle), sin = util.sin(angle),\n          cosP = cos * padding, sinP = sin * padding, cosPSinP = cosP + sinP,\n          cosPMinusSinP = cosP - sinP, aCoords = this.calcACoords();\n\n      var lineCoords = {\n        tl: transformPoint(aCoords.tl, vpt),\n        tr: transformPoint(aCoords.tr, vpt),\n        bl: transformPoint(aCoords.bl, vpt),\n        br: transformPoint(aCoords.br, vpt),\n      };\n\n      if (padding) {\n        lineCoords.tl.x -= cosPMinusSinP;\n        lineCoords.tl.y -= cosPSinP;\n        lineCoords.tr.x += cosPSinP;\n        lineCoords.tr.y -= cosPMinusSinP;\n        lineCoords.bl.x -= cosPSinP;\n        lineCoords.bl.y += cosPMinusSinP;\n        lineCoords.br.x += cosPMinusSinP;\n        lineCoords.br.y += cosPSinP;\n      }\n\n      return lineCoords;\n    },\n\n    calcOCoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          vpt = this.getViewportTransform(),\n          startMatrix = multiplyMatrices(vpt, translateMatrix),\n          finalMatrix = multiplyMatrices(startMatrix, rotateMatrix),\n          finalMatrix = multiplyMatrices(finalMatrix, [1 / vpt[0], 0, 0, 1 / vpt[3], 0, 0]),\n          dim = this._calculateCurrentDimensions(),\n          coords = {};\n      this.forEachControl(function(control, key, fabricObject) {\n        coords[key] = control.positionHandler(dim, finalMatrix, fabricObject);\n      });\n\n      // debug code\n      // var canvas = this.canvas;\n      // setTimeout(function() {\n      //   canvas.contextTop.clearRect(0, 0, 700, 700);\n      //   canvas.contextTop.fillStyle = 'green';\n      //   Object.keys(coords).forEach(function(key) {\n      //     var control = coords[key];\n      //     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\n      //   });\n      // }, 50);\n      return coords;\n    },\n\n    calcACoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          finalMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\n          dim = this._getTransformedDimensions(),\n          w = dim.x / 2, h = dim.y / 2;\n      return {\n        // corners\n        tl: transformPoint({ x: -w, y: -h }, finalMatrix),\n        tr: transformPoint({ x: w, y: -h }, finalMatrix),\n        bl: transformPoint({ x: -w, y: h }, finalMatrix),\n        br: transformPoint({ x: w, y: h }, finalMatrix)\n      };\n    },\n\n    /**\n     * Sets corner position coordinates based on current angle, width and height.\n     * oCoords are used to find the corners\n     * aCoords are used to quickly find an object on the canvas\n     * lineCoords are used to quickly find object during pointer events.\n     * See {@link https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords|When-to-call-setCoords}\n     * @param {Boolean} [skipCorners] skip calculation of oCoords.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(skipCorners) {\n      this.aCoords = this.calcACoords();\n      // in case we are in a group, for how the inner group target check works,\n      // lineCoords are exactly aCoords. Since the vpt gets absorbed by the normalized pointer.\n      this.lineCoords = this.group ? this.aCoords : this.calcLineCoords();\n      if (skipCorners) {\n        return this;\n      }\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      this.oCoords = this.calcOCoords();\n      this._setCornerCoords && this._setCornerCoords();\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      return util.calcRotateMatrix(this);\n    },\n\n    /**\n     * calculate the translation matrix for an object transform\n     * @return {Array} rotation matrix for the object\n     */\n    _calcTranslateMatrix: function() {\n      var center = this.getCenterPoint();\n      return [1, 0, 0, 1, center.x, center.y];\n    },\n\n    transformMatrixKey: function(skipGroup) {\n      var sep = '_', prefix = '';\n      if (!skipGroup && this.group) {\n        prefix = this.group.transformMatrixKey(skipGroup) + sep;\n      };\n      return prefix + this.top + sep + this.left + sep + this.scaleX + sep + this.scaleY +\n        sep + this.skewX + sep + this.skewY + sep + this.angle + sep + this.originX + sep + this.originY +\n        sep + this.width + sep + this.height + sep + this.strokeWidth + this.flipX + this.flipY;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties.\n     * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\n     * There are some situation in which this is useful to avoid the fake rotation.\n     * @return {Array} transform matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      var matrix = this.calcOwnMatrix();\n      if (skipGroup || !this.group) {\n        return matrix;\n      }\n      var key = this.transformMatrixKey(skipGroup), cache = this.matrixCache || (this.matrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      if (this.group) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(false), matrix);\n      }\n      cache.key = key;\n      cache.value = matrix;\n      return matrix;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties, this matrix does not include the group transformation\n     * @return {Array} transform matrix for the object\n     */\n    calcOwnMatrix: function() {\n      var key = this.transformMatrixKey(true), cache = this.ownMatrixCache || (this.ownMatrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      var tMatrix = this._calcTranslateMatrix(),\n          options = {\n            angle: this.angle,\n            translateX: tMatrix[4],\n            translateY: tMatrix[5],\n            scaleX: this.scaleX,\n            scaleY: this.scaleY,\n            skewX: this.skewX,\n            skewY: this.skewY,\n            flipX: this.flipX,\n            flipY: this.flipY,\n          };\n      cache.key = key;\n      cache.value = util.composeMatrix(options);\n      return cache.value;\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @deprecated since 3.4.0, please use fabric.util._calcDimensionsTransformMatrix\n     * not including or including flipX, flipY to emulate the flipping boolean\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _calcDimensionsTransformMatrix: function(skewX, skewY, flipping) {\n      return util.calcDimensionsMatrix({\n        skewX: skewX,\n        skewY: skewY,\n        scaleX: this.scaleX * (flipping && this.flipX ? -1 : 1),\n        scaleY: this.scaleY * (flipping && this.flipY ? -1 : 1)\n      });\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param {Number} skewX, a value to override current skewX\n     * @param {Number} skewY, a value to override current skewY\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions = this._getNonTransformedDimensions(), dimX, dimY,\n          noSkew = skewX === 0 && skewY === 0;\n\n      if (this.strokeUniform) {\n        dimX = this.width;\n        dimY = this.height;\n      }\n      else {\n        dimX = dimensions.x;\n        dimY = dimensions.y;\n      }\n      if (noSkew) {\n        return this._finalizeDimensions(dimX * this.scaleX, dimY * this.scaleY);\n      }\n      var bbox = util.sizeAfterTransform(dimX, dimY, {\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        skewX: skewX,\n        skewY: skewY,\n      });\n      return this._finalizeDimensions(bbox.x, bbox.y);\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param Number width width of the bbox\n     * @param Number height height of the bbox\n     * @private\n     * @return {Object} .x finalized width dimension\n     * @return {Object} .y finalized height dimension\n     */\n    _finalizeDimensions: function(width, height) {\n      return this.strokeUniform ?\n        { x: width + this.strokeWidth, y: height + this.strokeWidth }\n        :\n        { x: width, y: height };\n    },\n\n    /*\n     * Calculate object dimensions for controls box, including padding and canvas zoom.\n     * and active selection\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = transformPoint(dim, vpt, true);\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group && this.group.type !== 'activeSelection') {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else if (this.canvas) {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  var toFixed = fabric.util.toFixed;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule ? this.fillRule : 'nonzero',\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeDashOffset = this.strokeDashOffset ? this.strokeDashOffset : '0',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-dashoffset: ', strokeDashOffset, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n     * @return {String}\n     */\n    getSvgSpanStyles: function(style, useWhiteSpace) {\n      var term = '; ';\n      var fontFamily = style.fontFamily ?\n        'font-family: ' + (((style.fontFamily.indexOf('\\'') === -1 && style.fontFamily.indexOf('\"') === -1) ?\n          '\\'' + style.fontFamily  + '\\'' : style.fontFamily)) + term : '';\n      var strokeWidth = style.strokeWidth ? 'stroke-width: ' + style.strokeWidth + term : '',\n          fontFamily = fontFamily,\n          fontSize = style.fontSize ? 'font-size: ' + style.fontSize + 'px' + term : '',\n          fontStyle = style.fontStyle ? 'font-style: ' + style.fontStyle + term : '',\n          fontWeight = style.fontWeight ? 'font-weight: ' + style.fontWeight + term : '',\n          fill = style.fill ? getSvgColorString('fill', style.fill) : '',\n          stroke = style.stroke ? getSvgColorString('stroke', style.stroke) : '',\n          textDecoration = this.getSvgTextDecoration(style),\n          deltaY = style.deltaY ? 'baseline-shift: ' + (-style.deltaY) + '; ' : '';\n      if (textDecoration) {\n        textDecoration = 'text-decoration: ' + textDecoration + term;\n      }\n\n      return [\n        stroke,\n        strokeWidth,\n        fontFamily,\n        fontSize,\n        fontStyle,\n        fontWeight,\n        textDecoration,\n        fill,\n        deltaY,\n        useWhiteSpace ? 'white-space: pre; ' : ''\n      ].join('');\n    },\n\n    /**\n     * Returns text-decoration property for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @return {String}\n     */\n    getSvgTextDecoration: function(style) {\n      return ['overline', 'underline', 'line-through'].filter(function(decoration) {\n        return style[decoration.replace('-', '')];\n      }).join(' ');\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgCommons: function() {\n      return [\n        this.id ? 'id=\"' + this.id + '\" ' : '',\n        this.clipPath ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" ' : '',\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @param {Boolean} use the full transform or the single object one.\n     * @return {String}\n     */\n    getSvgTransform: function(full, additionalTransform) {\n      var transform = full ? this.calcTransformMatrix() : this.calcOwnMatrix(),\n          svgTransform = 'transform=\"' + fabric.util.matrixToSVG(transform);\n      return svgTransform +\n        (additionalTransform || '') + '\" ';\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        textBgRects.push(\n          '\\t\\t<rect ',\n          this._getFillAttributes(this.backgroundColor),\n          ' x=\"',\n          toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this.width, NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      return '\\t' + this._createBaseClipPathSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * @private\n     */\n    _createBaseClipPathSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var reviver = options.reviver,\n          additionalTransform = options.additionalTransform || '',\n          commonPieces = [\n            this.getSvgTransform(true, additionalTransform),\n            this.getSvgCommons(),\n          ].join(''),\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS');\n      objectMarkup[index] = commonPieces;\n      return reviver ? reviver(objectMarkup.join('')) : objectMarkup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var noStyle = options.noStyle,\n          reviver = options.reviver,\n          styleInfo = noStyle ? '' : 'style=\"' + this.getSvgStyles() + '\" ',\n          shadowInfo = options.withShadow ? 'style=\"' + this.getSvgFilter() + '\" ' : '',\n          clipPath = this.clipPath,\n          vectorEffect = this.strokeUniform ? 'vector-effect=\"non-scaling-stroke\" ' : '',\n          absoluteClipPath = clipPath && clipPath.absolutePositioned,\n          stroke = this.stroke, fill = this.fill, shadow = this.shadow,\n          commonPieces, markup = [], clipPathMarkup,\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS'),\n          additionalTransform = options.additionalTransform;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        clipPathMarkup = '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          clipPath.toClipPathSVG(reviver) +\n          '</clipPath>\\n';\n      }\n      if (absoluteClipPath) {\n        markup.push(\n          '<g ', shadowInfo, this.getSvgCommons(), ' >\\n'\n        );\n      }\n      markup.push(\n        '<g ',\n        this.getSvgTransform(false),\n        !absoluteClipPath ? shadowInfo + this.getSvgCommons() : '',\n        ' >\\n'\n      );\n      commonPieces = [\n        styleInfo,\n        vectorEffect,\n        noStyle ? '' : this.addPaintOrder(), ' ',\n        additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : '',\n      ].join('');\n      objectMarkup[index] = commonPieces;\n      if (fill && fill.toLive) {\n        markup.push(fill.toSVG(this));\n      }\n      if (stroke && stroke.toLive) {\n        markup.push(stroke.toSVG(this));\n      }\n      if (shadow) {\n        markup.push(shadow.toSVG(this));\n      }\n      if (clipPath) {\n        markup.push(clipPathMarkup);\n      }\n      markup.push(objectMarkup.join(''));\n      markup.push('</g>\\n');\n      absoluteClipPath && markup.push('</g>\\n');\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    addPaintOrder: function() {\n      return this.paintFirst !== 'fill' ? ' paint-order=\"' + this.paintFirst + '\" ' : '';\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (!Array.isArray(currentValue) || origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!currentValue ||\n          typeof currentValue !== 'object' ||\n          (!firstPass && keys.length !== Object.keys(currentValue).length)\n      ) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        // since clipPath is in the statefull cache list and the clipPath objects\n        // would be iterated as an object, this would lead to possible infinite recursion\n        // we do not want to compare those.\n        if (key === 'canvas' || key === 'group') {\n          continue;\n        }\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer, forTouch) {\n      // objects in group, anykind, are not self modificable,\n      // must not return an hovered corner.\n      if (!this.hasControls || this.group || (!this.canvas || this.canvas._activeObject !== this)) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines, keys = Object.keys(this.oCoords),\n          j = keys.length - 1, i;\n      this.__corner = 0;\n\n      // cycle in reverse order so we pick first the one on top\n      for (; j >= 0; j--) {\n        i = keys[j];\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        lines = this._getImageLines(forTouch ? this.oCoords[i].touchCorner : this.oCoords[i].corner);\n        // debugging\n\n        // this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Calls a function for each control. The function gets called,\n     * with the control, the object that is calling the iterator and the control's key\n     * @param {Function} fn function to iterate over the controls over\n     */\n    forEachControl: function(fn) {\n      for (var i in this.controls) {\n        fn(this.controls[i], i, this);\n      };\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * note: if we would switch to ROUND corner area, all of this would disappear.\n     * everything would resolve to a single point and a pythagorean theorem for the distance\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords,\n          newTheta = degreesToRadians(45 - this.angle),\n          cosTheta = fabric.util.cos(newTheta),\n          sinTheta = fabric.util.sin(newTheta),\n          /* Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2, */\n          /* 0.707106 stands for sqrt(2)/2 */\n          cornerHypotenuse = this.cornerSize * 0.707106,\n          touchHypotenuse = this.touchCornerSize * 0.707106,\n          cosHalfOffset = cornerHypotenuse * cosTheta,\n          sinHalfOffset = cornerHypotenuse * sinTheta,\n          touchCosHalfOffset = touchHypotenuse * cosTheta,\n          touchSinHalfOffset = touchHypotenuse * sinTheta,\n          x, y;\n\n      for (var control in coords) {\n        x = coords[control].x;\n        y = coords[control].y;\n        coords[control].corner = {\n          tl: {\n            x: x - sinHalfOffset,\n            y: y - cosHalfOffset\n          },\n          tr: {\n            x: x + cosHalfOffset,\n            y: y - sinHalfOffset\n          },\n          bl: {\n            x: x - cosHalfOffset,\n            y: y + sinHalfOffset\n          },\n          br: {\n            x: x + sinHalfOffset,\n            y: y + cosHalfOffset\n          }\n        };\n        coords[control].touchCorner = {\n          tl: {\n            x: x - touchSinHalfOffset,\n            y: y - touchCosHalfOffset\n          },\n          tr: {\n            x: x + touchCosHalfOffset,\n            y: y - touchSinHalfOffset\n          },\n          bl: {\n            x: x - touchCosHalfOffset,\n            y: y + touchSinHalfOffset\n          },\n          br: {\n            x: x + touchSinHalfOffset,\n            y: y + touchCosHalfOffset\n          }\n        };\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor ||\n        (this.canvas && !this.canvas.interactive) ||\n        (this.canvas && this.canvas._activeObject !== this)\n      ) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth,\n          hasControls = typeof styleOverride.hasControls !== 'undefined' ?\n            styleOverride.hasControls : this.hasControls,\n          shouldStroke = false;\n\n      ctx.save();\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray, null);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (hasControls) {\n        ctx.beginPath();\n        this.forEachControl(function(control, key, fabricObject) {\n          // in this moment, the ctx is centered on the object.\n          // width and height of the above function are the size of the bbox.\n          if (control.withConnection && control.getVisibility(fabricObject, key)) {\n            // reset movement for each control\n            shouldStroke = true;\n            ctx.moveTo(control.x * width, control.y * height);\n            ctx.lineTo(\n              control.x * width + control.offsetX,\n              control.y * height + control.offsetY\n            );\n          }\n        });\n        if (shouldStroke) {\n          ctx.stroke();\n        }\n      }\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options, styleOverride) {\n      styleOverride = styleOverride || {};\n      var bbox = fabric.util.sizeAfterTransform(this.width, this.height, options),\n          strokeWidth = this.strokeWidth,\n          strokeUniform = this.strokeUniform,\n          borderScaleFactor = this.borderScaleFactor,\n          width =\n            bbox.x + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleX) + borderScaleFactor,\n          height =\n            bbox.y + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleY) + borderScaleFactor;\n      ctx.save();\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray, null);\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      ctx.save();\n      ctx.setTransform(this.canvas.getRetinaScaling(), 0, 0, this.canvas.getRetinaScaling(), 0, 0);\n      ctx.strokeStyle = ctx.fillStyle = styleOverride.cornerColor || this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = styleOverride.cornerStrokeColor || this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, styleOverride.cornerDashArray || this.cornerDashArray, null);\n      this.setCoords();\n      this.forEachControl(function(control, key, fabricObject) {\n        if (control.getVisibility(fabricObject, key)) {\n          control.render(ctx,\n            fabricObject.oCoords[key].x,\n            fabricObject.oCoords[key].y, styleOverride, fabricObject);\n        }\n      });\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlKey) {\n      return this.controls[controlKey] && this.controls[controlKey].getVisibility(this, controlKey);\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlKey, visible) {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {};\n      }\n      this._controlsVisibility[controlKey] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to deselect this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onDeselect: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to select this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onSelect: function() {\n      // implemented by sub-classes, as needed.\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.left,\n      endValue: this.getCenter().left,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.top,\n      endValue: this.getCenter().top,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.opacity,\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @chainable\n   *\n   * As object  multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string  one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function() {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks;\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);\n      }\n    }\n    else {\n      this._animate.apply(this, arguments);\n    }\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var propIsColor =\n      _this.colorProperties.indexOf(property) > -1 ||\n      (propPair && _this.colorProperties.indexOf(propPair[1]) > -1);\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (!propIsColor) {\n      if (~to.indexOf('=')) {\n        to = currentValue + parseFloat(to.replace('=', ''));\n      }\n      else {\n        to = parseFloat(to);\n      }\n    }\n\n    var _options = {\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function () {\n        return options.abort.call(_this);\n      },\n      onChange: function (value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function (value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    };\n\n    if (propIsColor) {\n      fabric.util.animateColor(_options.startValue, _options.endValue, _options.duration, _options);\n    }\n    else {\n      fabric.util.animate(_options);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 },\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash');\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('x1', 'x2', 'y1', 'y2'),\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n\n      if (!this.strokeDashArray || this.strokeDashArray && supportsLineDash) {\n        // move from center (of virtual box) to its left/top corner\n        // we can't assume x1, y1 is top left and x2, y2 is bottom right\n        var p = this.calcLinePoints();\n        ctx.moveTo(p.x1, p.y1);\n        ctx.lineTo(p.x2, p.y2);\n      }\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p = this.calcLinePoints();\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, p.x1, p.y1, p.x2, p.y2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return {\n        x: (this.x1 + this.x2) / 2,\n        y: (this.y1 + this.y2) / 2,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @methd toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var p = this.calcLinePoints();\n      return [\n        '<line ', 'COMMON_PARTS',\n        'x1=\"', p.x1,\n        '\" y1=\"', p.y1,\n        '\" x2=\"', p.x2,\n        '\" y2=\"', p.y2,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */\n  fabric.Line.fromElement = function(element, callback, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Line.fromObject = function(object, callback) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    fabric.Object._fromObject('Line', options, _callback, 'points');\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      pi = Math.PI;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * Start angle of the circle, moving clockwise\n     * deprectated type, this should be in degree, this was an oversight.\n     * probably will change to degrees in next major version\n     * @type Number\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * deprectated type, this should be in degree, this was an oversight.\n     * probably will change to degrees in next major version\n     * @type Number\n     * @default 2Pi\n     */\n    endAngle: pi * 2,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('radius', 'startAngle', 'endAngle'),\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString, x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % ( 2 * pi);\n\n      if (angle === 0) {\n        svgString = [\n          '<circle ', 'COMMON_PARTS',\n          'cx=\"' + x + '\" cy=\"' + y + '\" ',\n          'r=\"', this.radius,\n          '\" />\\n'\n        ];\n      }\n      else {\n        var startX = fabric.util.cos(this.startAngle) * this.radius,\n            startY = fabric.util.sin(this.startAngle) * this.radius,\n            endX = fabric.util.cos(this.endAngle) * this.radius,\n            endY = fabric.util.sin(this.endAngle) * this.radius,\n            largeFlag = angle > pi ? '1' : '0';\n        svgString = [\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + this.radius + ' ' + this.radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\" ', 'COMMON_PARTS', ' />\\n'\n        ];\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.arc(\n        0,\n        0,\n        this.radius,\n        this.startAngle,\n        this.endAngle, false);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */\n  fabric.Circle.fromElement = function(element, callback) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.radius;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.radius;\n    callback(new fabric.Circle(parsedAttributes));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Circle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Width is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    width: 100,\n\n    /**\n     * Height is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    height: 100,\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, -widthBy2, heightBy2, 0, -heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, 0, -heightBy2, widthBy2, heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, widthBy2, heightBy2, -widthBy2, heightBy2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ].join(',');\n      return [\n        '<polygon ', 'COMMON_PARTS',\n        'points=\"', points,\n        '\" />'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Triangle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Triangle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      return [\n        '<ellipse ', 'COMMON_PARTS',\n        'cx=\"0\" cy=\"0\" ',\n        'rx=\"', this.rx,\n        '\" ry=\"', this.ry,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        0,\n        0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderPaintInOrder(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, callback) {\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    callback(new fabric.Ellipse(parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Ellipse', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('rx', 'ry'),\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n\n      // 1x1 case (used in spray brush) optimization was removed because\n      // with caching and higher zoom level this makes more damage than help\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var x = -this.width / 2, y = -this.height / 2;\n      return [\n        '<rect ', 'COMMON_PARTS',\n        'x=\"', x, '\" y=\"', y,\n        '\" rx=\"', this.rx, '\" ry=\"', this.ry,\n        '\" width=\"', this.width, '\" height=\"', this.height,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Rect.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    parsedAttributes.height  = parsedAttributes.height || 0;\n    parsedAttributes.width  = parsedAttributes.width || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    callback(rect);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */\n  fabric.Rect.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Rect', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('points'),\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      this._setPositionDimensions(options);\n    },\n\n    _setPositionDimensions: function(options) {\n      var calcDim = this._calcDimensions(options), correctLeftTop;\n      this.width = calcDim.width;\n      this.height = calcDim.height;\n      if (!options.fromSVG) {\n        correctLeftTop = this.translateToGivenOrigin(\n          { x: calcDim.left - this.strokeWidth / 2, y: calcDim.top - this.strokeWidth / 2 },\n          'left',\n          'top',\n          this.originX,\n          this.originY\n        );\n      }\n      if (typeof options.left === 'undefined') {\n        this.left = options.fromSVG ? calcDim.left : correctLeftTop.x;\n      }\n      if (typeof options.top === 'undefined') {\n        this.top = options.fromSVG ? calcDim.top : correctLeftTop.y;\n      }\n      this.pathOffset = {\n        x: calcDim.left + this.width / 2,\n        y: calcDim.top + this.height / 2\n      };\n    },\n\n    /**\n     * Calculate the polygon min and max point from points array,\n     * returning an object with left, top, widht, height to measure the\n     * polygon size\n     * @return {Object} object.left X coordinate of the polygon leftmost point\n     * @return {Object} object.top Y coordinate of the polygon topmost point\n     * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n     * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.points,\n          minX = min(points, 'x') || 0,\n          minY = min(points, 'y') || 0,\n          maxX = max(points, 'x') || 0,\n          maxY = max(points, 'y') || 0,\n          width = (maxX - minX),\n          height = (maxY - minY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var points = [], diffX = this.pathOffset.x, diffY = this.pathOffset.y,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      return [\n        '<' + this.type + ' ', 'COMMON_PARTS',\n        'points=\"', points.join(''),\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    commonRender: function(ctx) {\n      var point, len = this.points.length,\n          x = this.pathOffset.x,\n          y = this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p1, p2;\n\n      ctx.beginPath();\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        p1 = this.points[i];\n        p2 = this.points[i + 1] || p1;\n        fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polyline.fromElementGenerator = function(_class) {\n    return function(element, callback, options) {\n      if (!element) {\n        return callback(null);\n      }\n      options || (options = { });\n\n      var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n          parsedAttributes = fabric.parseAttributes(element, fabric[_class].ATTRIBUTE_NAMES);\n      parsedAttributes.fromSVG = true;\n      callback(new fabric[_class](points, extend(parsedAttributes, options)));\n    };\n  };\n\n  fabric.Polyline.fromElement = fabric.Polyline.fromElementGenerator('Polyline');\n\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polyline.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polyline', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      this.callSuper('_renderDashedStroke', ctx);\n      ctx.closePath();\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polygon.fromElement = fabric.Polyline.fromElementGenerator('Polygon');\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polygon.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polygon', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      _toString = Object.prototype.toString,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('path', 'fillRule'),\n\n    stateProperties: fabric.Object.prototype.stateProperties.concat('path'),\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function(path, options) {\n      options = options || { };\n      this.callSuper('initialize', options);\n      if (!path) {\n        path = [];\n      }\n\n      var fromArray = _toString.call(path) === '[object Array]';\n\n      this.path = fromArray\n        ? fabric.util.makePathSimpler(path)\n\n        : fabric.util.makePathSimpler(\n          fabric.util.parsePath(path)\n        );\n\n      if (!this.path) {\n        return;\n      }\n      fabric.Polyline.prototype._setPositionDimensions.call(this, options);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              current[3] + l,\n              current[4] + t\n            );\n            x = current[3];\n            y = current[4];\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        path: this.path.map(function(item) { return item.slice(); }),\n      });\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(['sourcePath'].concat(propertiesToInclude));\n      if (o.sourcePath) {\n        delete o.path;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var path = this.path.map(function(path) {\n        return path.join(' ');\n      }).join(' ');\n      return [\n        '<path ', 'COMMON_PARTS',\n        'd=\"', path,\n        '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      ];\n    },\n\n    _getOffsetTransform: function() {\n      var digits = fabric.Object.NUM_FRACTION_DIGITS;\n      return ' translate(' + toFixed(-this.pathOffset.x, digits) + ', ' +\n          toFixed(-this.pathOffset.y, digits) + ')';\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return '\\t' + this._createBaseClipPathSVGMarkup(\n        this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform }\n      );\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform  });\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[1],\n              current[2],\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: deltaX,\n        height: deltaY\n      };\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Path.fromObject = function(object, callback) {\n    if (typeof object.sourcePath === 'string') {\n      var pathUrl = object.sourcePath;\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\n        var path = elements[0];\n        path.setOptions(object);\n        callback && callback(path);\n      });\n    }\n    else {\n      fabric.Object._fromObject('Path', object, callback, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    parsedAttributes.fromSVG = true;\n    callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Array\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n     * available setting this boolean to true.\n     * @type Boolean\n     * @since 2.0.0\n     * @default\n     */\n    useSetOnGroup: false,\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || {};\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      isAlreadyGrouped && this.callSuper('initialize', options);\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (!isAlreadyGrouped) {\n        var center = options && options.centerPoint;\n        // we want to set origins before calculating the bounding box.\n        // so that the topleft can be set with that in mind.\n        // if specific top and left are passed, are overwritten later\n        // with the callSuper('initialize', options)\n        if (options.originX !== undefined) {\n          this.originX = options.originX;\n        }\n        if (options.originY !== undefined) {\n          this.originY = options.originY;\n        }\n        // if coming from svg i do not want to calc bounds.\n        // i assume width and height are passed along options\n        center || this._calcBounds();\n        this._updateObjectsCoords(center);\n        delete options.centerPoint;\n        this.callSuper('initialize', options);\n      }\n      else {\n        this._updateObjectsACoords();\n      }\n\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     */\n    _updateObjectsACoords: function() {\n      var skipControls = true;\n      for (var i = this._objects.length; i--; ){\n        this._objects[i].setCoords(skipControls);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(center) {\n      var center = center || this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     */\n    _updateObjectCoords: function(object, center) {\n      var objectLeft = object.left,\n          objectTop = object.top,\n          skipControls = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.group = this;\n      object.setCoords(skipControls);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n      if (this.useSetOnGroup) {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n      if (key === 'canvas') {\n        while (i--) {\n          this._objects[i]._set(key, value);\n        }\n      }\n      fabric.Object.prototype._set.call(this, key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var _includeDefaultValues = this.includeDefaultValues;\n      var objsToObject = this._objects.map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = _includeDefaultValues;\n        var _obj = obj.toObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      var obj = fabric.Object.prototype.toObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject, sourcePath = this.sourcePath;\n      if (sourcePath) {\n        objsToObject = sourcePath;\n      }\n      else {\n        var _includeDefaultValues = this.includeDefaultValues;\n        objsToObject = this._objects.map(function(obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toDatalessObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      }\n      var obj = fabric.Object.prototype.toDatalessObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group is already cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var ownCache = fabric.Object.prototype.shouldCache.call(this);\n      if (ownCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.ownCaching = false;\n            return false;\n          }\n        }\n      }\n      return ownCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (fabric.Object.prototype.willDrawShadow.call(this)) {\n        return true;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return this.ownCaching || (this.group && this.group.isOnACache());\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i].render(ctx);\n      }\n      this._drawClipPath(ctx);\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.callSuper('isCacheDirty', skipCanvas)) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Retores original state of each of group objects (original state is that which was before group was created).\n     * @private\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      this._objects.forEach(this._restoreObjectState, this);\n      return this;\n    },\n\n    /**\n     * Realises the transform from this group onto the supplied object\n     * i.e. it tells you what would happen if the supplied object was in\n     * the group, and then the group was destroyed. It mutates the supplied\n     * object.\n     * @param {fabric.Object} object\n     * @return {fabric.Object} transformedObject\n     */\n    realizeTransform: function(object) {\n      var matrix = object.calcTransformMatrix(),\n          options = fabric.util.qrDecompose(matrix),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n      return object;\n    },\n\n    /**\n     * Restores original state of a specified object in group\n     * @private\n     * @param {fabric.Object} object\n     * @return {fabric.Group} thisArg\n     */\n    _restoreObjectState: function(object) {\n      this.realizeTransform(object);\n      delete object.group;\n      object.setCoords();\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      // when group is destroyed objects needs to get a repaint to be eventually\n      // displayed on canvas.\n      this._objects.forEach(function(object) {\n        object.set('dirty', true);\n      });\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * make a group an active selection, remove the group from canvas\n     * the group has to be on canvas for this to work.\n     * @return {fabric.ActiveSelection} thisArg\n     * @chainable\n     */\n    toActiveSelection: function() {\n      if (!this.canvas) {\n        return;\n      }\n      var objects = this._objects, canvas = this.canvas;\n      this._objects = [];\n      var options = this.toObject();\n      delete options.objects;\n      var activeSelection = new fabric.ActiveSelection([]);\n      activeSelection.set(options);\n      activeSelection.type = 'activeSelection';\n      canvas.remove(this);\n      objects.forEach(function(object) {\n        object.group = activeSelection;\n        object.dirty = true;\n        canvas.add(object);\n      });\n      activeSelection.canvas = canvas;\n      activeSelection._objects = objects;\n      canvas._activeObject = activeSelection;\n      activeSelection.setCoords();\n      return activeSelection;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    ungroupOnCanvas: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var skipControls = true;\n      this.forEachObject(function(object) {\n        object.setCoords(skipControls);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        o.aCoords = o.calcACoords();\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(o.aCoords[prop].x);\n          aY.push(o.aCoords[prop].y);\n        }\n      }\n\n      this._getBounds(aX, aY, onlyWidthHeight);\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          top = minXY.y || 0, left = minXY.x || 0,\n          width = (maxXY.x - minXY.x) || 0,\n          height = (maxXY.y - minXY.y) || 0;\n      this.width = width;\n      this.height = height;\n      if (!onlyWidthHeight) {\n        // the bounding box always finds the topleft most corner.\n        // whatever is the group origin, we set up here the left/top position.\n        this.setPositionByOrigin({ x: left, y: top }, 'left', 'top');\n      }\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function(reviver) {\n      var svgString = ['<g ', 'COMMON_PARTS', ' >\\n'];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t\\t', this._objects[i].toSVG(reviver));\n      }\n      svgString.push('</g>\\n');\n      return svgString;\n    },\n\n    /**\n     * Returns styles-string for svg-export, specific version for group\n     * @return {String}\n     */\n    getSvgStyles: function() {\n      var opacity = typeof this.opacity !== 'undefined' && this.opacity !== 1 ?\n            'opacity: ' + this.opacity + ';' : '',\n          visibility = this.visible ? '' : ' visibility: hidden;';\n      return [\n        opacity,\n        this.getSvgFilter(),\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var svgString = [];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t', this._objects[i].toClipPathSVG(reviver));\n      }\n\n      return this._createBaseClipPathSVGMarkup(svgString, { reviver: reviver });\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    var objects = object.objects,\n        options = fabric.util.object.clone(object, true);\n    delete options.objects;\n    if (typeof objects === 'string') {\n      // it has to be an url or something went wrong.\n      fabric.loadSVGFromURL(objects, function (elements) {\n        var group = fabric.util.groupSVGElements(elements, object, objects);\n        group.set(options);\n        callback && callback(group);\n      });\n      return;\n    }\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      fabric.util.enlivenObjects([object.clipPath], function(enlivedClipPath) {\n        var options = fabric.util.object.clone(object, true);\n        options.clipPath = enlivedClipPath[0];\n        delete options.objects;\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\n      });\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.ActiveSelection) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */\n  fabric.ActiveSelection = fabric.util.createClass(fabric.Group, /** @lends fabric.ActiveSelection.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'activeSelection',\n\n    /**\n     * Constructor\n     * @param {Object} objects ActiveSelection objects\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options) {\n      options = options || {};\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      fabric.Object.prototype.initialize.call(this, options);\n      this.setCoords();\n    },\n\n    /**\n     * Change te activeSelection to a normal group,\n     * High level function that automatically adds it to canvas as\n     * active object. no events fired.\n     * @since 2.0.0\n     * @return {fabric.Group}\n     */\n    toGroup: function() {\n      var objects = this._objects.concat();\n      this._objects = [];\n      var options = fabric.Object.prototype.toObject.call(this);\n      var newGroup = new fabric.Group([]);\n      delete options.type;\n      newGroup.set(options);\n      objects.forEach(function(object) {\n        object.canvas.remove(object);\n        object.group = newGroup;\n      });\n      newGroup._objects = objects;\n      if (!this.canvas) {\n        return newGroup;\n      }\n      var canvas = this.canvas;\n      canvas.add(newGroup);\n      canvas._activeObject = newGroup;\n      newGroup.setCoords();\n      return newGroup;\n    },\n\n    /**\n     * If returns true, deselection is cancelled.\n     * @since 2.0.0\n     * @return {Boolean} [cancel]\n     */\n    onDeselect: function() {\n      this.destroy();\n      return false;\n    },\n\n    /**\n     * Returns string representation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.ActiveSelection: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     * @param {Object} [childrenOverride] properties to override the children overrides\n     */\n    _renderControls: function(ctx, styleOverride, childrenOverride) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, styleOverride);\n      childrenOverride = childrenOverride || { };\n      if (typeof childrenOverride.hasControls === 'undefined') {\n        childrenOverride.hasControls = false;\n      }\n      childrenOverride.forActiveSelection = true;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx, childrenOverride);\n      }\n      ctx.restore();\n    },\n  });\n\n  /**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */\n  fabric.ActiveSelection.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\n     * This allows for relative urls as image src.\n     * @since 2.7.0\n     * @type Boolean\n     * @default\n     */\n    srcFromAttribute: false,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingX: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 are not implemented yet.\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('cropX', 'cropY'),\n\n    /**\n     * key used to retrieve the texture representing this image\n     * @since 2.0.0\n     * @type String\n     * @default\n     */\n    cacheKey: '',\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropX: 0,\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropY: 0,\n\n    /**\n     * Indicates whether this canvas will use image smoothing when painting this image.\n     * Also influence if the cacheCanvas for this image uses imageSmoothing\n     * @since 4.0.0-beta.11\n     * @type Boolean\n     * @default\n     */\n    imageSmoothing: true,\n\n    /**\n     * Constructor\n     * @param {HTMLImageElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options) {\n      options || (options = { });\n      this.filters = [];\n      this.cacheKey = 'texture' + fabric.Object.__uid++;\n      this.callSuper('initialize', options);\n      this._initElement(element, options);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element || {};\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, options) {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n      if (this.filters.length !== 0) {\n        this.applyFilters();\n      }\n      // resizeFilters work on the already filtered copy.\n      // we need to apply resizeFilters AFTER normal filters.\n      // applyResizeFilters is run more often than normal fiters\n      // and is triggered by user interactions rather than dev code\n      if (this.resizeFilter) {\n        this.applyResizeFilters();\n      }\n      return this;\n    },\n\n    /**\n     * Delete a single texture if in webgl mode\n     */\n    removeTexture: function(key) {\n      var backend = fabric.filterBackend;\n      if (backend && backend.evictCachesForKey) {\n        backend.evictCachesForKey(key);\n      }\n    },\n\n    /**\n     * Delete textures, reference to elements and eventually JSDOM cleanup\n     */\n    dispose: function() {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._cacheContext = undefined;\n      ['_originalElement', '_element', '_filteredEl', '_cacheCanvas'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n    },\n\n    /**\n     * Get the crossOrigin value (of the corresponding image element)\n     */\n    getCrossOrigin: function() {\n      return this._originalElement && (this._originalElement.crossOrigin || null);\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.naturalWidth || element.width,\n        height: element.naturalHeight || element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.save();\n      this._setStrokeStyles(ctx, this);\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [];\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          filters.push(filterObj.toObject());\n        }\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['cropX', 'cropY'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          crossOrigin: this.getCrossOrigin(),\n          filters: filters,\n        });\n      if (this.resizeFilter) {\n        object.resizeFilter = this.resizeFilter.toObject();\n      }\n      return object;\n    },\n\n    /**\n     * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,hight.\n     * @return {Boolean}\n     */\n    hasCrop: function() {\n      return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString = [], imageMarkup = [], strokeSvg, element = this._element,\n          x = -this.width / 2, y = -this.height / 2, clipPath = '', imageRendering = '';\n      if (!element) {\n        return [];\n      }\n      if (this.hasCrop()) {\n        var clipPathId = fabric.Object.__uid++;\n        svgString.push(\n          '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\n          '\\t<rect x=\"' + x + '\" y=\"' + y + '\" width=\"' + this.width + '\" height=\"' + this.height + '\" />\\n',\n          '</clipPath>\\n'\n        );\n        clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\n      }\n      if (!this.imageSmoothing) {\n        imageRendering = '\" image-rendering=\"optimizeSpeed';\n      }\n      imageMarkup.push('\\t<image ', 'COMMON_PARTS', 'xlink:href=\"', this.getSvgSrc(true),\n        '\" x=\"', x - this.cropX, '\" y=\"', y - this.cropY,\n        // we're essentially moving origin of transformation from top/left corner to the center of the shape\n        // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n        // so that object's center aligns with container's left/top\n        '\" width=\"', element.width || element.naturalWidth,\n        '\" height=\"', element.height || element.height,\n        imageRendering,\n        '\"', clipPath,\n        '></image>\\n');\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        strokeSvg = [\n          '\\t<rect ',\n          'x=\"', x, '\" y=\"', y,\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        ];\n        this.fill = origFill;\n      }\n      if (this.paintFirst !== 'fill') {\n        svgString = svgString.concat(strokeSvg, imageMarkup);\n      }\n      else {\n        svgString = svgString.concat(imageMarkup, strokeSvg);\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        if (element.toDataURL) {\n          return element.toDataURL();\n        }\n\n        if (this.srcFromAttribute) {\n          return element.getAttribute('src');\n        }\n        else {\n          return element.src;\n        }\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img, isError) {\n        this.setElement(img, options);\n        this._setWidthHeight();\n        callback && callback(this, isError);\n      }, this, options && options.crossOrigin);\n      return this;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    applyResizeFilters: function() {\n      var filter = this.resizeFilter,\n          minimumScale = this.minimumScaleTrigger,\n          objectScale = this.getTotalObjectScaling(),\n          scaleX = objectScale.scaleX,\n          scaleY = objectScale.scaleY,\n          elementToFilter = this._filteredEl || this._originalElement;\n      if (this.group) {\n        this.set('dirty', true);\n      }\n      if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\n        this._element = elementToFilter;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        this._lastScaleX = scaleX;\n        this._lastScaleY = scaleY;\n        return;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      var canvasEl = fabric.util.createCanvasElement(),\n          cacheKey = this._filteredEl ? (this.cacheKey + '_filtered') : this.cacheKey,\n          sourceWidth = elementToFilter.width, sourceHeight = elementToFilter.height;\n      canvasEl.width = sourceWidth;\n      canvasEl.height = sourceHeight;\n      this._element = canvasEl;\n      this._lastScaleX = filter.scaleX = scaleX;\n      this._lastScaleY = filter.scaleY = scaleY;\n      fabric.filterBackend.applyFilters(\n        [filter], elementToFilter, sourceWidth, sourceHeight, this._element, cacheKey);\n      this._filterScalingX = canvasEl.width / this._originalElement.width;\n      this._filterScalingY = canvasEl.height / this._originalElement.height;\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array) or from filter param\n     * @method applyFilters\n     * @param {Array} filters to be applied\n     * @param {Boolean} forResizing specify if the filter operation is a resize operation\n     * @return {thisArg} return the fabric.Image object\n     * @chainable\n     */\n    applyFilters: function(filters) {\n\n      filters = filters || this.filters || [];\n      filters = filters.filter(function(filter) { return filter && !filter.isNeutralState(); });\n      this.set('dirty', true);\n\n      // needs to clear out or WEBGL will not resize correctly\n      this.removeTexture(this.cacheKey + '_filtered');\n\n      if (filters.length === 0) {\n        this._element = this._originalElement;\n        this._filteredEl = null;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        return this;\n      }\n\n      var imgElement = this._originalElement,\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\n\n      if (this._element === this._originalElement) {\n        // if the element is the same we need to create a new element\n        var canvasEl = fabric.util.createCanvasElement();\n        canvasEl.width = sourceWidth;\n        canvasEl.height = sourceHeight;\n        this._element = canvasEl;\n        this._filteredEl = canvasEl;\n      }\n      else {\n        // clear the existing element to get new filter data\n        // also dereference the eventual resized _element\n        this._element = this._filteredEl;\n        this._filteredEl.getContext('2d').clearRect(0, 0, sourceWidth, sourceHeight);\n        // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\n        this._lastScaleX = 1;\n        this._lastScaleY = 1;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      fabric.filterBackend.applyFilters(\n        filters, this._originalElement, sourceWidth, sourceHeight, this._element, this.cacheKey);\n      if (this._originalElement.width !== this._element.width ||\n        this._originalElement.height !== this._element.height) {\n        this._filterScalingX = this._element.width / this._originalElement.width;\n        this._filterScalingY = this._element.height / this._originalElement.height;\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      if (this.isMoving !== true && this.resizeFilter && this._needsResize()) {\n        this.applyResizeFilters();\n      }\n      this._stroke(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * it will set the imageSmoothing for the draw operation\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      fabric.Object.prototype.drawCacheOnCanvas.call(this, ctx);\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * This is the special image version where we would like to avoid caching where possible.\n     * Essentially images do not benefit from caching. They may require caching, and in that\n     * case we do it. Also caching an image usually ends in a loss of details.\n     * A full performance audit should be done.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return this.needsItsOwnCache();\n    },\n\n    _renderFill: function(ctx) {\n      var elementToDraw = this._element;\n      if (!elementToDraw) {\n        return;\n      }\n      var scaleX = this._filterScalingX, scaleY = this._filterScalingY,\n          w = this.width, h = this.height, min = Math.min, max = Math.max,\n          // crop values cannot be lesser than 0.\n          cropX = max(this.cropX, 0), cropY = max(this.cropY, 0),\n          elWidth = elementToDraw.naturalWidth || elementToDraw.width,\n          elHeight = elementToDraw.naturalHeight || elementToDraw.height,\n          sX = cropX * scaleX,\n          sY = cropY * scaleY,\n          // the width height cannot exceed element width/height, starting from the crop offset.\n          sW = min(w * scaleX, elWidth - sX),\n          sH = min(h * scaleY, elHeight - sY),\n          x = -w / 2, y = -h / 2,\n          maxDestW = min(w, elWidth / scaleX - cropX),\n          maxDestH = min(h, elHeight / scaleX - cropY);\n\n      elementToDraw && ctx.drawImage(elementToDraw, sX, sY, sW, sH, x, y, maxDestW, maxDestH);\n    },\n\n    /**\n     * needed to check if image needs resize\n     * @private\n     */\n    _needsResize: function() {\n      var scale = this.getTotalObjectScaling();\n      return (scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      this.set(this.getOriginalSize());\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options) {\n      this.setElement(fabric.util.getById(element), options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * Set the width and the height of the image object, using the element or the\n     * options.\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n      var el = this.getElement();\n      this.width = options.width || el.naturalWidth || el.width || 0;\n      this.height = options.height || el.naturalHeight || el.height || 0;\n    },\n\n    /**\n     * Calculate offset for center and scale factor for the image in order to respect\n     * the preserveAspectRatio attribute\n     * @private\n     * @return {Object}\n     */\n    parsePreserveAspectRatioAttribute: function() {\n      var pAR = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ''),\n          rWidth = this._element.width, rHeight = this._element.height,\n          scaleX = 1, scaleY = 1, offsetLeft = 0, offsetTop = 0, cropX = 0, cropY = 0,\n          offset, pWidth = this.width, pHeight = this.height, parsedAttributes = { width: pWidth, height: pHeight };\n      if (pAR && (pAR.alignX !== 'none' || pAR.alignY !== 'none')) {\n        if (pAR.meetOrSlice === 'meet') {\n          scaleX = scaleY = fabric.util.findScaleToFit(this._element, parsedAttributes);\n          offset = (pWidth - rWidth * scaleX) / 2;\n          if (pAR.alignX === 'Min') {\n            offsetLeft = -offset;\n          }\n          if (pAR.alignX === 'Max') {\n            offsetLeft = offset;\n          }\n          offset = (pHeight - rHeight * scaleY) / 2;\n          if (pAR.alignY === 'Min') {\n            offsetTop = -offset;\n          }\n          if (pAR.alignY === 'Max') {\n            offsetTop = offset;\n          }\n        }\n        if (pAR.meetOrSlice === 'slice') {\n          scaleX = scaleY = fabric.util.findScaleToCover(this._element, parsedAttributes);\n          offset = rWidth - pWidth / scaleX;\n          if (pAR.alignX === 'Mid') {\n            cropX = offset / 2;\n          }\n          if (pAR.alignX === 'Max') {\n            cropX = offset;\n          }\n          offset = rHeight - pHeight / scaleY;\n          if (pAR.alignY === 'Mid') {\n            cropY = offset / 2;\n          }\n          if (pAR.alignY === 'Max') {\n            cropY = offset;\n          }\n          rWidth = pWidth / scaleX;\n          rHeight = pHeight / scaleY;\n        }\n      }\n      else {\n        scaleX = pWidth / rWidth;\n        scaleY = pHeight / rHeight;\n      }\n      return {\n        width: rWidth,\n        height: rHeight,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        offsetLeft: offsetLeft,\n        offsetTop: offsetTop,\n        cropX: cropX,\n        cropY: cropY\n      };\n    }\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(_object, callback) {\n    var object = fabric.util.object.clone(_object);\n    fabric.util.loadImage(object.src, function(img, isError) {\n      if (isError) {\n        callback && callback(null, true);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, [object.resizeFilter], function(resizeFilters) {\n          object.resizeFilter = resizeFilters[0];\n          fabric.util.enlivenObjects([object.clipPath], function(enlivedProps) {\n            object.clipPath = enlivedProps[0];\n            var image = new fabric.Image(img, object);\n            callback(image, false);\n          });\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occured or not.\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img, isError) {\n      callback && callback(new fabric.Image(img, imgOptions), isError);\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat(\n      'x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' ')\n    );\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.angle % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    this.rotate(this._getAngleValueForStraighten());\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.rotate(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxStraightenObject: function (object) {\n    object.fxStraighten({\n      onChange: this.requestRenderAllBound\n    });\n    return this;\n  }\n});\n\n\n(function() {\n\n  'use strict';\n\n  /**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */\n  function testPrecision(gl, precision){\n    var fragmentSource = 'precision ' + precision + ' float;\\nvoid main(){}';\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */\n  fabric.isWebglSupported = function(tileSize) {\n    if (fabric.isLikelyNode) {\n      return false;\n    }\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\n    var canvas = document.createElement('canvas');\n    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    var isSupported = false;\n    // eslint-disable-next-line\n    if (gl) {\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      isSupported = fabric.maxTextureSize >= tileSize;\n      var precisions = ['highp', 'mediump', 'lowp'];\n      for (var i = 0; i < 3; i++){\n        if (testPrecision(gl, precisions[i])){\n          fabric.webGlPrecision = precisions[i];\n          break;\n        };\n      }\n    }\n    this.isSupported = isSupported;\n    return isSupported;\n  };\n\n  fabric.WebglFilterBackend = WebglFilterBackend;\n\n  /**\n   * WebGL filter backend.\n   */\n  function WebglFilterBackend(options) {\n    if (options && options.tileSize) {\n      this.tileSize = options.tileSize;\n    }\n    this.setupGLContext(this.tileSize, this.tileSize);\n    this.captureGPUInfo();\n  };\n\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\n\n    tileSize: 2048,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you problably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */\n    setupGLContext: function(width, height) {\n      this.dispose();\n      this.createWebGLCanvas(width, height);\n      // eslint-disable-next-line\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\n      this.chooseFastestCopyGLTo2DMethod(width, height);\n    },\n\n    /**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */\n    chooseFastestCopyGLTo2DMethod: function(width, height) {\n      var canMeasurePerf = typeof window.performance !== 'undefined', canUseImageData;\n      try {\n        new ImageData(1, 1);\n        canUseImageData = true;\n      }\n      catch (e) {\n        canUseImageData = false;\n      }\n      // eslint-disable-next-line no-undef\n      var canUseArrayBuffer = typeof ArrayBuffer !== 'undefined';\n      // eslint-disable-next-line no-undef\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== 'undefined';\n\n      if (!(canMeasurePerf && canUseImageData && canUseArrayBuffer && canUseUint8Clamped)) {\n        return;\n      }\n\n      var targetCanvas = fabric.util.createCanvasElement();\n      // eslint-disable-next-line no-undef\n      var imageBuffer = new ArrayBuffer(width * height * 4);\n      if (fabric.forceGLPutImageData) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n        return;\n      }\n      var testContext = {\n        imageBuffer: imageBuffer,\n        destinationWidth: width,\n        destinationHeight: height,\n        targetCanvas: targetCanvas\n      };\n      var startTime, drawImageTime, putImageDataTime;\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n\n      startTime = window.performance.now();\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\n      drawImageTime = window.performance.now() - startTime;\n\n      startTime = window.performance.now();\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\n      putImageDataTime = window.performance.now() - startTime;\n\n      if (drawImageTime > putImageDataTime) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n      }\n      else {\n        this.copyGLTo2D = copyGLTo2DDrawImage;\n      }\n    },\n\n    /**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */\n    createWebGLCanvas: function(width, height) {\n      var canvas = fabric.util.createCanvasElement();\n      canvas.width = width;\n      canvas.height = height;\n      var glOptions = {\n            alpha: true,\n            premultipliedAlpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false\n          },\n          gl = canvas.getContext('webgl', glOptions);\n      if (!gl) {\n        gl = canvas.getContext('experimental-webgl', glOptions);\n      }\n      if (!gl) {\n        return;\n      }\n      gl.clearColor(0, 0, 0, 0);\n      // this canvas can fire webglcontextlost and webglcontextrestored\n      this.canvas = canvas;\n      this.gl = gl;\n    },\n\n    /**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */\n    applyFilters: function(filters, source, width, height, targetCanvas, cacheKey) {\n      var gl = this.gl;\n      var cachedTexture;\n      if (cacheKey) {\n        cachedTexture = this.getCachedTexture(cacheKey, source);\n      }\n      var pipelineState = {\n        originalWidth: source.width || source.originalWidth,\n        originalHeight: source.height || source.originalHeight,\n        sourceWidth: width,\n        sourceHeight: height,\n        destinationWidth: width,\n        destinationHeight: height,\n        context: gl,\n        sourceTexture: this.createTexture(gl, width, height, !cachedTexture && source),\n        targetTexture: this.createTexture(gl, width, height),\n        originalTexture: cachedTexture ||\n          this.createTexture(gl, width, height, !cachedTexture && source),\n        passes: filters.length,\n        webgl: true,\n        aPosition: this.aPosition,\n        programCache: this.programCache,\n        pass: 0,\n        filterBackend: this,\n        targetCanvas: targetCanvas\n      };\n      var tempFbo = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\n      filters.forEach(function(filter) { filter && filter.applyTo(pipelineState); });\n      resizeCanvasIfNeeded(pipelineState);\n      this.copyGLTo2D(gl, pipelineState);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.deleteTexture(pipelineState.sourceTexture);\n      gl.deleteTexture(pipelineState.targetTexture);\n      gl.deleteFramebuffer(tempFbo);\n      targetCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n      return pipelineState;\n    },\n\n    /**\n     * Detach event listeners, remove references, and clean up caches.\n     */\n    dispose: function() {\n      if (this.canvas) {\n        this.canvas = null;\n        this.gl = null;\n      }\n      this.clearWebGLCaches();\n    },\n\n    /**\n     * Wipe out WebGL-related caches.\n     */\n    clearWebGLCaches: function() {\n      this.programCache = {};\n      this.textureCache = {};\n    },\n\n    /**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the textuer to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @returns {WebGLTexture}\n     */\n    createTexture: function(gl, width, height, textureImageSource) {\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      if (textureImageSource) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureImageSource);\n      }\n      else {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n      }\n      return texture;\n    },\n\n    /**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */\n    getCachedTexture: function(uniqueId, textureImageSource) {\n      if (this.textureCache[uniqueId]) {\n        return this.textureCache[uniqueId];\n      }\n      else {\n        var texture = this.createTexture(\n          this.gl, textureImageSource.width, textureImageSource.height, textureImageSource);\n        this.textureCache[uniqueId] = texture;\n        return texture;\n      }\n    },\n\n    /**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */\n    evictCachesForKey: function(cacheKey) {\n      if (this.textureCache[cacheKey]) {\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\n        delete this.textureCache[cacheKey];\n      }\n    },\n\n    copyGLTo2D: copyGLTo2DDrawImage,\n\n    /**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */\n    captureGPUInfo: function() {\n      if (this.gpuInfo) {\n        return this.gpuInfo;\n      }\n      var gl = this.gl, gpuInfo = { renderer: '', vendor: '' };\n      if (!gl) {\n        return gpuInfo;\n      }\n      var ext = gl.getExtension('WEBGL_debug_renderer_info');\n      if (ext) {\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\n        if (renderer) {\n          gpuInfo.renderer = renderer.toLowerCase();\n        }\n        if (vendor) {\n          gpuInfo.vendor = vendor.toLowerCase();\n        }\n      }\n      this.gpuInfo = gpuInfo;\n      return gpuInfo;\n    },\n  };\n})();\n\nfunction resizeCanvasIfNeeded(pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n      width = targetCanvas.width, height = targetCanvas.height,\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight;\n\n  if (width !== dWidth || height !== dHeight) {\n    targetCanvas.width = dWidth;\n    targetCanvas.height = dHeight;\n  }\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\n  var glCanvas = gl.canvas, targetCanvas = pipelineState.targetCanvas,\n      ctx = targetCanvas.getContext('2d');\n  ctx.translate(0, targetCanvas.height); // move it down again\n  ctx.scale(1, -1); // vertical flip\n  // where is my image on the big glcanvas?\n  var sourceY = glCanvas.height - targetCanvas.height;\n  ctx.drawImage(glCanvas, 0, sourceY, targetCanvas.width, targetCanvas.height, 0, 0,\n    targetCanvas.width, targetCanvas.height);\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas, ctx = targetCanvas.getContext('2d'),\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight,\n      numBytes = dWidth * dHeight * 4;\n\n  // eslint-disable-next-line no-undef\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\n  // eslint-disable-next-line no-undef\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\n\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\n  ctx.putImageData(imgData, 0, 0);\n}\n\n\n(function() {\n\n  'use strict';\n\n  var noop = function() {};\n\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\n\n  /**\n   * Canvas 2D filter backend.\n   */\n  function Canvas2dFilterBackend() {};\n\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\n    evictCachesForKey: noop,\n    dispose: noop,\n    clearWebGLCaches: noop,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */\n    applyFilters: function(filters, sourceElement, sourceWidth, sourceHeight, targetCanvas) {\n      var ctx = targetCanvas.getContext('2d');\n      ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n      var imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var pipelineState = {\n        sourceWidth: sourceWidth,\n        sourceHeight: sourceHeight,\n        imageData: imageData,\n        originalEl: sourceElement,\n        originalImageData: originalImageData,\n        canvasEl: targetCanvas,\n        ctx: ctx,\n        filterBackend: this,\n      };\n      filters.forEach(function(filter) { filter.applyTo(pipelineState); });\n      if (pipelineState.imageData.width !== sourceWidth || pipelineState.imageData.height !== sourceHeight) {\n        targetCanvas.width = pipelineState.imageData.width;\n        targetCanvas.height = pipelineState.imageData.height;\n      }\n      ctx.putImageData(pipelineState.imageData, 0, 0);\n      return pipelineState;\n    },\n\n  };\n})();\n\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image = fabric.Image || { };\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Array of attributes to send with buffers. do not modify\n   * @private\n   */\n\n  vertexSource: 'attribute vec2 aPosition;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'void main() {\\n' +\n      'vTexCoord = aPosition;\\n' +\n      'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n    '}',\n\n  fragmentSource: 'precision highp float;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'uniform sampler2D uTexture;\\n' +\n    'void main() {\\n' +\n      'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n    '}',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Compile this filter's shader program.\n   *\n   * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n   * @param {String} fragmentSource fragmentShader source for compilation\n   * @param {String} vertexSource vertexShader source for compilation\n   */\n  createProgram: function(gl, fragmentSource, vertexSource) {\n    fragmentSource = fragmentSource || this.fragmentSource;\n    vertexSource = vertexSource || this.vertexSource;\n    if (fabric.webGlPrecision !== 'highp'){\n      fragmentSource = fragmentSource.replace(\n        /precision highp float/g,\n        'precision ' + fabric.webGlPrecision + ' float'\n      );\n    }\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Vertex shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(vertexShader)\n      );\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Fragment shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(fragmentShader)\n      );\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Shader link error for \"${this.type}\" ' +\n        gl.getProgramInfoLog(program)\n      );\n    }\n\n    var attributeLocations = this.getAttributeLocations(gl, program);\n    var uniformLocations = this.getUniformLocations(gl, program) || { };\n    uniformLocations.uStepW = gl.getUniformLocation(program, 'uStepW');\n    uniformLocations.uStepH = gl.getUniformLocation(program, 'uStepH');\n    return {\n      program: program,\n      attributeLocations: attributeLocations,\n      uniformLocations: uniformLocations\n    };\n  },\n\n  /**\n   * Return a map of attribute names to WebGLAttributeLocation objects.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n   * @returns {Object} A map of attribute names to attribute locations.\n   */\n  getAttributeLocations: function(gl, program) {\n    return {\n      aPosition: gl.getAttribLocation(program, 'aPosition'),\n    };\n  },\n\n  /**\n   * Return a map of uniform names to WebGLUniformLocation objects.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n   * @returns {Object} A map of uniform names to uniform locations.\n   */\n  getUniformLocations: function (/* gl, program */) {\n    // in case i do not need any special uniform i need to return an empty object\n    return { };\n  },\n\n  /**\n   * Send attribute data from this filter to its shader program on the GPU.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} attributeLocations A map of shader attribute names to their locations.\n   */\n  sendAttributeData: function(gl, attributeLocations, aPositionData) {\n    var attributeLocation = attributeLocations.aPosition;\n    var buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.enableVertexAttribArray(attributeLocation);\n    gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\n  },\n\n  _setupFrameBuffer: function(options) {\n    var gl = options.context, width, height;\n    if (options.passes > 1) {\n      width = options.destinationWidth;\n      height = options.destinationHeight;\n      if (options.sourceWidth !== width || options.sourceHeight !== height) {\n        gl.deleteTexture(options.targetTexture);\n        options.targetTexture = options.filterBackend.createTexture(gl, width, height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D,\n        options.targetTexture, 0);\n    }\n    else {\n      // draw last filter on canvas and not to framebuffer.\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.finish();\n    }\n  },\n\n  _swapTextures: function(options) {\n    options.passes--;\n    options.pass++;\n    var temp = options.targetTexture;\n    options.targetTexture = options.sourceTexture;\n    options.sourceTexture = temp;\n  },\n\n  /**\n   * Generic isNeutral implementation for one parameter based filters.\n   * Used only in image applyFilters to discard filters that will not have an effect\n   * on the image\n   * Other filters may need their own verison ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n   * @param {Object} options\n   **/\n  isNeutralState: function(/* options */) {\n    var main = this.mainParameter,\n        _class = fabric.Image.filters[this.type].prototype;\n    if (main) {\n      if (Array.isArray(_class[main])) {\n        for (var i = _class[main].length; i--;) {\n          if (this[main][i] !== _class[main][i]) {\n            return false;\n          }\n        }\n        return true;\n      }\n      else {\n        return _class[main] === this[main];\n      }\n    }\n    else {\n      return false;\n    }\n  },\n\n  /**\n   * Apply this filter to the input image data provided.\n   *\n   * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyTo: function(options) {\n    if (options.webgl) {\n      this._setupFrameBuffer(options);\n      this.applyToWebGL(options);\n      this._swapTextures(options);\n    }\n    else {\n      this.applyTo2d(options);\n    }\n  },\n\n  /**\n   * Retrieves the cached shader.\n   * @param {Object} options\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  retrieveShader: function(options) {\n    if (!options.programCache.hasOwnProperty(this.type)) {\n      options.programCache[this.type] = this.createProgram(options.context);\n    }\n    return options.programCache[this.type];\n  },\n\n  /**\n   * Apply this filter using webgl.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyToWebGL: function(options) {\n    var gl = options.context;\n    var shader = this.retrieveShader(options);\n    if (options.pass === 0 && options.originalTexture) {\n      gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\n    }\n    else {\n      gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\n    }\n    gl.useProgram(shader.program);\n    this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\n\n    gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\n    gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\n\n    this.sendUniformData(gl, shader.uniformLocations);\n    gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  },\n\n  bindAdditionalTexture: function(gl, texture, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    // reset active texture to 0 as usual\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  unbindAdditionalTexture: function(gl, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  getMainParameter: function() {\n    return this[this.mainParameter];\n  },\n\n  setMainParameter: function(value) {\n    this[this.mainParameter] = value;\n  },\n\n  /**\n   * Send uniform data from this filter to its shader program on the GPU.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} uniformLocations A map of shader uniform names to their locations.\n   */\n  sendUniformData: function(/* gl, uniformLocations */) {\n    // Intentionally left blank.  Override me in subclasses.\n  },\n\n  /**\n   * If needed by a 2d filter, this functions can create an helper canvas to be used\n   * remember that options.targetCanvas is available for use till end of chain.\n   */\n  createHelpLayer: function(options) {\n    if (!options.helpLayer) {\n      var helpLayer = document.createElement('canvas');\n      helpLayer.width = options.sourceWidth;\n      helpLayer.height = options.sourceHeight;\n      options.helpLayer = helpLayer;\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    var object = { type: this.type }, mainP = this.mainParameter;\n    if (mainP) {\n      object[mainP] = this[mainP];\n    }\n    return object;\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'uniform mat4 uColorMatrix;\\n' +\n      'uniform vec4 uConstants;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color *= uColorMatrix;\\n' +\n        'color += uConstants;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Colormatrix for pixels.\n     * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n     * outside the -1, 1 range.\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Array} matrix array of 20 numbers.\n     * @default\n     */\n    matrix: [\n      1, 0, 0, 0, 0,\n      0, 1, 0, 0, 0,\n      0, 0, 1, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n\n    mainParameter: 'matrix',\n\n    /**\n     * Lock the colormatrix on the color part, skipping alpha, manly for non webgl scenario\n     * to save some calculation\n     */\n    colorsOnly: true,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.matrix = this.matrix.slice(0);\n    },\n\n    /**\n     * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          m = this.matrix,\n          r, g, b, a, i, colorsOnly = this.colorsOnly;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        if (colorsOnly) {\n          data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\n        }\n        else {\n          a = data[i + 3];\n          data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\n          data[i + 3] = r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColorMatrix: gl.getUniformLocation(program, 'uColorMatrix'),\n        uConstants: gl.getUniformLocation(program, 'uConstants'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var m = this.matrix,\n          matrix = [\n            m[0], m[1], m[2], m[3],\n            m[5], m[6], m[7], m[8],\n            m[10], m[11], m[12], m[13],\n            m[15], m[16], m[17], m[18]\n          ],\n          constants = [m[4], m[9], m[14], m[19]];\n      gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\n      gl.uniform4fv(uniformLocations.uConstants, constants);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBrightness;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += uBrightness;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Brightness value, from -1 to 1.\n     * translated to -255 to 255 for 2d\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Number} brightness\n     * @default\n     */\n    brightness: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'brightness',\n\n    /**\n    * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n    *\n    * @param {Object} options\n    * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n    */\n    applyTo2d: function(options) {\n      if (this.brightness === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          brightness = Math.round(this.brightness * 255);\n      for (i = 0; i < len; i += 4) {\n        data[i] = data[i] + brightness;\n        data[i + 1] = data[i + 1] + brightness;\n        data[i + 2] = data[i + 2] + brightness;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBrightness: gl.getUniformLocation(program, 'uBrightness'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBrightness, this.brightness);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /*\n     * Opaque value (true/false)\n     */\n    opaque: false,\n\n    /*\n     * matrix for the filter, max 9x9\n     */\n    matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: {\n      Convolute_3_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_3_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_5_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_5_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_7_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_7_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_9_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_9_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n    },\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n\n\n    /**\n    * Retrieves the cached shader.\n    * @param {Object} options\n    * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n    * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n    */\n    retrieveShader: function(options) {\n      var size = Math.sqrt(this.matrix.length);\n      var cacheKey = this.type + '_' + size + '_' + (this.opaque ? 1 : 0);\n      var shaderSource = this.fragmentSource[cacheKey];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          weights = this.matrix,\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          sw = imageData.width,\n          sh = imageData.height,\n          output = options.ctx.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt,\n          x, y, cx, cy;\n\n      for (y = 0; y < sh; y++) {\n        for (x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (cy = 0; cy < side; cy++) {\n            for (cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy >= sh || scx < 0 || scx >= sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += data[srcOff] * wt;\n              g += data[srcOff + 1] * wt;\n              b += data[srcOff + 2] * wt;\n              // eslint-disable-next-line max-depth\n              if (!alphaFac) {\n                a += data[srcOff + 3] * wt;\n              }\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          if (!alphaFac) {\n            dst[dstOff + 3] = a;\n          }\n          else {\n            dst[dstOff + 3] = data[dstOff + 3];\n          }\n        }\n      }\n      options.imageData = output;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMatrix: gl.getUniformLocation(program, 'uMatrix'),\n        uOpaque: gl.getUniformLocation(program, 'uOpaque'),\n        uHalfSize: gl.getUniformLocation(program, 'uHalfSize'),\n        uSize: gl.getUniformLocation(program, 'uSize'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    fragmentSource: {\n      average: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (color.r + color.b + color.g) / 3.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, color.a);\\n' +\n        '}',\n      lightness: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n      luminosity: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n    },\n\n\n    /**\n     * Grayscale mode, between 'average', 'lightness', 'luminosity'\n     * @param {String} type\n     * @default\n     */\n    mode: 'average',\n\n    mainParameter: 'mode',\n\n    /**\n     * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length, value,\n          mode = this.mode;\n      for (i = 0; i < len; i += 4) {\n        if (mode === 'average') {\n          value = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        }\n        else if (mode === 'lightness') {\n          value = (Math.min(data[i], data[i + 1], data[i + 2]) +\n            Math.max(data[i], data[i + 1], data[i + 2])) / 2;\n        }\n        else if (mode === 'luminosity') {\n          value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\n        }\n        data[i] = value;\n        data[i + 1] = value;\n        data[i + 2] = value;\n      }\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var shaderSource = this.fragmentSource[this.mode];\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMode: gl.getUniformLocation(program, 'uMode'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      // default average mode.\n      var mode = 1;\n      gl.uniform1i(uniformLocations.uMode, mode);\n    },\n\n    /**\n     * Grayscale filter isNeutralState implementation\n     * The filter is never neutral\n     * on the image\n     **/\n    isNeutralState: function() {\n      return false;\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform int uInvert;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'if (uInvert == 1) {\\n' +\n          'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n' +\n        '} else {\\n' +\n          'gl_FragColor = color;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * Filter invert. if false, does nothing\n     * @param {Boolean} invert\n     * @default\n     */\n    invert: true,\n\n    mainParameter: 'invert',\n\n    /**\n     * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length;\n      for (i = 0; i < len; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n    },\n\n    /**\n     * Invert filter isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function() {\n      return !this.invert;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uInvert: gl.getUniformLocation(program, 'uInvert'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1i(uniformLocations.uInvert, this.invert);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Fragment source for the noise program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uStepH;\\n' +\n      'uniform float uNoise;\\n' +\n      'uniform float uSeed;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'float rand(vec2 co, float seed, float vScale) {\\n' +\n        'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'noise',\n\n    /**\n     * Noise value, from\n     * @param {Number} noise\n     * @default\n     */\n    noise: 0,\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.noise === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          noise = this.noise, rand;\n\n      for (i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uNoise: gl.getUniformLocation(program, 'uNoise'),\n        uSeed: gl.getUniformLocation(program, 'uSeed'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\n      gl.uniform1f(uniformLocations.uSeed, Math.random());\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    blocksize: 4,\n\n    mainParameter: 'blocksize',\n\n    /**\n     * Fragment source for the Pixelate program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBlocksize;\\n' +\n      'uniform float uStepW;\\n' +\n      'uniform float uStepH;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'float blockW = uBlocksize * uStepW;\\n' +\n        'float blockH = uBlocksize * uStepW;\\n' +\n        'int posX = int(vTexCoord.x / blockW);\\n' +\n        'int posY = int(vTexCoord.y / blockH);\\n' +\n        'float fposX = float(posX);\\n' +\n        'float fposY = float(posY);\\n' +\n        'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n' +\n        'vec4 color = texture2D(uTexture, squareCoords);\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a,\n          _i, _j, _iLen, _jLen;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          _iLen = Math.min(i + this.blocksize, iLen);\n          _jLen = Math.min(j + this.blocksize, jLen);\n          for (_i = i; _i < _iLen; _i++) {\n            for (_j = j; _j < _jLen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Indicate when the filter is not gonna apply changes to the image\n     **/\n    isNeutralState: function() {\n      return this.blocksize === 1;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBlocksize: gl.getUniformLocation(program, 'uBlocksize'),\n        uStepW: gl.getUniformLocation(program, 'uStepW'),\n        uStepH: gl.getUniformLocation(program, 'uStepH'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.RemoveColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveColor.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveColor',\n\n    /**\n     * Color to remove, in any format understood by fabric.Color.\n     * @param {String} type\n     * @default\n     */\n    color: '#FFFFFF',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec4 uLow;\\n' +\n      'uniform vec4 uHigh;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n        'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n' +\n          'gl_FragColor.a = 0.0;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * distance to actual color, as value up or down from each r,g,b\n     * between 0 and 1\n     **/\n    distance: 0.02,\n\n    /**\n     * For color to remove inside distance, use alpha channel for a smoother deletion\n     * NOT IMPLEMENTED YET\n     **/\n    useAlpha: false,\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.color=#RRGGBB] Threshold value\n     * @param {Number} [options.distance=10] Distance value\n     */\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          distance = this.distance * 255,\n          r, g, b,\n          source = new fabric.Color(this.color).getSource(),\n          lowC = [\n            source[0] - distance,\n            source[1] - distance,\n            source[2] - distance,\n          ],\n          highC = [\n            source[0] + distance,\n            source[1] + distance,\n            source[2] + distance,\n          ];\n\n\n      for (i = 0; i < data.length; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > lowC[0] &&\n            g > lowC[1] &&\n            b > lowC[2] &&\n            r < highC[0] &&\n            g < highC[1] &&\n            b < highC[2]) {\n          data[i + 3] = 0;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uLow: gl.getUniformLocation(program, 'uLow'),\n        uHigh: gl.getUniformLocation(program, 'uHigh'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource(),\n          distance = parseFloat(this.distance),\n          lowC = [\n            0 + source[0] / 255 - distance,\n            0 + source[1] / 255 - distance,\n            0 + source[2] / 255 - distance,\n            1\n          ],\n          highC = [\n            source[0] / 255 + distance,\n            source[1] / 255 + distance,\n            source[2] / 255 + distance,\n            1\n          ];\n      gl.uniform4fv(uniformLocations.uLow, lowC);\n      gl.uniform4fv(uniformLocations.uHigh, highC);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  var matrices = {\n    Brownie: [\n      0.59970,0.34553,-0.27082,0,0.186,\n      -0.03770,0.86095,0.15059,0,-0.1449,\n      0.24113,-0.07441,0.44972,0,-0.02965,\n      0,0,0,1,0\n    ],\n    Vintage: [\n      0.62793,0.32021,-0.03965,0,0.03784,\n      0.02578,0.64411,0.03259,0,0.02926,\n      0.04660,-0.08512,0.52416,0,0.02023,\n      0,0,0,1,0\n    ],\n    Kodachrome: [\n      1.12855,-0.39673,-0.03992,0,0.24991,\n      -0.16404,1.08352,-0.05498,0,0.09698,\n      -0.16786,-0.56034,1.60148,0,0.13972,\n      0,0,0,1,0\n    ],\n    Technicolor: [\n      1.91252,-0.85453,-0.09155,0,0.04624,\n      -0.30878,1.76589,-0.10601,0,-0.27589,\n      -0.23110,-0.75018,1.84759,0,0.12137,\n      0,0,0,1,0\n    ],\n    Polaroid: [\n      1.438,-0.062,-0.062,0,0,\n      -0.122,1.378,-0.122,0,0,\n      -0.016,-0.016,1.483,0,0,\n      0,0,0,1,0\n    ],\n    Sepia: [\n      0.393, 0.769, 0.189, 0, 0,\n      0.349, 0.686, 0.168, 0, 0,\n      0.272, 0.534, 0.131, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n    BlackWhite: [\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      0, 0, 0, 1, 0,\n    ]\n  };\n\n  for (var key in matrices) {\n    filters[key] = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: key,\n\n      /**\n       * Colormatrix for the effect\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */\n      matrix: matrices[key],\n\n      /**\n       * Lock the matrix export for this kind of static, parameter less filters.\n       */\n      mainParameter: false,\n      /**\n       * Lock the colormatrix on the color part, skipping alpha\n       */\n      colorsOnly: true,\n\n    });\n    fabric.Image.filters[key].fromObject = fabric.Image.filters.BaseFilter.fromObject;\n  }\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'BlendColor',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    color: '#F95C63',\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend color operation.\n     **/\n    alpha: 1,\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'gl_FragColor.rgb *= uColor.rgb;\\n',\n      screen: 'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n',\n      add: 'gl_FragColor.rgb += uColor.rgb;\\n',\n      diff: 'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n',\n      subtract: 'gl_FragColor.rgb -= uColor.rgb;\\n',\n      lighten: 'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n',\n      darken: 'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n',\n      exclusion: 'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n',\n      overlay: 'if (uColor.r < 0.5) {\\n' +\n          'gl_FragColor.r *= 2.0 * uColor.r;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n' +\n        '}\\n' +\n        'if (uColor.g < 0.5) {\\n' +\n          'gl_FragColor.g *= 2.0 * uColor.g;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n' +\n        '}\\n' +\n        'if (uColor.b < 0.5) {\\n' +\n          'gl_FragColor.b *= 2.0 * uColor.b;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n' +\n        '}\\n',\n      tint: 'gl_FragColor.rgb *= (1.0 - uColor.a);\\n' +\n        'gl_FragColor.rgb += uColor.rgb;\\n',\n    },\n\n    /**\n     * build the fragment source for the filters, joining the common part with\n     * the specific one.\n     * @param {String} mode the mode of the filter, a key of this.fragmentSource\n     * @return {String} the source to be compiled\n     * @private\n     */\n    buildSource: function(mode) {\n      return 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'gl_FragColor = color;\\n' +\n          'if (color.a > 0.0) {\\n' +\n            this.fragmentSource[mode] +\n          '}\\n' +\n        '}';\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode, shaderSource;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        shaderSource = this.buildSource(this.mode);\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, iLen = data.length,\n          tr, tg, tb,\n          r, g, b,\n          source, alpha1 = 1 - this.alpha;\n\n      source = new fabric.Color(this.color).getSource();\n      tr = source[0] * this.alpha;\n      tg = source[1] * this.alpha;\n      tb = source[2] * this.alpha;\n\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 255 - (255 - r) * (255 - tr) / 255;\n            data[i + 1] = 255 - (255 - g) * (255 - tg) / 255;\n            data[i + 2] = 255 - (255 - b) * (255 - tb) / 255;\n            break;\n          case 'add':\n            data[i] = r + tr;\n            data[i + 1] = g + tg;\n            data[i + 2] = b + tb;\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            data[i] = r - tr;\n            data[i + 1] = g - tg;\n            data[i + 2] = b - tb;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n          case 'overlay':\n            data[i] = tr < 128 ? (2 * r * tr / 255) : (255 - 2 * (255 - r) * (255 - tr) / 255);\n            data[i + 1] = tg < 128 ? (2 * g * tg / 255) : (255 - 2 * (255 - g) * (255 - tg) / 255);\n            data[i + 2] = tb < 128 ? (2 * b * tb / 255) : (255 - 2 * (255 - b) * (255 - tb) / 255);\n            break;\n          case 'exclusion':\n            data[i] = tr + r - ((2 * tr * r) / 255);\n            data[i + 1] = tg + g - ((2 * tg * g) / 255);\n            data[i + 2] = tb + b - ((2 * tb * b) / 255);\n            break;\n          case 'tint':\n            data[i] = tr + r * alpha1;\n            data[i + 1] = tg + g * alpha1;\n            data[i + 2] = tb + b * alpha1;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColor: gl.getUniformLocation(program, 'uColor'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource();\n      source[0] = this.alpha * source[0] / 255;\n      source[1] = this.alpha * source[1] / 255;\n      source[2] = this.alpha * source[2] / 255;\n      source[3] = this.alpha;\n      gl.uniform4fv(uniformLocations.uColor, source);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        color: this.color,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */\n  fabric.Image.filters.BlendColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendImage = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.BlendImage.prototype */ {\n    type: 'BlendImage',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    image: null,\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend image operation.\n     * not implemented.\n     **/\n    alpha: 1,\n\n    vertexSource: 'attribute vec2 aPosition;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'varying vec2 vTexCoord2;\\n' +\n      'uniform mat3 uTransformMatrix;\\n' +\n      'void main() {\\n' +\n        'vTexCoord = aPosition;\\n' +\n        'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n' +\n        'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n      '}',\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.rgba *= color2.rgba;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      mask: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.a = color2.a;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      var shaderSource = this.fragmentSource[this.mode];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    applyToWebGL: function(options) {\n      // load texture to blend.\n      var gl = options.context,\n          texture = this.createTexture(options.filterBackend, this.image);\n      this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\n      this.callSuper('applyToWebGL', options);\n      this.unbindAdditionalTexture(gl, gl.TEXTURE1);\n    },\n\n    createTexture: function(backend, image) {\n      return backend.getCachedTexture(image.cacheKey, image._element);\n    },\n\n    /**\n     * Calculate a transformMatrix to adapt the image to blend over\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    calculateMatrix: function() {\n      var image = this.image,\n          width = image._element.width,\n          height = image._element.height;\n      return [\n        1 / image.scaleX, 0, 0,\n        0, 1 / image.scaleY, 0,\n        -image.left / width, -image.top / height, 1\n      ];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          resources = options.filterBackend.resources,\n          data = imageData.data, iLen = data.length,\n          width = imageData.width,\n          height = imageData.height,\n          tr, tg, tb, ta,\n          r, g, b, a,\n          canvas1, context, image = this.image, blendData;\n\n      if (!resources.blendImage) {\n        resources.blendImage = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blendImage;\n      context = canvas1.getContext('2d');\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas1.width = width;\n        canvas1.height = height;\n      }\n      else {\n        context.clearRect(0, 0, width, height);\n      }\n      context.setTransform(image.scaleX, 0, 0, image.scaleY, image.left, image.top);\n      context.drawImage(image._element, 0, 0, width, height);\n      blendData = context.getImageData(0, 0, width, height).data;\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n\n        tr = blendData[i];\n        tg = blendData[i + 1];\n        tb = blendData[i + 2];\n        ta = blendData[i + 3];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            data[i + 3] = a * ta / 255;\n            break;\n          case 'mask':\n            data[i + 3] = ta;\n            break;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uTransformMatrix: gl.getUniformLocation(program, 'uTransformMatrix'),\n        uImage: gl.getUniformLocation(program, 'uImage'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var matrix = this.calculateMatrix();\n      gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\n      gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        image: this.image && this.image.toObject(),\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */\n  fabric.Image.filters.BlendImage.fromObject = function(object, callback) {\n    fabric.Image.fromObject(object.image, function(image) {\n      var options = fabric.util.object.clone(object);\n      options.image = image;\n      callback(new fabric.Image.filters.BlendImage(options));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * for webgl resizeType is just lanczos, for canvas2d can be:\n     * bilinear, hermite, sliceHack, lanczos.\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 1,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 1,\n\n    /**\n     * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uDelta: gl.getUniformLocation(program, 'uDelta'),\n        uTaps: gl.getUniformLocation(program, 'uTaps'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform2fv(uniformLocations.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]);\n      gl.uniform1fv(uniformLocations.uTaps, this.taps);\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var filterWindow = this.getFilterWindow(), cacheKey = this.type + '_' + filterWindow;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var fragmentShader = this.generateShader(filterWindow);\n        options.programCache[cacheKey] = this.createProgram(options.context, fragmentShader);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    getFilterWindow: function() {\n      var scale = this.tempScale;\n      return Math.ceil(this.lanczosLobes / scale);\n    },\n\n    getTaps: function() {\n      var lobeFunction = this.lanczosCreate(this.lanczosLobes), scale = this.tempScale,\n          filterWindow = this.getFilterWindow(), taps = new Array(filterWindow);\n      for (var i = 1; i <= filterWindow; i++) {\n        taps[i - 1] = lobeFunction(i * scale);\n      }\n      return taps;\n    },\n\n    /**\n     * Generate vertex and shader sources from the necessary steps numbers\n     * @param {Number} filterWindow\n     */\n    generateShader: function(filterWindow) {\n      var offsets = new Array(filterWindow),\n          fragmentShader = this.fragmentSourceTOP, filterWindow;\n\n      for (var i = 1; i <= filterWindow; i++) {\n        offsets[i - 1] = i + '.0 * uDelta';\n      }\n\n      fragmentShader += 'uniform float uTaps[' + filterWindow + '];\\n';\n      fragmentShader += 'void main() {\\n';\n      fragmentShader += '  vec4 color = texture2D(uTexture, vTexCoord);\\n';\n      fragmentShader += '  float sum = 1.0;\\n';\n\n      offsets.forEach(function(offset, i) {\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord + ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord - ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  sum += 2.0 * uTaps[' + i + '];\\n';\n      });\n      fragmentShader += '  gl_FragColor = color / sum;\\n';\n      fragmentShader += '}';\n      return fragmentShader;\n    },\n\n    fragmentSourceTOP: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n',\n\n    /**\n     * Apply the resize filter to the image\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      if (options.webgl) {\n        options.passes++;\n        this.width = options.sourceWidth;\n        this.horizontal = true;\n        this.dW = Math.round(this.width * this.scaleX);\n        this.dH = options.sourceHeight;\n        this.tempScale = this.dW / this.width;\n        this.taps = this.getTaps();\n        options.destinationWidth = this.dW;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceWidth = options.destinationWidth;\n\n        this.height = options.sourceHeight;\n        this.horizontal = false;\n        this.dH = Math.round(this.height * this.scaleY);\n        this.tempScale = this.dH / this.height;\n        this.taps = this.getTaps();\n        options.destinationHeight = this.dH;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceHeight = options.destinationHeight;\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    isNeutralState: function() {\n      return this.scaleX === 1 && this.scaleY === 1;\n    },\n\n    lanczosCreate: function(lobes) {\n      return function(x) {\n        if (x >= lobes || x <= -lobes) {\n          return 0.0;\n        }\n        if (x < 1.19209290E-07 && x > -1.19209290E-07) {\n          return 1.0;\n        }\n        x *= Math.PI;\n        var xx = x / lobes;\n        return (sin(x) / x) * sin(xx) / xx;\n      };\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          scaleX = this.scaleX,\n          scaleY = this.scaleY;\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = imageData.width, oH = imageData.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          newData;\n\n      if (this.resizeType === 'sliceHack') {\n        newData = this.sliceByTwo(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'hermite') {\n        newData = this.hermiteFastResize(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'bilinear') {\n        newData = this.bilinearFiltering(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'lanczos') {\n        newData = this.lanczosResize(options, oW, oH, dW, dH);\n      }\n      options.imageData = newData;\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(options, oW, oH, dW, dH) {\n      var imageData = options.imageData,\n          mult = 0.5, doneW = false, doneH = false, stepW = oW * mult,\n          stepH = oH * mult, resources = fabric.filterBackend.resources,\n          tmpCanvas, ctx, sX = 0, sY = 0, dX = oW, dY = 0;\n      if (!resources.sliceByTwo) {\n        resources.sliceByTwo = document.createElement('canvas');\n      }\n      tmpCanvas = resources.sliceByTwo;\n      if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\n        tmpCanvas.width = oW * 1.5;\n        tmpCanvas.height = oH;\n      }\n      ctx = tmpCanvas.getContext('2d');\n      ctx.clearRect(0, 0, oW * 1.5, oH);\n      ctx.putImageData(imageData, 0, 0);\n\n      dW = floor(dW);\n      dH = floor(dH);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW < floor(stepW * mult)) {\n          stepW = floor(stepW * mult);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH < floor(stepH * mult)) {\n          stepH = floor(stepH * mult);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\n        sX = dX;\n        sY = dY;\n        dY += stepH;\n      }\n      return ctx.getImageData(sX, sY, dW, dH);\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(options, oW, oH, dW, dH) {\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var srcData = options.imageData.data,\n          destImg = options.ctx.createImageData(dW, dH),\n          destData = destImg.data,\n          lanczos = this.lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(options, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          w4 = 4 * (oW - 1), img = options.imageData,\n          pixels = img.data, destImage = options.ctx.createImageData(dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(options, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          img = options.imageData, data = img.data,\n          img2 = options.ctx.createImageData(dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 0.25\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uContrast;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n' +\n        'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * contrast value, range from -1 to 1.\n     * @param {Number} contrast\n     * @default 0\n     */\n    contrast: 0,\n\n    mainParameter: 'contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n     */\n\n    /**\n      * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n      *\n      * @param {Object} options\n      * @param {ImageData} options.imageData The Uint8Array to be filtered.\n      */\n    applyTo2d: function(options) {\n      if (this.contrast === 0) {\n        return;\n      }\n      var imageData = options.imageData, i, len,\n          data = imageData.data, len = data.length,\n          contrast = Math.floor(this.contrast * 255),\n          contrastF = 259 * (contrast + 255) / (255 * (259 - contrast));\n\n      for (i = 0; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uContrast: gl.getUniformLocation(program, 'uContrast'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uContrast, this.contrast);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Saturation = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturation',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uSaturation;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float rgMax = max(color.r, color.g);\\n' +\n        'float rgbMax = max(rgMax, color.b);\\n' +\n        'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n' +\n        'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n' +\n        'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    saturation: 0,\n\n    mainParameter: 'saturation',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n     */\n\n    /**\n     * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.saturation === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.saturation, i, max;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uSaturation: gl.getUniformLocation(program, 'uSaturation'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Blur = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blur.prototype */ {\n\n    type: 'Blur',\n\n    /*\n'gl_FragColor = vec4(0.0);',\n'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n*/\n\n    /* eslint-disable max-len */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'const float nSamples = 15.0;\\n' +\n      'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n' +\n      'float random(vec3 scale) {\\n' +\n        /* use the fragment position for a different seed per-pixel */\n        'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = vec4(0.0);\\n' +\n        'float total = 0.0;\\n' +\n        'float offset = random(v3offset);\\n' +\n        'for (float t = -nSamples; t <= nSamples; t++) {\\n' +\n          'float percent = (t + offset - 0.5) / nSamples;\\n' +\n          'float weight = 1.0 - abs(percent);\\n' +\n          'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n' +\n          'total += weight;\\n' +\n        '}\\n' +\n        'gl_FragColor = color / total;\\n' +\n      '}',\n    /* eslint-enable max-len */\n\n    /**\n     * blur value, in percentage of image dimensions.\n     * specific to keep the image blur constant at different resolutions\n     * range bewteen 0 and 1.\n     */\n    blur: 0,\n\n    mainParameter: 'blur',\n\n    applyTo: function(options) {\n      if (options.webgl) {\n        // this aspectRatio is used to give the same blur to vertical and horizontal\n        this.aspectRatio = options.sourceWidth / options.sourceHeight;\n        options.passes++;\n        this._setupFrameBuffer(options);\n        this.horizontal = true;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        this._setupFrameBuffer(options);\n        this.horizontal = false;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    applyTo2d: function(options) {\n      // paint canvasEl with current image data.\n      //options.ctx.putImageData(options.imageData, 0, 0);\n      options.imageData = this.simpleBlur(options);\n    },\n\n    simpleBlur: function(options) {\n      var resources = options.filterBackend.resources, canvas1, canvas2,\n          width = options.imageData.width,\n          height = options.imageData.height;\n\n      if (!resources.blurLayer1) {\n        resources.blurLayer1 = fabric.util.createCanvasElement();\n        resources.blurLayer2 = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blurLayer1;\n      canvas2 = resources.blurLayer2;\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas2.width = canvas1.width = width;\n        canvas2.height = canvas1.height = height;\n      }\n      var ctx1 = canvas1.getContext('2d'),\n          ctx2 = canvas2.getContext('2d'),\n          nSamples = 15,\n          random, percent, j, i,\n          blur = this.blur * 0.06 * 0.5;\n\n      // load first canvas\n      ctx1.putImageData(options.imageData, 0, 0);\n      ctx2.clearRect(0, 0, width, height);\n\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * width + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, j, random);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * height + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, random, j);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      options.ctx.drawImage(canvas1, 0, 0);\n      var newImageData = options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\n      ctx1.globalAlpha = 1;\n      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\n      return newImageData;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        delta: gl.getUniformLocation(program, 'uDelta'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var delta = this.chooseRightDelta();\n      gl.uniform2fv(uniformLocations.delta, delta);\n    },\n\n    /**\n     * choose right value of image percentage to blur with\n     * @returns {Array} a numeric array with delta values\n     */\n    chooseRightDelta: function() {\n      var blurScale = 1, delta = [0, 0], blur;\n      if (this.horizontal) {\n        if (this.aspectRatio > 1) {\n          // image is wide, i want to shrink radius horizontal\n          blurScale = 1 / this.aspectRatio;\n        }\n      }\n      else {\n        if (this.aspectRatio < 1) {\n          // image is tall, i want to shrink radius vertical\n          blurScale = this.aspectRatio;\n        }\n      }\n      blur = blurScale * this.blur * 0.12;\n      if (this.horizontal) {\n        delta[0] = blur;\n      }\n      else {\n        delta[1] = blur;\n      }\n      return delta;\n    },\n  });\n\n  /**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   gamma: [1, 0.5, 2.1]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Gamma = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Gamma.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Gamma',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec3 uGamma;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'vec3 correction = (1.0 / uGamma);\\n' +\n        'color.r = pow(color.r, correction.r);\\n' +\n        'color.g = pow(color.g, correction.g);\\n' +\n        'color.b = pow(color.b, correction.b);\\n' +\n        'gl_FragColor = color;\\n' +\n        'gl_FragColor.rgb *= color.a;\\n' +\n      '}',\n\n    /**\n     * Gamma array value, from 0.01 to 2.2.\n     * @param {Array} gamma\n     * @default\n     */\n    gamma: [1, 1, 1],\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'gamma',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.gamma = [1, 1, 1];\n      filters.BaseFilter.prototype.initialize.call(this, options);\n    },\n\n    /**\n     * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData, data = imageData.data,\n          gamma = this.gamma, len = data.length,\n          rInv = 1 / gamma[0], gInv = 1 / gamma[1],\n          bInv = 1 / gamma[2], i;\n\n      if (!this.rVals) {\n        // eslint-disable-next-line\n        this.rVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.gVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.bVals = new Uint8Array(256);\n      }\n\n      // This is an optimization - pre-compute a look-up table for each color channel\n      // instead of performing these pow calls for each pixel in the image.\n      for (i = 0, len = 256; i < len; i++) {\n        this.rVals[i] = Math.pow(i / 255, rInv) * 255;\n        this.gVals[i] = Math.pow(i / 255, gInv) * 255;\n        this.bVals[i] = Math.pow(i / 255, bInv) * 255;\n      }\n      for (i = 0, len = data.length; i < len; i += 4) {\n        data[i] = this.rVals[data[i]];\n        data[i + 1] = this.gVals[data[i + 1]];\n        data[i + 2] = this.bVals[data[i + 2]];\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uGamma: gl.getUniformLocation(program, 'uGamma'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform3fv(uniformLocations.uGamma, this.gamma);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */\n  fabric.Image.filters.Gamma.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */\n  filters.Composed = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Composed.prototype */ {\n\n    type: 'Composed',\n\n    /**\n     * A non sparse array of filters to apply\n     */\n    subFilters: [],\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.subFilters = this.subFilters.slice(0);\n    },\n\n    /**\n     * Apply this container's filters to the input image provided.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be applied.\n     */\n    applyTo: function(options) {\n      options.passes += this.subFilters.length - 1;\n      this.subFilters.forEach(function(filter) {\n        filter.applyTo(options);\n      });\n    },\n\n    /**\n     * Serialize this filter into JSON.\n     *\n     * @returns {Object} A JSON representation of this filter.\n     */\n    toObject: function() {\n      return fabric.util.object.extend(this.callSuper('toObject'), {\n        subFilters: this.subFilters.map(function(filter) { return filter.toObject(); }),\n      });\n    },\n\n    isNeutralState: function() {\n      return !this.subFilters.some(function(filter) { return !filter.isNeutralState(); });\n    }\n  });\n\n  /**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */\n  fabric.Image.filters.Composed.fromObject = function(object, callback) {\n    var filters = object.subFilters || [],\n        subFilters = filters.map(function(filter) {\n          return new fabric.Image.filters[filter.type](filter);\n        }),\n        instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\n    callback && callback(instance);\n    return instance;\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.HueRotation = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.HueRotation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'HueRotation',\n\n    /**\n     * HueRotation value, from -1 to 1.\n     * the unit is radians\n     * @param {Number} myParameter\n     * @default\n     */\n    rotation: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'rotation',\n\n    calculateMatrix: function() {\n      var rad = this.rotation * Math.PI, cos = fabric.util.cos(rad), sin = fabric.util.sin(rad),\n          aThird = 1 / 3, aThirdSqtSin = Math.sqrt(aThird) * sin, OneMinusCos = 1 - cos;\n      this.matrix = [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n      this.matrix[0] = cos + OneMinusCos / 3;\n      this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[6] = cos + aThird * OneMinusCos;\n      this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[12] = cos + aThird * OneMinusCos;\n    },\n\n    /**\n     * HueRotation isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function(options) {\n      this.calculateMatrix();\n      return filters.BaseFilter.prototype.isNeutralState.call(this, options);\n    },\n\n    /**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      this.calculateMatrix();\n      filters.BaseFilter.prototype.applyTo.call(this, options);\n    },\n\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */\n  fabric.Image.filters.HueRotation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      clone = fabric.util.object.clone;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Array\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign',\n      'styles',\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespaces that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]/g,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpaceAndTab: /[ \\t\\r]/,\n\n    /**\n     * Use this regular expression to filter consecutive groups of non spaces.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reWords: /\\S+/g,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration underline.\n     * @type Boolean\n     * @default\n     */\n    underline:       false,\n\n    /**\n     * Text decoration overline.\n     * @type Boolean\n     * @default\n     */\n    overline:       false,\n\n    /**\n     * Text decoration linethrough.\n     * @type Boolean\n     * @default\n     */\n    linethrough:       false,\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n     * \"justify-left\", \"justify-center\" or \"justify-right\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            'normal',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Superscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    superscript: {\n      size:      0.60, // fontSize factor\n      baseline: -0.35  // baseline-shift factor (upwards)\n    },\n\n    /**\n     * Subscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    subscript: {\n      size:      0.60, // fontSize factor\n      baseline:  0.11  // baseline-shift factor (downwards)\n    },\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('fontFamily',\n      'fontWeight',\n      'fontSize',\n      'text',\n      'underline',\n      'overline',\n      'linethrough',\n      'textAlign',\n      'fontStyle',\n      'lineHeight',\n      'textBackgroundColor',\n      'charSpacing',\n      'styles'),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('fontFamily',\n      'fontWeight',\n      'fontSize',\n      'text',\n      'underline',\n      'overline',\n      'linethrough',\n      'textAlign',\n      'fontStyle',\n      'lineHeight',\n      'textBackgroundColor',\n      'charSpacing',\n      'styles'),\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.222,\n\n    /**\n     * @private\n     */\n    offsets: {\n      underline: 0.10,\n      linethrough: -0.315,\n      overline: -0.88\n    },\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Object containing character styles - top-level properties -> line numbers,\n     * 2nd-level properties - charater numbers\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Reference to a context to measure text char or couple of chars\n     * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n     * once created it will be referenced on fabric._measuringContext to avoide creating a canvas for every\n     * text object created.\n     * @type {CanvasRenderingContext2D}\n     * @default\n     */\n    _measuringContext: null,\n\n    /**\n     * Baseline shift, stlyes only, keep at 0 for the main text object\n     * @type {Number}\n     * @default\n     */\n    deltaY: 0,\n\n    /**\n     * Array of properties that define a style unit (of 'styles').\n     * @type {Array}\n     * @default\n     */\n    _styleProperties: [\n      'stroke',\n      'strokeWidth',\n      'fill',\n      'fontFamily',\n      'fontSize',\n      'fontWeight',\n      'fontStyle',\n      'underline',\n      'overline',\n      'linethrough',\n      'deltaY',\n      'textBackgroundColor',\n    ],\n\n    /**\n     * contains characters bounding boxes\n     */\n    __charBounds: [],\n\n    /**\n     * use this size when measuring text. To avoid IE11 rounding errors\n     * @type {Number}\n     * @default\n     * @readonly\n     * @private\n     */\n    CACHE_FONT_SIZE: 400,\n\n    /**\n     * contains the min text width to avoid getting 0\n     * @type {Number}\n     * @default\n     */\n    MIN_TEXT_WIDTH: 2,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      this.__skipDimension = false;\n      this.initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Return a contex for measurement of text string.\n     * if created it gets stored for reuse\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    getMeasuringContext: function() {\n      // if we did not return we have to measure something.\n      if (!fabric._measuringContext) {\n        fabric._measuringContext = this.canvas && this.canvas.contextCache ||\n          fabric.util.createCanvasElement().getContext('2d');\n      }\n      return fabric._measuringContext;\n    },\n\n    /**\n     * @private\n     * Divides text into lines of text and lines of graphemes.\n     */\n    _splitText: function() {\n      var newLines = this._splitTextIntoLines(this.text);\n      this.textLines = newLines.lines;\n      this._textLines = newLines.graphemeLines;\n      this._unwrappedTextLines = newLines._unwrappedLines;\n      this._text = newLines.graphemeText;\n      return newLines;\n    },\n\n    /**\n     * Initialize or update text dimensions.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this._splitText();\n      this._clearCache();\n      this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Enlarge space boxes and shift the others\n     */\n    enlargeSpaces: function() {\n      var diffSpace, currentLineWidth, numberOfSpaces, accumulatedSpace, line, charBound, spaces;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textAlign !== 'justify' && (i === len - 1 || this.isEndOfWrapping(i))) {\n          continue;\n        }\n        accumulatedSpace = 0;\n        line = this._textLines[i];\n        currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth < this.width && (spaces = this.textLines[i].match(this._reSpacesAndTabs))) {\n          numberOfSpaces = spaces.length;\n          diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\n          for (var j = 0, jlen = line.length; j <= jlen; j++) {\n            charBound = this.__charBounds[i][j];\n            if (this._reSpaceAndTab.test(line[j])) {\n              charBound.width += diffSpace;\n              charBound.kernedWidth += diffSpace;\n              charBound.left += accumulatedSpace;\n              accumulatedSpace += diffSpace;\n            }\n            else {\n              charBound.left += accumulatedSpace;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      return lineIndex === this._textLines.length - 1;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * It return always for text and Itext.\n     * @return Number\n     */\n    missingNewlineOffset: function() {\n      return 1;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @param {Object} dim.x width of object to be cached\n     * @param {Object} dim.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dims = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dims.width += fontSize * dims.zoomX;\n      dims.height += fontSize * dims.zoomY;\n      return dims;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this._setTextStyles(ctx);\n      this._renderTextLinesBackground(ctx);\n      this._renderTextDecoration(ctx, 'underline');\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx, 'overline');\n      this._renderTextDecoration(ctx, 'linethrough');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderTextStroke(ctx);\n        this._renderTextFill(ctx);\n      }\n      else {\n        this._renderTextFill(ctx);\n        this._renderTextStroke(ctx);\n      }\n    },\n\n    /**\n     * Set the font parameter of the context with the object properties or with charStyle\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [charStyle] object with font style properties\n     * @param {String} [charStyle.fontFamily] Font Family\n     * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n     * @param {String} [charStyle.fontWeight] Font weight\n     * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n     */\n    _setTextStyles: function(ctx, charStyle, forMeasuring) {\n      ctx.textBaseline = 'alphabetic';\n      ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\n    },\n\n    /**\n     * calculate and return the text Width measuring each line.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    calcTextWidth: function() {\n      var maxWidth = this.getLineWidth(0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      this._renderChars(method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * Renders the text background for lines, taking care of style\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor')) {\n        return;\n      }\n      var lineTopOffset = 0, heightOfLine,\n          lineLeftOffset, originalFill = ctx.fillStyle,\n          line, lastColor,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(),\n          boxStart = 0, boxWidth = 0, charBox, currentColor;\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor', i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxWidth = 0;\n        boxStart = 0;\n        lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n          if (currentColor !== lastColor) {\n            ctx.fillStyle = lastColor;\n            lastColor && ctx.fillRect(\n              leftOffset + lineLeftOffset + boxStart,\n              topOffset + lineTopOffset,\n              boxWidth,\n              heightOfLine / this.lineHeight\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastColor = currentColor;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        if (currentColor) {\n          ctx.fillStyle = currentColor;\n          ctx.fillRect(\n            leftOffset + lineLeftOffset + boxStart,\n            topOffset + lineTopOffset,\n            boxWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Object} decl style declaration for cache\n     * @param {String} decl.fontFamily fontFamily\n     * @param {String} decl.fontStyle fontStyle\n     * @param {String} decl.fontWeight fontWeight\n     * @return {Object} reference to cache\n     */\n    getFontCache: function(decl) {\n      var fontFamily = decl.fontFamily.toLowerCase();\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      var cache = fabric.charWidthsCache[fontFamily],\n          cacheProp = decl.fontStyle.toLowerCase() + '_' + (decl.fontWeight + '').toLowerCase();\n      if (!cache[cacheProp]) {\n        cache[cacheProp] = { };\n      }\n      return cache[cacheProp];\n    },\n\n    /**\n     * apply all the character style to canvas for rendering\n     * @private\n     * @param {String} _char\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} [decl]\n     */\n    _applyCharStyles: function(method, ctx, lineIndex, charIndex, styleDeclaration) {\n\n      this._setFillStyles(ctx, styleDeclaration);\n      this._setStrokeStyles(ctx, styleDeclaration);\n\n      ctx.font = this._getFontDeclaration(styleDeclaration);\n    },\n\n    /**\n     * measure and return the width of a single character.\n     * possibly overridden to accommodate different measure logic or\n     * to hook some external lib for character measurement\n     * @private\n     * @param {String} _char, char to be measured\n     * @param {Object} charStyle style of char to be measured\n     * @param {String} [previousChar] previous char\n     * @param {Object} [prevCharStyle] style of previous char\n     */\n    _measureChar: function(_char, charStyle, previousChar, prevCharStyle) {\n      // first i try to return from cache\n      var fontCache = this.getFontCache(charStyle), fontDeclaration = this._getFontDeclaration(charStyle),\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle), couple = previousChar + _char,\n          stylesAreEqual = fontDeclaration === previousFontDeclaration, width, coupleWidth, previousWidth,\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE, kernedWidth;\n\n      if (previousChar && fontCache[previousChar] !== undefined) {\n        previousWidth = fontCache[previousChar];\n      }\n      if (fontCache[_char] !== undefined) {\n        kernedWidth = width = fontCache[_char];\n      }\n      if (stylesAreEqual && fontCache[couple] !== undefined) {\n        coupleWidth = fontCache[couple];\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      if (width === undefined || previousWidth === undefined || coupleWidth === undefined) {\n        var ctx = this.getMeasuringContext();\n        // send a TRUE to specify measuring font size CACHE_FONT_SIZE\n        this._setTextStyles(ctx, charStyle, true);\n      }\n      if (width === undefined) {\n        kernedWidth = width = ctx.measureText(_char).width;\n        fontCache[_char] = width;\n      }\n      if (previousWidth === undefined && stylesAreEqual && previousChar) {\n        previousWidth = ctx.measureText(previousChar).width;\n        fontCache[previousChar] = previousWidth;\n      }\n      if (stylesAreEqual && coupleWidth === undefined) {\n        // we can measure the kerning couple and subtract the width of the previous character\n        coupleWidth = ctx.measureText(couple).width;\n        fontCache[couple] = coupleWidth;\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      return { width: width * fontMultiplier, kernedWidth: kernedWidth * fontMultiplier };\n    },\n\n    /**\n     * Computes height of character at given position\n     * @param {Number} line the line index number\n     * @param {Number} _char the character index number\n     * @return {Number} fontSize of the character\n     */\n    getHeightOfChar: function(line, _char) {\n      return this.getValueOfPropertyAt(line, _char, 'fontSize');\n    },\n\n    /**\n     * measure a text line measuring all characters.\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    measureLine: function(lineIndex) {\n      var lineInfo = this._measureLine(lineIndex);\n      if (this.charSpacing !== 0) {\n        lineInfo.width -= this._getWidthOfCharSpacing();\n      }\n      if (lineInfo.width < 0) {\n        lineInfo.width = 0;\n      }\n      return lineInfo;\n    },\n\n    /**\n     * measure every grapheme of a line, populating __charBounds\n     * @param {Number} lineIndex\n     * @return {Object} object.width total width of characters\n     * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n     */\n    _measureLine: function(lineIndex) {\n      var width = 0, i, grapheme, line = this._textLines[lineIndex], prevGrapheme,\n          graphemeInfo, numOfSpaces = 0, lineBounds = new Array(line.length);\n\n      this.__charBounds[lineIndex] = lineBounds;\n      for (i = 0; i < line.length; i++) {\n        grapheme = line[i];\n        graphemeInfo = this._getGraphemeBox(grapheme, lineIndex, i, prevGrapheme);\n        lineBounds[i] = graphemeInfo;\n        width += graphemeInfo.kernedWidth;\n        prevGrapheme = grapheme;\n      }\n      // this latest bound box represent the last character of the line\n      // to simplify cursor handling in interactive mode.\n      lineBounds[i] = {\n        left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\n        width: 0,\n        kernedWidth: 0,\n        height: this.fontSize\n      };\n      return { width: width, numOfSpaces: numOfSpaces };\n    },\n\n    /**\n     * Measure and return the info of a single grapheme.\n     * needs the the info of previous graphemes already filled\n     * @private\n     * @param {String} grapheme to be measured\n     * @param {Number} lineIndex index of the line where the char is\n     * @param {Number} charIndex position in the line\n     * @param {String} [prevGrapheme] character preceding the one to be measured\n     */\n    _getGraphemeBox: function(grapheme, lineIndex, charIndex, prevGrapheme, skipLeft) {\n      var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          prevStyle = prevGrapheme ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1) : { },\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\n          kernedWidth = info.kernedWidth,\n          width = info.width, charSpacing;\n\n      if (this.charSpacing !== 0) {\n        charSpacing = this._getWidthOfCharSpacing();\n        width += charSpacing;\n        kernedWidth += charSpacing;\n      }\n\n      var box = {\n        width: width,\n        left: 0,\n        height: style.fontSize,\n        kernedWidth: kernedWidth,\n        deltaY: style.deltaY,\n      };\n      if (charIndex > 0 && !skipLeft) {\n        var previousBox = this.__charBounds[lineIndex][charIndex - 1];\n        box.left = previousBox.left + previousBox.width + info.kernedWidth - info.width;\n      }\n      return box;\n    },\n\n    /**\n     * Calculate height of line at 'lineIndex'\n     * @param {Number} lineIndex index of line to calculate\n     * @return {Number}\n     */\n    getHeightOfLine: function(lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          // char 0 is measured before the line cycle because it nneds to char\n          // emptylines\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\n      for (var i = 1, len = line.length; i < len; i++) {\n        maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\n      }\n\n      return this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n    },\n\n    /**\n     * Calculate text box height\n     */\n    calcTextHeight: function() {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this.getHeightOfLine(i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return -this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n      ctx.save();\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset(),\n          offsets = this._applyPatternGradientTransform(ctx, method === 'fillText' ? this.fill : this.stroke);\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this.getHeightOfLine(i),\n            maxHeight = heightOfLine / this.lineHeight,\n            leftOffset = this._getLineLeftOffset(i);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset - offsets.offsetX,\n          top + lineHeights + maxHeight - offsets.offsetY,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && !this.styleHas('fill')) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method fillText or strokeText.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} line Content of the line, splitted in an array by grapheme\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox,\n          boxWidth = 0,\n          timeToRender,\n          shortCut = !isJustify && this.charSpacing === 0 && this.isEmptyStyles(lineIndex);\n\n      ctx.save();\n      top -= lineHeight * this._fontSizeFraction / this.lineHeight;\n      if (shortCut) {\n        // render all the line in one pass without checking\n        this._renderChar(method, ctx, lineIndex, 0, line.join(''), left, top, lineHeight);\n        ctx.restore();\n        return;\n      }\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          left += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = this._hasStyleChanged(actualStyle, nextStyle);\n        }\n        if (timeToRender) {\n          this._renderChar(method, ctx, lineIndex, i, charsToRender, left, top, lineHeight);\n          charsToRender = '';\n          actualStyle = nextStyle;\n          left += boxWidth;\n          boxWidth = 0;\n        }\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, charIndex, _char, left, top) {\n      var decl = this._getStyleDeclaration(lineIndex, charIndex),\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          shouldFill = method === 'fillText' && fullDecl.fill,\n          shouldStroke = method === 'strokeText' && fullDecl.stroke && fullDecl.strokeWidth;\n\n      if (!shouldStroke && !shouldFill) {\n        return;\n      }\n      decl && ctx.save();\n\n      this._applyCharStyles(method, ctx, lineIndex, charIndex, fullDecl);\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (decl && decl.deltaY) {\n        top += decl.deltaY;\n      }\n\n      shouldFill && ctx.fillText(_char, left, top);\n      shouldStroke && ctx.strokeText(_char, left, top);\n      decl && ctx.restore();\n    },\n\n    /**\n     * Turns the character into a 'superior figure' (i.e. 'superscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSuperscript: function(start, end) {\n      return this._setScript(start, end, this.superscript);\n    },\n\n    /**\n     * Turns the character into an 'inferior figure' (i.e. 'subscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSubscript: function(start, end) {\n      return this._setScript(start, end, this.subscript);\n    },\n\n    /**\n     * Applies 'schema' at given position\n     * @private\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @param {Number} schema\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    _setScript: function(start, end, schema) {\n      var loc = this.get2DCursorLocation(start, true),\n          fontSize = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'fontSize'),\n          dy = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'deltaY'),\n          style = { fontSize: fontSize * schema.size, deltaY: dy + fontSize * schema.baseline };\n      this.setSelectionStyles(style, start, end);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChanged: function(prevStyle, thisStyle) {\n      return prevStyle.fill !== thisStyle.fill ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.deltaY !== thisStyle.deltaY;\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChangedForSvg: function(prevStyle, thisStyle) {\n      return this._hasStyleChanged(prevStyle, thisStyle) ||\n        prevStyle.overline !== thisStyle.overline ||\n        prevStyle.underline !== thisStyle.underline ||\n        prevStyle.linethrough !== thisStyle.linethrough;\n    },\n\n    /**\n     * @private\n     * @param {Number} lineIndex index text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineIndex) {\n      var lineWidth = this.getLineWidth(lineIndex);\n      if (this.textAlign === 'center') {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'right') {\n        return this.width - lineWidth;\n      }\n      if (this.textAlign === 'justify-center' && this.isEndOfWrapping(lineIndex)) {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'justify-right' && this.isEndOfWrapping(lineIndex)) {\n        return this.width - lineWidth;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n      this.__charBounds = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.dirty = true;\n        this._forceClearCache = false;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * Measure a single line given its index. Used to calculate the initial\n     * text bounding box. The values are calculated and stored in __lineWidths cache.\n     * @private\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    getLineWidth: function(lineIndex) {\n      if (this.__lineWidths[lineIndex]) {\n        return this.__lineWidths[lineIndex];\n      }\n\n      var width, line = this._textLines[lineIndex], lineInfo;\n\n      if (line === '') {\n        width = 0;\n      }\n      else {\n        lineInfo = this.measureLine(lineIndex);\n        width = lineInfo.width;\n      }\n      this.__lineWidths[lineIndex] = width;\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * Retrieves the value of property at given character position\n     * @param {Number} lineIndex the line number\n     * @param {Number} charIndex the charater number\n     * @param {String} property the property name\n     * @returns the value of 'property'\n     */\n    getValueOfPropertyAt: function(lineIndex, charIndex, property) {\n      var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\n      if (charStyle && typeof charStyle[property] !== 'undefined') {\n        return charStyle[property];\n      }\n      return this[property];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx, type) {\n      if (!this[type] && !this.styleHas(type)) {\n        return;\n      }\n      var heightOfLine, size, _size,\n          lineLeftOffset, dy, _dy,\n          line, lastDecoration,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(), top,\n          boxStart, boxWidth, charBox, currentDecoration,\n          maxHeight, currentFill, lastFill,\n          charSpacing = this._getWidthOfCharSpacing();\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this[type] && !this.styleHas(type, i)) {\n          topOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        maxHeight = heightOfLine / this.lineHeight;\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxStart = 0;\n        boxWidth = 0;\n        lastDecoration = this.getValueOfPropertyAt(i, 0, type);\n        lastFill = this.getValueOfPropertyAt(i, 0, 'fill');\n        top = topOffset + maxHeight * (1 - this._fontSizeFraction);\n        size = this.getHeightOfChar(i, 0);\n        dy = this.getValueOfPropertyAt(i, 0, 'deltaY');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentDecoration = this.getValueOfPropertyAt(i, j, type);\n          currentFill = this.getValueOfPropertyAt(i, j, 'fill');\n          _size = this.getHeightOfChar(i, j);\n          _dy = this.getValueOfPropertyAt(i, j, 'deltaY');\n          if ((currentDecoration !== lastDecoration || currentFill !== lastFill || _size !== size || _dy !== dy) &&\n              boxWidth > 0) {\n            ctx.fillStyle = lastFill;\n            lastDecoration && lastFill && ctx.fillRect(\n              leftOffset + lineLeftOffset + boxStart,\n              top + this.offsets[type] * size + dy,\n              boxWidth,\n              this.fontSize / 15\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastDecoration = currentDecoration;\n            lastFill = currentFill;\n            size = _size;\n            dy = _dy;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        ctx.fillStyle = currentFill;\n        currentDecoration && currentFill && ctx.fillRect(\n          leftOffset + lineLeftOffset + boxStart,\n          top + this.offsets[type] * size + dy,\n          boxWidth - charSpacing,\n          this.fontSize / 15\n        );\n        topOffset += heightOfLine;\n      }\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @param {Object} [styleObject] object\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function(styleObject, forMeasuring) {\n      var style = styleObject || this, family = this.fontFamily,\n          fontIsGeneric = fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\n      var fontFamily = family === undefined ||\n      family.indexOf('\\'') > -1 || family.indexOf(',') > -1 ||\n      family.indexOf('\"') > -1 || fontIsGeneric\n        ? style.fontFamily : '\"' + style.fontFamily + '\"';\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        // verify if this can be fixed in JSDOM\n        (fabric.isLikelyNode ? style.fontWeight : style.fontStyle),\n        (fabric.isLikelyNode ? style.fontStyle : style.fontWeight),\n        forMeasuring ? this.CACHE_FONT_SIZE + 'px' : style.fontSize + 'px',\n        fontFamily\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n      }\n      this.callSuper('render', ctx);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @param {String} text text to split\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function(text) {\n      var lines = text.split(this._reNewline),\n          newLines = new Array(lines.length),\n          newLine = ['\\n'],\n          newText = [];\n      for (var i = 0; i < lines.length; i++) {\n        newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\n        newText = newText.concat(newLines[i], newLine);\n      }\n      newText.pop();\n      return { _unwrappedLines: newLines, lines: lines, graphemeText: newText, graphemeLines: newLines };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var additionalProperties = [\n        'text',\n        'fontSize',\n        'fontWeight',\n        'fontFamily',\n        'fontStyle',\n        'lineHeight',\n        'underline',\n        'overline',\n        'linethrough',\n        'textAlign',\n        'textBackgroundColor',\n        'charSpacing',\n      ].concat(propertiesToInclude);\n      var obj = this.callSuper('toObject', additionalProperties);\n      obj.styles = clone(this.styles, true);\n      return obj;\n    },\n\n    /**\n     * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n     * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n     * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    set: function(key, value) {\n      this.callSuper('set', key, value);\n      var needsDims = false;\n      if (typeof key === 'object') {\n        for (var _key in key) {\n          needsDims = needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\n        }\n      }\n      else {\n        needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\n      }\n      if (needsDims) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Text.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES),\n        parsedAnchor = parsedAttributes.textAnchor || 'left';\n    options = fabric.util.object.extend((options ? clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if (parsedAttributes.textDecoration) {\n      var textDecoration = parsedAttributes.textDecoration;\n      if (textDecoration.indexOf('underline') !== -1) {\n        options.underline = true;\n      }\n      if (textDecoration.indexOf('overline') !== -1) {\n        options.overline = true;\n      }\n      if (textDecoration.indexOf('line-through') !== -1) {\n        options.linethrough = true;\n      }\n      delete options.textDecoration;\n    }\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n    var originalStrokeWidth = options.strokeWidth;\n    options.strokeWidth = 0;\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getScaledHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getScaledHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        fabric output by default at top, left.\n    */\n    if (parsedAnchor === 'center') {\n      offX = text.getScaledWidth() / 2;\n    }\n    if (parsedAnchor === 'right') {\n      offX = text.getScaledWidth();\n    }\n    text.set({\n      left: text.left - offX,\n      top: text.top - (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) / text.lineHeight,\n      strokeWidth: typeof originalStrokeWidth !== 'undefined' ? originalStrokeWidth : 1,\n    });\n    callback(text);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */\n  fabric.Text.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Text', object, callback, 'text');\n  };\n\n  fabric.Text.genericFonts = ['sans-serif', 'serif', 'cursive', 'fantasy', 'monospace'];\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return true;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Returns true if object has a style property or has it ina specified line\n     * This function is used to detect if a text will use a particular property or not.\n     * @param {String} property to check for\n     * @param {Number} lineIndex to check the style on\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return false;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { 0: this.styles[lineIndex] };\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          if (typeof obj[p1][p2][property] !== 'undefined') {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if characters in a text have a value for a property\n     * whose value matches the textbox's value for that property.  If so,\n     * the character-level property is deleted.  If the character\n     * has no other properties, then it is also deleted.  Finally,\n     * if the line containing that character has no other characters\n     * then it also is deleted.\n     *\n     * @param {string} property The property to compare between characters and text.\n     */\n    cleanStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      var obj = this.styles, stylesCount = 0, letterCount, stylePropertyValue,\n          allStyleObjectPropertiesMatch = true, graphemeCount = 0, styleObject;\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        letterCount = 0;\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          var styleObject = obj[p1][p2],\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\n\n          stylesCount++;\n\n          if (stylePropertyHasBeenSet) {\n            if (!stylePropertyValue) {\n              stylePropertyValue = styleObject[property];\n            }\n            else if (styleObject[property] !== stylePropertyValue) {\n              allStyleObjectPropertiesMatch = false;\n            }\n\n            if (styleObject[property] === this[property]) {\n              delete styleObject[property];\n            }\n          }\n          else {\n            allStyleObjectPropertiesMatch = false;\n          }\n\n          if (Object.keys(styleObject).length !== 0) {\n            letterCount++;\n          }\n          else {\n            delete obj[p1][p2];\n          }\n        }\n\n        if (letterCount === 0) {\n          delete obj[p1];\n        }\n      }\n      // if every grapheme has the same style set then\n      // delete those styles and set it on the parent\n      for (var i = 0; i < this._textLines.length; i++) {\n        graphemeCount += this._textLines[i].length;\n      }\n      if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\n        this[property] = stylePropertyValue;\n        this.removeStyle(property);\n      }\n    },\n\n    /**\n     * Remove a style property or properties from all individual character styles\n     * in a text object.  Deletes the character style object if it contains no other style\n     * props.  Deletes a line style object if it contains no other character styles.\n     *\n     * @param {String} props The property to remove from character styles.\n     */\n    removeStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return;\n      }\n      var obj = this.styles, line, lineNum, charNum;\n      for (lineNum in obj) {\n        line = obj[lineNum];\n        for (charNum in line) {\n          delete line[charNum][property];\n          if (Object.keys(line[charNum]).length === 0) {\n            delete line[charNum];\n          }\n        }\n        if (Object.keys(line).length === 0) {\n          delete obj[lineNum];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex);\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\n     */\n    get2DCursorLocation: function(selectionStart, skipWrapping) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var lines = skipWrapping ? this._unwrappedTextLines : this._textLines,\n          len = lines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= lines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= lines[i].length + this.missingNewlineOffset(i);\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: lines[i - 1].length < selectionStart ? lines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * if startIndex or endIndex are not provided, slectionStart or selectionEnd will be used.\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @param {Boolean} [complete] get full style or not\n     * @return {Array} styles an array with one, zero or more Style objects\n     */\n    getSelectionStyles: function(startIndex, endIndex, complete) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      var styles = [];\n      for (var i = startIndex; i < endIndex; i++) {\n        styles.push(this.getStyleAtPosition(i, complete));\n      }\n      return styles;\n    },\n\n    /**\n     * Gets style of a current selection/cursor position\n     * @param {Number} position  to get styles at\n     * @param {Boolean} [complete] full style if true\n     * @return {Object} style Style object at a specified index\n     * @private\n     */\n    getStyleAtPosition: function(position, complete) {\n      var loc = this.get2DCursorLocation(position),\n          style = complete ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex) :\n            this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection, if no selection exist, do not set anything.\n     * @param {Object} [styles] Styles object\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles, startIndex, endIndex) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      for (var i = startIndex; i < endIndex; i++) {\n        this._extendStyles(i, styles);\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * get the reference, not a clone, of the style object for a given character\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Object} style object\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      var lineStyle = this.styles && this.styles[lineIndex];\n      if (!lineStyle) {\n        return null;\n      }\n      return lineStyle[charIndex];\n    },\n\n    /**\n     * return a new object that contains all the style property for a character\n     * the object returned is newly created\n     * @param {Number} lineIndex of the line where the character is\n     * @param {Number} charIndex position of the character on the line\n     * @return {Object} style object\n     */\n    getCompleteStyleDeclaration: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex) || { },\n          styleObject = { }, prop;\n      for (var i = 0; i < this._styleProperties.length; i++) {\n        prop = this._styleProperties[i];\n        styleObject[prop] = typeof style[prop] === 'undefined' ? this[prop] : style[prop];\n      }\n      return styleObject;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @return {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return !!this.styles[lineIndex];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      this.styles[lineIndex] = {};\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    }\n  });\n})();\n\n\n(function() {\n\n  function parseDecoration(object) {\n    if (object.textDecoration) {\n      object.textDecoration.indexOf('underline') > -1 && (object.underline = true);\n      object.textDecoration.indexOf('line-through') > -1 && (object.linethrough = true);\n      object.textDecoration.indexOf('overline') > -1 && (object.overline = true);\n      delete object.textDecoration;\n    }\n  }\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of text cursor color in editing mode.\n     * if not set (default) will take color from the text.\n     * if set to a color value that fabric can understand, it will\n     * be used instead of the color of the text at the current position.\n     * @type String\n     * @default\n     */\n    cursorColor: '',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Helps determining when the text is in composition, so that the cursor\n     * rendering is altered.\n     */\n    inCompositionMode: false,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @private\n     */\n    initDimensions: function() {\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this.callSuper('initDimensions');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      this.clearContextTop();\n      this.callSuper('render', ctx);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function(skipRestore) {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var ctx = this.canvas.contextTop, v = this.canvas.viewportTransform;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this.transform(ctx);\n      this._clearTextArea(ctx);\n      skipRestore || ctx.restore();\n    },\n    /**\n     * Renders cursor or selection (depending on what exists)\n     * it does on the contextTop. If contextTop is not available, do nothing.\n     */\n    renderCursorOrSelection: function() {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var boundaries = this._getCursorBoundaries(),\n          ctx = this.canvas.contextTop;\n      this.clearContextTop(true);\n      if (this.selectionStart === this.selectionEnd) {\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(position) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      if (typeof position === 'undefined') {\n        position = this.selectionStart;\n      }\n\n      var left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._getCursorBoundariesOffsets(position);\n\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(position) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset,\n          lineIndex,\n          charIndex,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries,\n          cursorPosition = this.get2DCursorLocation(position);\n      charIndex = cursorPosition.charIndex;\n      lineIndex = cursorPosition.lineIndex;\n      for (var i = 0; i < lineIndex; i++) {\n        topOffset += this.getHeightOfLine(i);\n      }\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\n      var bound = this.__charBounds[lineIndex][charIndex];\n      bound && (leftOffset = bound.left);\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\n      };\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize'),\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier,\n          topOffset = boundaries.topOffset,\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, 'deltaY');\n\n      topOffset += (1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex) / this.lineHeight\n        - charHeight * (1 - this._fontSizeFraction);\n\n      if (this.inCompositionMode) {\n        this.renderSelection(boundaries, ctx);\n      }\n\n      ctx.fillStyle = this.cursorColor || this.getValueOfPropertyAt(lineIndex, charIndex, 'fill');\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n      ctx.fillRect(\n        boundaries.left + boundaries.leftOffset - cursorWidth / 2,\n        topOffset + boundaries.top + dy,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(boundaries, ctx) {\n\n      var selectionStart = this.inCompositionMode ? this.hiddenTextarea.selectionStart : this.selectionStart,\n          selectionEnd = this.inCompositionMode ? this.hiddenTextarea.selectionEnd : this.selectionEnd,\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          start = this.get2DCursorLocation(selectionStart),\n          end = this.get2DCursorLocation(selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex,\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\n\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(i) || 0,\n            lineHeight = this.getHeightOfLine(i),\n            realLineHeight = 0, boxStart = 0, boxEnd = 0;\n\n        if (i === startLine) {\n          boxStart = this.__charBounds[startLine][startChar].left;\n        }\n        if (i >= startLine && i < endLine) {\n          boxEnd = isJustify && !this.isEndOfWrapping(i) ? this.width : this.getLineWidth(i) || 5; // WTF is this 5?\n        }\n        else if (i === endLine) {\n          if (endChar === 0) {\n            boxEnd = this.__charBounds[endLine][endChar].left;\n          }\n          else {\n            var charSpacing = this._getWidthOfCharSpacing();\n            boxEnd = this.__charBounds[endLine][endChar - 1].left\n              + this.__charBounds[endLine][endChar - 1].width - charSpacing;\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        if (this.inCompositionMode) {\n          ctx.fillStyle = this.compositionColor || 'black';\n          ctx.fillRect(\n            boundaries.left + lineOffset + boxStart,\n            boundaries.top + boundaries.topOffset + lineHeight,\n            boxEnd - boxStart,\n            1);\n        }\n        else {\n          ctx.fillStyle = this.selectionColor;\n          ctx.fillRect(\n            boundaries.left + lineOffset + boxStart,\n            boundaries.top + boundaries.topOffset,\n            boxEnd - boxStart,\n            lineHeight);\n        }\n\n\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * High level function to know the height of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns fontSize of char at the current cursor\n     * Unused from the library, is for the end user\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fontSize');\n    },\n\n    /**\n     * High level function to know the color of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns color (fill) of char at the current cursor\n     * Unused from the library, is for the end user\n     * @return {String} Character color (fill)\n     */\n    getCurrentCharColor: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fill');\n    },\n\n    /**\n     * Returns the cursor position for the getCurrent.. functions\n     * @private\n     */\n    _getCurrentCharIndex: function() {\n      var cursorPosition = this.get2DCursorLocation(this.selectionStart, true),\n          charIndex = cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\n      return { l: cursorPosition.lineIndex, c: charIndex };\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */\n  fabric.IText.fromObject = function(object, callback) {\n    parseDecoration(object);\n    if (object.styles) {\n      for (var i in object.styles) {\n        for (var j in object.styles[i]) {\n          parseDecoration(object.styles[i][j]);\n        }\n      }\n    }\n    fabric.Object._fromObject('IText', object, callback, 'text');\n  };\n})();\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      };\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState,\n          canvas = this.canvas;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear && canvas) {\n        canvas.clearContext(canvas.contextTop || canvas.contextContainer);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this._text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this._text.slice(this.selectionStart, this.selectionEnd).join('');\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var text = this._text,\n          index     = this._reSpace.test(text[selectionStart]) ? selectionStart - 1 : selectionStart,\n          _char     = text[index],\n          // wrong\n          reNonWord = fabric.reNonWord;\n\n      while (!reNonWord.test(_char) && index > 0 && index < text.length) {\n        index += direction;\n        _char = text[index];\n      }\n      if (reNonWord.test(_char)) {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.canvas.calcOffset();\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this.hiddenTextarea.value = this.text;\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.requestRenderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * convert from textarea to grapheme indexes\n     */\n    fromStringToGraphemeSelection: function(start, end, text) {\n      var smallerTextStart = text.slice(0, start),\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart).length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = text.slice(start, end),\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * convert from fabric to textarea values\n     */\n    fromGraphemeToStringSelection: function(start, end, _text) {\n      var smallerTextStart = _text.slice(0, start),\n          graphemeStart = smallerTextStart.join('').length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = _text.slice(start, end),\n          graphemeEnd = smallerTextEnd.join('').length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      this.cursorOffsetCache = { };\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      if (!this.inCompositionMode) {\n        var newSelection = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text);\n        this.hiddenTextarea.selectionStart = newSelection.selectionStart;\n        this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateFromTextArea: function() {\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.text = this.hiddenTextarea.value;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      var newSelection = this.fromStringToGraphemeSelection(\n        this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value);\n      this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\n      if (!this.inCompositionMode) {\n        this.selectionStart = newSelection.selectionStart;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateTextareaPosition: function() {\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var desiredPosition = this.inCompositionMode ? this.compositionStart : this.selectionStart,\n          boundaries = this._getCursorBoundaries(desiredPosition),\n          cursorLocation = this.get2DCursorLocation(desiredPosition),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize') * this.lineHeight,\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          retinaScaling = this.canvas.getRetinaScaling(),\n          upperCanvas = this.canvas.upperCanvasEl,\n          upperCanvasWidth = upperCanvas.width / retinaScaling,\n          upperCanvasHeight = upperCanvas.height / retinaScaling,\n          maxWidth = upperCanvasWidth - charHeight,\n          maxHeight = upperCanvasHeight - charHeight,\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n      p.x *= scaleX;\n      p.y *= scaleY;\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight + 'px', charHeight: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        selectable: this.selectable,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.hoverCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.selectable = this._savedProps.selectable;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      var hiddenTextarea = this.hiddenTextarea;\n      this.selected = false;\n      this.isEditing = false;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (hiddenTextarea) {\n        hiddenTextarea.blur && hiddenTextarea.blur();\n        hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n      }\n      this.hiddenTextarea = null;\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * remove and reflow a style block from start to end.\n     * @param {Number} start linear start position for removal (included in removal)\n     * @param {Number} end linear end position for removal ( excluded from removal )\n     */\n    removeStyleFromTo: function(start, end) {\n      var cursorStart = this.get2DCursorLocation(start, true),\n          cursorEnd = this.get2DCursorLocation(end, true),\n          lineStart = cursorStart.lineIndex,\n          charStart = cursorStart.charIndex,\n          lineEnd = cursorEnd.lineIndex,\n          charEnd = cursorEnd.charIndex,\n          i, styleObj;\n      if (lineStart !== lineEnd) {\n        // step1 remove the trailing of lineStart\n        if (this.styles[lineStart]) {\n          for (i = charStart; i < this._unwrappedTextLines[lineStart].length; i++) {\n            delete this.styles[lineStart][i];\n          }\n        }\n        // step2 move the trailing of lineEnd to lineStart if needed\n        if (this.styles[lineEnd]) {\n          for (i = charEnd; i < this._unwrappedTextLines[lineEnd].length; i++) {\n            styleObj = this.styles[lineEnd][i];\n            if (styleObj) {\n              this.styles[lineStart] || (this.styles[lineStart] = { });\n              this.styles[lineStart][charStart + i - charEnd] = styleObj;\n            }\n          }\n        }\n        // step3 detects lines will be completely removed.\n        for (i = lineStart + 1; i <= lineEnd; i++) {\n          delete this.styles[i];\n        }\n        // step4 shift remaining lines.\n        this.shiftLineStyles(lineEnd, lineStart - lineEnd);\n      }\n      else {\n        // remove and shift left on the same line\n        if (this.styles[lineStart]) {\n          styleObj = this.styles[lineStart];\n          var diff = charEnd - charStart, numericChar, _char;\n          for (i = charStart; i < charEnd; i++) {\n            delete styleObj[i];\n          }\n          for (_char in this.styles[lineStart]) {\n            numericChar = parseInt(_char, 10);\n            if (numericChar >= charEnd) {\n              styleObj[numericChar - diff] = styleObj[_char];\n              delete styleObj[_char];\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can any number?\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by offset upward or downward\n      // do not clone deep. we need new array, not new style objects\n      var clonedStyles = clone(this.styles);\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Handle insertion of more consecutive style lines for when one or more\n     * newlines gets added to the text. Since current style needs to be shifted\n     * first we shift the current style of the number lines needed, then we add\n     * new lines from the last to the first.\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} qty number of lines to add\n     * @param {Array} copiedStyle Array of objects styles\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, qty, copiedStyle) {\n      var currentCharStyle,\n          newLineStyles = {},\n          somethingAdded = false,\n          isEndOfLine = this._unwrappedTextLines[lineIndex].length === charIndex;\n\n      qty || (qty = 1);\n      this.shiftLineStyles(lineIndex, qty);\n      if (this.styles[lineIndex]) {\n        currentCharStyle = this.styles[lineIndex][charIndex === 0 ? charIndex : charIndex - 1];\n      }\n      // we clone styles of all chars\n      // after cursor onto the current line\n      for (var index in this.styles[lineIndex]) {\n        var numIndex = parseInt(index, 10);\n        if (numIndex >= charIndex) {\n          somethingAdded = true;\n          newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n          // remove lines from the previous line since they're on a new line now\n          if (!(isEndOfLine && charIndex === 0)) {\n            delete this.styles[lineIndex][index];\n          }\n        }\n      }\n      var styleCarriedOver = false;\n      if (somethingAdded && !isEndOfLine) {\n        // if is end of line, the extra style we copied\n        // is probably not something we want\n        this.styles[lineIndex + qty] = newLineStyles;\n        styleCarriedOver = true;\n      }\n      if (styleCarriedOver) {\n        // skip the last line of since we already prepared it.\n        qty--;\n      }\n      // for the all the lines or all the other lines\n      // we clone current char style onto the next (otherwise empty) line\n      while (qty > 0) {\n        if (copiedStyle && copiedStyle[qty - 1]) {\n          this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty - 1]) };\n        }\n        else if (currentCharStyle) {\n          this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\n        }\n        else {\n          delete this.styles[lineIndex + qty];\n        }\n        qty--;\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} quantity number Style object to insert, if given\n     * @param {Array} copiedStyle array of style objects\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, quantity, copiedStyle) {\n      if (!this.styles) {\n        this.styles = {};\n      }\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = currentLineStyles ? clone(currentLineStyles) : {};\n\n      quantity || (quantity = 1);\n      // shift all char styles by quantity forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + quantity] = currentLineStylesCloned[numericIndex];\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - quantity]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      this._forceClearCache = true;\n      if (copiedStyle) {\n        while (quantity--) {\n          if (!Object.keys(copiedStyle[quantity]).length) {\n            continue;\n          }\n          if (!this.styles[lineIndex]) {\n            this.styles[lineIndex] = {};\n          }\n          this.styles[lineIndex][charIndex + quantity] = clone(copiedStyle[quantity]);\n        }\n        return;\n      }\n      if (!currentLineStyles) {\n        return;\n      }\n      var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\n      while (newStyle && quantity--) {\n        this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\n      }\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {Array} insertedText Characters at the location where style is inserted\n     * @param {Number} start cursor index for inserting style\n     * @param {Array} [copiedStyle] array of style objects to insert.\n     */\n    insertNewStyleBlock: function(insertedText, start, copiedStyle) {\n      var cursorLoc = this.get2DCursorLocation(start, true),\n          addedLines = [0], linesLength = 0;\n      // get an array of how many char per lines are being added.\n      for (var i = 0; i < insertedText.length; i++) {\n        if (insertedText[i] === '\\n') {\n          linesLength++;\n          addedLines[linesLength] = 0;\n        }\n        else {\n          addedLines[linesLength]++;\n        }\n      }\n      // for the first line copy the style from the current char position.\n      if (addedLines[0] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex, cursorLoc.charIndex, addedLines[0], copiedStyle);\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\n      }\n      linesLength && this.insertNewlineStyleObject(\n        cursorLoc.lineIndex, cursorLoc.charIndex + addedLines[0], linesLength);\n      for (var i = 1; i < linesLength; i++) {\n        if (addedLines[i] > 0) {\n          this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n        }\n        else if (copiedStyle) {\n          this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\n        }\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\n      }\n      // we use i outside the loop to get it like linesLength\n      if (addedLines[i] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n      }\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the new position of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown);\n  },\n\n  /**\n   * Default event handler to simulate triple click\n   * @private\n   */\n  onMouseDown: function(options) {\n    if (!this.canvas) {\n      return;\n    }\n    this.__newClickTime = +new Date();\n    var newPointer = options.pointer;\n    if (this.isTripleClick(newPointer)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Default handler for double click, select a word\n   */\n  doubleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectWord(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Default handler for triple click, select a line\n   */\n  tripleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectLine(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('mousedblclick', this.doubleClickHandler);\n    this.on('tripleclick', this.tripleClickHandler);\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on _mouseDown\n   * can be overridden to do something different.\n   * Scope of this implementation is: find the click position, set selectionStart\n   * find selectionEnd, initialize the drawing of either cursor or selection area\n   * initializing a mousedDown on a text area will cancel fabricjs knowledge of\n   * current compositionMode. It will be set to false.\n   */\n  _mouseDownHandler: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    this.__isMousedown = true;\n\n    if (this.selected) {\n      this.inCompositionMode = false;\n      this.setCursorByClick(options.e);\n    }\n\n    if (this.isEditing) {\n      this.__selectionStartOnMouseDown = this.selectionStart;\n      if (this.selectionStart === this.selectionEnd) {\n        this.abortCursorAnimation();\n      }\n      this.renderCursorOrSelection();\n    }\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on mousedown:before\n   * can be overridden to do something different.\n   * Scope of this implementation is: verify the object is already selected when mousing down\n   */\n  _mouseDownHandlerBefore: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n    // we want to avoid that an object that was selected and then becomes unselectable,\n    // may trigger editing mode in some way.\n    this.selected = this === this.canvas._activeObject;\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', this._mouseDownHandler);\n    this.on('mousedown:before', this._mouseDownHandlerBefore);\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', this.mouseUpHandler);\n  },\n\n  /**\n   * standard hander for mouse up, overridable\n   * @private\n   */\n  mouseUpHandler: function(options) {\n    this.__isMousedown = false;\n    if (!this.editable || this.group ||\n      (options.transform && options.transform.actionPerformed) ||\n      (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    if (this.canvas) {\n      var currentActive = this.canvas._activeObject;\n      if (currentActive && currentActive !== this) {\n        // avoid running this logic when there is an active object\n        // this because is possible with shift click and fast clicks,\n        // to rapidly deselect and reselect this object and trigger an enterEdit\n        return;\n      }\n    }\n\n    if (this.__lastSelected && !this.__corner) {\n      this.selected = false;\n      this.__lastSelected = false;\n      this.enterEditing(options.e);\n      if (this.selectionStart === this.selectionEnd) {\n        this.initDelayedCursor(true);\n      }\n      else {\n        this.renderCursorOrSelection();\n      }\n    }\n    else {\n      this.selected = true;\n    }\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        lineIndex = 0,\n        lineLeftOffset,\n        line;\n\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      if (height <= mouseOffset.y) {\n        height += this.getHeightOfLine(i) * this.scaleY;\n        lineIndex = i;\n        if (i > 0) {\n          charIndex += this._textLines[i - 1].length + this.missingNewlineOffset(i - 1);\n        }\n      }\n      else {\n        break;\n      }\n    }\n    lineLeftOffset = this._getLineLeftOffset(lineIndex);\n    width = lineLeftOffset * this.scaleX;\n    line = this._textLines[lineIndex];\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      prevWidth = width;\n      // i removed something about flipX here, check.\n      width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\n      if (width <= mouseOffset.x) {\n        charIndex++;\n      }\n      else {\n        break;\n      }\n    }\n    return this._getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, charIndex, jlen);\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n    // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\n          distanceBtwNextCharAndCursor < 0 ? 0 : 1,\n        newSelectionStart = index + offset;\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this._text.length) {\n      newSelectionStart = this._text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\n    this.hiddenTextarea.setAttribute('wrap', 'off');\n    var style = this._calcTextareaPosition();\n    // line-height: 1px; was removed from the style to fix this:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\n    ' paddingtop: ' + style.fontSize + ';';\n    fabric.document.body.appendChild(this.hiddenTextarea);\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keydown event\n   * only used for arrows and combination of modifier keys.\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing) {\n      return;\n    }\n    if (e.keyCode in this.keysMap) {\n      this[this.keysMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.inCompositionMode = false;\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.requestRenderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone || this.inCompositionMode) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.requestRenderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    var fromPaste = this.fromPaste;\n    this.fromPaste = false;\n    e && e.stopPropagation();\n    if (!this.isEditing) {\n      return;\n    }\n    // decisions about style changes.\n    var nextText = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,\n        charCount = this._text.length,\n        nextCharCount = nextText.length,\n        removedText, insertedText,\n        charDiff = nextCharCount - charCount,\n        selectionStart = this.selectionStart, selectionEnd = this.selectionEnd,\n        selection = selectionStart !== selectionEnd,\n        copiedStyle, removeFrom, removeTo;\n    if (this.hiddenTextarea.value === '') {\n      this.styles = { };\n      this.updateFromTextArea();\n      this.fire('changed');\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.requestRenderAll();\n      }\n      return;\n    }\n\n    var textareaSelection = this.fromStringToGraphemeSelection(\n      this.hiddenTextarea.selectionStart,\n      this.hiddenTextarea.selectionEnd,\n      this.hiddenTextarea.value\n    );\n    var backDelete = selectionStart > textareaSelection.selectionStart;\n\n    if (selection) {\n      removedText = this._text.slice(selectionStart, selectionEnd);\n      charDiff += selectionEnd - selectionStart;\n    }\n    else if (nextCharCount < charCount) {\n      if (backDelete) {\n        removedText = this._text.slice(selectionEnd + charDiff, selectionEnd);\n      }\n      else {\n        removedText = this._text.slice(selectionStart, selectionStart - charDiff);\n      }\n    }\n    insertedText = nextText.slice(textareaSelection.selectionEnd - charDiff, textareaSelection.selectionEnd);\n    if (removedText && removedText.length) {\n      if (insertedText.length) {\n        // let's copy some style before deleting.\n        // we want to copy the style before the cursor OR the style at the cursor if selection\n        // is bigger than 0.\n        copiedStyle = this.getSelectionStyles(selectionStart, selectionStart + 1, false);\n        // now duplicate the style one for each inserted text.\n        copiedStyle = insertedText.map(function() {\n          // this return an array of references, but that is fine since we are\n          // copying the style later.\n          return copiedStyle[0];\n        });\n      }\n      if (selection) {\n        removeFrom = selectionStart;\n        removeTo = selectionEnd;\n      }\n      else if (backDelete) {\n        // detect differencies between forwardDelete and backDelete\n        removeFrom = selectionEnd - removedText.length;\n        removeTo = selectionEnd;\n      }\n      else {\n        removeFrom = selectionEnd;\n        removeTo = selectionEnd + removedText.length;\n      }\n      this.removeStyleFromTo(removeFrom, removeTo);\n    }\n    if (insertedText.length) {\n      if (fromPaste && insertedText.join('') === fabric.copiedText && !fabric.disableStyleCopyPaste) {\n        copiedStyle = fabric.copiedTextStyle;\n      }\n      this.insertNewStyleBlock(insertedText, selectionStart, copiedStyle);\n    }\n    this.updateFromTextArea();\n    this.fire('changed');\n    if (this.canvas) {\n      this.canvas.fire('text:changed', { target: this });\n      this.canvas.requestRenderAll();\n    }\n  },\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  // /**\n  //  * Composition update\n  //  */\n  onCompositionUpdate: function(e) {\n    this.compositionStart = e.target.selectionStart;\n    this.compositionEnd = e.target.selectionEnd;\n    this.updateTextareaPosition();\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function() {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n\n    fabric.copiedText = this.getSelectedText();\n    if (!fabric.disableStyleCopyPaste) {\n      fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, true);\n    }\n    else {\n      fabric.copiedTextStyle = null;\n    }\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function() {\n    this.fromPaste = true;\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var widthBeforeCursor = this._getLineLeftOffset(lineIndex), bound;\n\n    if (charIndex > 0) {\n      bound = this.__charBounds[lineIndex][charIndex - 1];\n      widthBeforeCursor += bound.left + bound.width;\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this._text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n    return textAfterCursor.length + indexOnOtherLine + 1 + this.missingNewlineOffset(lineIndex);\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        missingNewlineOffset = this.missingNewlineOffset(lineIndex - 1);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length\n     + indexOnOtherLine - textBeforeCursor.length + (1 - missingNewlineOffset);\n  },\n\n  /**\n   * for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var line = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0, charWidth, foundMatch;\n\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      charWidth = this.__charBounds[lineIndex][j].width;\n      widthOfCharsOnLine += charWidth;\n      if (widthOfCharsOnLine > width) {\n        foundMatch = true;\n        var leftEdge = widthOfCharsOnLine - charWidth,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = line.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n      ? this.selectionStart + offset\n      : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== undefined && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this._text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters from start/end\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  removeChars: function(start, end) {\n    if (typeof end === 'undefined') {\n      end = start + 1;\n    }\n    this.removeStyleFromTo(start, end);\n    this._text.splice(start, end - start);\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n  /**\n   * insert characters at start position, before start position.\n   * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n   * if style array is provided, it must be as the same length of text in graphemes\n   * if end is provided and is bigger than start, old text is replaced.\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {String} text text to insert\n   * @param {Array} style array of style objects\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  insertChars: function(text, style, start, end) {\n    if (typeof end === 'undefined') {\n      end = start;\n    }\n    if (end > start) {\n      this.removeStyleFromTo(start, end);\n    }\n    var graphemes = fabric.util.string.graphemeSplit(text);\n    this.insertNewStyleBlock(graphemes, start, style);\n    this._text = [].concat(this._text.slice(0, start), graphemes, this._text.slice(end));\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      multipleSpacesRegex = /  +/g;\n\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function() {\n      var offsets = this._getSVGLeftTopOffsets(),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n      return this._wrapSVGTextAndBg(textAndBg);\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(\n        this._toSVG(),\n        { reviver: reviver, noStyle: true, withShadow: true }\n      );\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function() {\n      return {\n        textLeft: -this.width / 2,\n        textTop: -this.height / 2,\n        lineTop: this.getHeightOfLine(0)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(textAndBg) {\n      var noShadow = true,\n          textDecoration = this.getSvgTextDecoration(this);\n      return [\n        textAndBg.textBgRects.join(''),\n        '\\t\\t<text xml:space=\"preserve\" ',\n        (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n        (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n        (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n        (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n        (textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : ''),\n        'style=\"', this.getSvgStyles(noShadow), '\"', this.addPaintOrder(), ' >',\n        textAndBg.textSpans.join(''),\n        '</text>\\n'\n      ];\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = textTopOffset, lineOffset;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineOffset = this._getLineLeftOffset(i);\n        if (this.textBackgroundColor || this.styleHas('textBackgroundColor', i)) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset + lineOffset, height);\n        }\n        this._setSVGTextLineText(textSpans, i, textLeftOffset + lineOffset, height);\n        height += this.getHeightOfLine(i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, left, top) {\n      var shouldUseWhitespace = _char !== _char.trim() || _char.match(multipleSpacesRegex),\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : '',\n          dy = styleDecl.deltaY, dySpan = '',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      if (dy) {\n        dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\n      }\n      return [\n        '<tspan x=\"', toFixed(left, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS), '\" ', dySpan,\n        fillStyles, '>',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>'\n      ].join('');\n    },\n\n    _setSVGTextLineText: function(textSpans, lineIndex, textLeftOffset, textTopOffset) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox, style,\n          boxWidth = 0,\n          line = this._textLines[lineIndex],\n          timeToRender;\n\n      textTopOffset += lineHeight * (1 - this._fontSizeFraction) / this.lineHeight;\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          textLeftOffset += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = this._hasStyleChangedForSvg(actualStyle, nextStyle);\n        }\n        if (timeToRender) {\n          style = this._getStyleDeclaration(lineIndex, i) || { };\n          textSpans.push(this._createTextCharSpan(charsToRender, style, textLeftOffset, textTopOffset));\n          charsToRender = '';\n          actualStyle = nextStyle;\n          textLeftOffset += boxWidth;\n          boxWidth = 0;\n        }\n      }\n    },\n\n    _pushTextBgRect: function(textBgRects, color, left, top, width, height) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      textBgRects.push(\n        '\\t\\t<rect ',\n        this._getFillAttributes(color),\n        ' x=\"',\n        toFixed(left, NUM_FRACTION_DIGITS),\n        '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS),\n        '\" width=\"',\n        toFixed(width, NUM_FRACTION_DIGITS),\n        '\" height=\"',\n        toFixed(height, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, leftOffset, textTopOffset) {\n      var line = this._textLines[i],\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\n          boxWidth = 0,\n          boxStart = 0,\n          charBox, currentColor,\n          lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        charBox = this.__charBounds[i][j];\n        currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n        if (currentColor !== lastColor) {\n          lastColor && this._pushTextBgRect(textBgRects, lastColor, leftOffset + boxStart,\n            textTopOffset, boxWidth, heightOfLine);\n          boxStart = charBox.left;\n          boxWidth = charBox.width;\n          lastColor = currentColor;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n      }\n      currentColor && this._pushTextBgRect(textBgRects, currentColor, leftOffset + boxStart,\n        textTopOffset, boxWidth, heightOfLine);\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this.getHeightOfLine(j);\n      }\n      lastHeight = this.getHeightOfLine(j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\n      return svgStyle + ' white-space: pre;';\n    },\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat('width'),\n\n    /**\n     * Use this regular expression to split strings in breakable lines\n     * @private\n     */\n    _wordJoiners: /[ \\t\\r]/,\n\n    /**\n     * Use this boolean property in order to split strings that have no white space concept.\n     * this is a cheap way to help with chinese/japaense\n     * @type Boolean\n     * @since 2.6.0\n     */\n    splitByGrapheme: false,\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this._clearCache();\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n      // wrap lines\n      this._styleMap = this._generateStyleMap(this._splitText());\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      // clear cache and re-calculate height\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function(textInfo) {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\n        if (textInfo.graphemeText[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (!this.splitByGrapheme && this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += textInfo.graphemeLines[i].length;\n        realLineCharCount += textInfo.graphemeLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * Returns true if object has a style property or has it on a specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (map) {\n          lineIndex = map.line;\n        }\n      }\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\n    },\n\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      var offset = 0, nextLineIndex = lineIndex + 1, nextOffset, obj, shouldLimit = false,\n          map = this._styleMap[lineIndex], mapNextLine = this._styleMap[lineIndex + 1];\n      if (map) {\n        lineIndex = map.line;\n        offset = map.offset;\n      }\n      if (mapNextLine) {\n        nextLineIndex = mapNextLine.line;\n        shouldLimit = nextLineIndex === lineIndex;\n        nextOffset = mapNextLine.offset;\n      }\n      obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * probably broken need a fix\n     * Returns the real style line that correspond to the wrapped lineIndex line\n     * Used just to verify if the line does exist or not.\n     * @param {Number} lineIndex\n     * @returns {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return !!this.styles[map.line];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = {};\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(lines, desiredWidth) {\n      var wrapped = [], i;\n      this.isWrapping = true;\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, desiredWidth));\n      }\n      this.isWrapping = false;\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureWord: function(word, lineIndex, charOffset) {\n      var width = 0, prevGrapheme, skipLeft = true;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = word.length; i < len; i++) {\n        var box = this._getGraphemeBox(word[i], lineIndex, i + charOffset, prevGrapheme, skipLeft);\n        width += box.kernedWidth;\n        prevGrapheme = word[i];\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(_line, lineIndex, desiredWidth, reservedSpace) {\n      var lineWidth = 0,\n          splitByGrapheme = this.splitByGrapheme,\n          graphemeLines = [],\n          line = [],\n          // spaces in different languges?\n          words = splitByGrapheme ? fabric.util.string.graphemeSplit(_line) : _line.split(this._wordJoiners),\n          word = '',\n          offset = 0,\n          infix = splitByGrapheme ? '' : ' ',\n          wordWidth = 0,\n          infixWidth = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing(),\n          reservedSpace = reservedSpace || 0;\n      // fix a difference between split and graphemeSplit\n      if (words.length === 0) {\n        words.push([]);\n      }\n      desiredWidth -= reservedSpace;\n      for (var i = 0; i < words.length; i++) {\n        // if using splitByGrapheme words are already in graphemes.\n        word = splitByGrapheme ? words[i] : fabric.util.string.graphemeSplit(words[i]);\n        wordWidth = this._measureWord(word, lineIndex, offset);\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n        if (lineWidth >= desiredWidth && !lineJustStarted) {\n          graphemeLines.push(line);\n          line = [];\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted && !splitByGrapheme) {\n          line.push(infix);\n        }\n        line = line.concat(word);\n\n        infixWidth = splitByGrapheme ? 0 : this._measureWord([infix], lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && graphemeLines.push(line);\n\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace + reservedSpace;\n      }\n      return graphemeLines;\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      if (!this._styleMap[lineIndex + 1]) {\n        // is last line, return true;\n        return true;\n      }\n      if (this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line) {\n        // this is last line before a line break, return true;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * @return Number\n     */\n    missingNewlineOffset: function(lineIndex) {\n      if (this.splitByGrapheme) {\n        return this.isEndOfWrapping(lineIndex) ? 1 : 0;\n      }\n      return 1;\n    },\n\n    /**\n    * Gets lines of text to render in the Textbox. This function calculates\n    * text wrapping on the fly every time it is called.\n    * @param {String} text text to split\n    * @returns {Array} Array of lines in the Textbox.\n    * @override\n    */\n    _splitTextIntoLines: function(text) {\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\n          graphemeLines = this._wrapText(newText.lines, this.width),\n          lines = new Array(graphemeLines.length);\n      for (var i = 0; i < graphemeLines.length; i++) {\n        lines[i] = graphemeLines[i].join('');\n      }\n      newText.lines = lines;\n      newText.graphemeLines = graphemeLines;\n      return newText;\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    _removeExtraneousStyles: function() {\n      var linesToKeep = {};\n      for (var prop in this._styleMap) {\n        if (this._textLines[prop]) {\n          linesToKeep[this._styleMap[prop].line] = 1;\n        }\n      }\n      for (var prop in this.styles) {\n        if (!linesToKeep[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth', 'splitByGrapheme'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */\n  fabric.Textbox.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Textbox', object, callback, 'text');\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var controlsUtils = fabric.controlsUtils,\n      scaleSkewStyleHandler = controlsUtils.scaleSkewCursorStyleHandler,\n      scaleStyleHandler = controlsUtils.scaleCursorStyleHandler,\n      scalingEqually = controlsUtils.scalingEqually,\n      scalingYOrSkewingX = controlsUtils.scalingYOrSkewingX,\n      scalingXOrSkewingY = controlsUtils.scalingXOrSkewingY,\n      scaleOrSkewActionName = controlsUtils.scaleOrSkewActionName,\n      objectControls = fabric.Object.prototype.controls;\n\n  objectControls.ml = new fabric.Control({\n    x: -0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mr = new fabric.Control({\n    x: 0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mb = new fabric.Control({\n    x: 0,\n    y: 0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mt = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.tl = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.tr = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.bl = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.br = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.mtr = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    actionHandler: controlsUtils.rotationWithSnapping,\n    cursorStyleHandler: controlsUtils.rotationStyleHandler,\n    offsetY: -40,\n    withConnection: true,\n    actionName: 'rotate',\n  });\n\n  if (fabric.Textbox) {\n    // this is breaking the prototype inheritance, no time / ideas to fix it.\n    // is important to document that if you want to have all objects to have a\n    // specific custom control, you have to add it to Object prototype and to Textbox\n    // prototype. The controls are shared as references. So changes to control `tr`\n    // can still apply to all objects if needed.\n    var textBoxControls = fabric.Textbox.prototype.controls = { };\n\n    textBoxControls.mtr = objectControls.mtr;\n    textBoxControls.tr = objectControls.tr;\n    textBoxControls.br = objectControls.br;\n    textBoxControls.tl = objectControls.tl;\n    textBoxControls.bl = objectControls.bl;\n    textBoxControls.mt = objectControls.mt;\n    textBoxControls.mb = objectControls.mb;\n\n    textBoxControls.mr = new fabric.Control({\n      x: 0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n\n    textBoxControls.ml = new fabric.Control({\n      x: -0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n  }\n})();\n\n","// Styles\nimport './VCounter.sass'\n\n// Mixins\nimport Themeable, { functionalThemeClasses } from '../../mixins/themeable'\n\n// Types\nimport { VNode } from 'vue'\nimport mixins from '../../util/mixins'\n\n/* @vue/component */\nexport default mixins(Themeable).extend({\n  name: 'v-counter',\n\n  functional: true,\n\n  props: {\n    value: {\n      type: [Number, String],\n      default: '',\n    },\n    max: [Number, String],\n  },\n\n  render (h, ctx): VNode {\n    const { props } = ctx\n    const max = parseInt(props.max, 10)\n    const value = parseInt(props.value, 10)\n    const content = max ? `${value} / ${max}` : String(props.value)\n    const isGreater = max && (value > max)\n\n    return h('div', {\n      staticClass: 'v-counter',\n      class: {\n        'error--text': isGreater,\n        ...functionalThemeClasses(ctx),\n      },\n    }, content)\n  },\n})\n","import VCounter from './VCounter'\n\nexport { VCounter }\nexport default VCounter\n","// Directives\nimport Intersect from '../../directives/intersect'\n\n// Utilities\nimport { consoleWarn } from '../../util/console'\n\n// Types\nimport Vue from 'vue'\n\nexport default function intersectable (options: { onVisible: string[] }) {\n  if (typeof window === 'undefined' || !('IntersectionObserver' in window)) {\n    // do nothing because intersection observer is not available\n    return Vue.extend({ name: 'intersectable' })\n  }\n\n  return Vue.extend({\n    name: 'intersectable',\n\n    mounted () {\n      Intersect.inserted(this.$el as HTMLElement, {\n        name: 'intersect',\n        value: this.onObserve,\n      })\n    },\n\n    destroyed () {\n      Intersect.unbind(this.$el as HTMLElement)\n    },\n\n    methods: {\n      onObserve (entries: IntersectionObserverEntry[], observer: IntersectionObserver, isIntersecting: boolean) {\n        if (!isIntersecting) return\n\n        for (let i = 0, length = options.onVisible.length; i < length; i++) {\n          const callback = (this as any)[options.onVisible[i]]\n\n          if (typeof callback === 'function') {\n            callback()\n            continue\n          }\n\n          consoleWarn(options.onVisible[i] + ' method is not available on the instance but referenced in intersectable mixin options')\n        }\n      },\n    },\n  })\n}\n","// Styles\nimport './VTextField.sass'\n\n// Extensions\nimport VInput from '../VInput'\n\n// Components\nimport VCounter from '../VCounter'\nimport VLabel from '../VLabel'\n\n// Mixins\nimport Intersectable from '../../mixins/intersectable'\nimport Loadable from '../../mixins/loadable'\nimport Validatable from '../../mixins/validatable'\n\n// Directives\nimport resize from '../../directives/resize'\nimport ripple from '../../directives/ripple'\n\n// Utilities\nimport { convertToUnit, keyCodes } from '../../util/helpers'\nimport { breaking, consoleWarn } from '../../util/console'\n\n// Types\nimport mixins from '../../util/mixins'\nimport { VNode, PropType } from 'vue/types'\n\nconst baseMixins = mixins(\n  VInput,\n  Intersectable({\n    onVisible: [\n      'onResize',\n      'tryAutofocus',\n    ],\n  }),\n  Loadable,\n)\ninterface options extends InstanceType<typeof baseMixins> {\n  $refs: {\n    label: HTMLElement\n    input: HTMLInputElement\n    'prepend-inner': HTMLElement\n    prefix: HTMLElement\n    suffix: HTMLElement\n  }\n}\n\nconst dirtyTypes = ['color', 'file', 'time', 'date', 'datetime-local', 'week', 'month']\n\n/* @vue/component */\nexport default baseMixins.extend<options>().extend({\n  name: 'v-text-field',\n\n  directives: {\n    resize,\n    ripple,\n  },\n\n  inheritAttrs: false,\n\n  props: {\n    appendOuterIcon: String,\n    autofocus: Boolean,\n    clearable: Boolean,\n    clearIcon: {\n      type: String,\n      default: '$clear',\n    },\n    counter: [Boolean, Number, String],\n    counterValue: Function as PropType<(value: any) => number>,\n    filled: Boolean,\n    flat: Boolean,\n    fullWidth: Boolean,\n    label: String,\n    outlined: Boolean,\n    placeholder: String,\n    prefix: String,\n    prependInnerIcon: String,\n    reverse: Boolean,\n    rounded: Boolean,\n    shaped: Boolean,\n    singleLine: Boolean,\n    solo: Boolean,\n    soloInverted: Boolean,\n    suffix: String,\n    type: {\n      type: String,\n      default: 'text',\n    },\n  },\n\n  data: () => ({\n    badInput: false,\n    labelWidth: 0,\n    prefixWidth: 0,\n    prependWidth: 0,\n    initialValue: null,\n    isBooted: false,\n    isClearing: false,\n  }),\n\n  computed: {\n    classes (): object {\n      return {\n        ...VInput.options.computed.classes.call(this),\n        'v-text-field': true,\n        'v-text-field--full-width': this.fullWidth,\n        'v-text-field--prefix': this.prefix,\n        'v-text-field--single-line': this.isSingle,\n        'v-text-field--solo': this.isSolo,\n        'v-text-field--solo-inverted': this.soloInverted,\n        'v-text-field--solo-flat': this.flat,\n        'v-text-field--filled': this.filled,\n        'v-text-field--is-booted': this.isBooted,\n        'v-text-field--enclosed': this.isEnclosed,\n        'v-text-field--reverse': this.reverse,\n        'v-text-field--outlined': this.outlined,\n        'v-text-field--placeholder': this.placeholder,\n        'v-text-field--rounded': this.rounded,\n        'v-text-field--shaped': this.shaped,\n      }\n    },\n    computedColor (): string | undefined {\n      const computedColor = Validatable.options.computed.computedColor.call(this)\n\n      if (!this.soloInverted || !this.isFocused) return computedColor\n\n      return this.color || 'primary'\n    },\n    computedCounterValue (): number {\n      if (typeof this.counterValue === 'function') {\n        return this.counterValue(this.internalValue)\n      }\n      return [...(this.internalValue || '').toString()].length\n    },\n    hasCounter (): boolean {\n      return this.counter !== false && this.counter != null\n    },\n    hasDetails (): boolean {\n      return VInput.options.computed.hasDetails.call(this) || this.hasCounter\n    },\n    internalValue: {\n      get (): any {\n        return this.lazyValue\n      },\n      set (val: any) {\n        this.lazyValue = val\n        this.$emit('input', this.lazyValue)\n      },\n    },\n    isDirty (): boolean {\n      return this.lazyValue?.toString().length > 0 || this.badInput\n    },\n    isEnclosed (): boolean {\n      return (\n        this.filled ||\n        this.isSolo ||\n        this.outlined\n      )\n    },\n    isLabelActive (): boolean {\n      return this.isDirty || dirtyTypes.includes(this.type)\n    },\n    isSingle (): boolean {\n      return (\n        this.isSolo ||\n        this.singleLine ||\n        this.fullWidth ||\n        // https://material.io/components/text-fields/#filled-text-field\n        (this.filled && !this.hasLabel)\n      )\n    },\n    isSolo (): boolean {\n      return this.solo || this.soloInverted\n    },\n    labelPosition (): Record<'left' | 'right', string | number | undefined> {\n      let offset = (this.prefix && !this.labelValue) ? this.prefixWidth : 0\n\n      if (this.labelValue && this.prependWidth) offset -= this.prependWidth\n\n      return (this.$vuetify.rtl === this.reverse) ? {\n        left: offset,\n        right: 'auto',\n      } : {\n        left: 'auto',\n        right: offset,\n      }\n    },\n    showLabel (): boolean {\n      return this.hasLabel && (!this.isSingle || (!this.isLabelActive && !this.placeholder))\n    },\n    labelValue (): boolean {\n      return !this.isSingle &&\n        Boolean(this.isFocused || this.isLabelActive || this.placeholder)\n    },\n  },\n\n  watch: {\n    // labelValue: 'setLabelWidth', // moved to mounted, see #11533\n    outlined: 'setLabelWidth',\n    label () {\n      this.$nextTick(this.setLabelWidth)\n    },\n    prefix () {\n      this.$nextTick(this.setPrefixWidth)\n    },\n    isFocused: 'updateValue',\n    value (val) {\n      this.lazyValue = val\n    },\n  },\n\n  created () {\n    /* istanbul ignore next */\n    if (this.$attrs.hasOwnProperty('box')) {\n      breaking('box', 'filled', this)\n    }\n\n    /* istanbul ignore next */\n    if (this.$attrs.hasOwnProperty('browser-autocomplete')) {\n      breaking('browser-autocomplete', 'autocomplete', this)\n    }\n\n    /* istanbul ignore if */\n    if (this.shaped && !(this.filled || this.outlined || this.isSolo)) {\n      consoleWarn('shaped should be used with either filled or outlined', this)\n    }\n  },\n\n  mounted () {\n    // #11533\n    this.$watch(() => this.labelValue, this.setLabelWidth)\n\n    this.autofocus && this.tryAutofocus()\n\n    requestAnimationFrame(() => (this.isBooted = true))\n  },\n\n  methods: {\n    /** @public */\n    focus () {\n      this.onFocus()\n    },\n    /** @public */\n    blur (e?: Event) {\n      // https://github.com/vuetifyjs/vuetify/issues/5913\n      // Safari tab order gets broken if called synchronous\n      window.requestAnimationFrame(() => {\n        this.$refs.input && this.$refs.input.blur()\n      })\n    },\n    clearableCallback () {\n      this.$refs.input && this.$refs.input.focus()\n      this.$nextTick(() => this.internalValue = null)\n    },\n    genAppendSlot () {\n      const slot = []\n\n      if (this.$slots['append-outer']) {\n        slot.push(this.$slots['append-outer'] as VNode[])\n      } else if (this.appendOuterIcon) {\n        slot.push(this.genIcon('appendOuter'))\n      }\n\n      return this.genSlot('append', 'outer', slot)\n    },\n    genPrependInnerSlot () {\n      const slot = []\n\n      if (this.$slots['prepend-inner']) {\n        slot.push(this.$slots['prepend-inner'] as VNode[])\n      } else if (this.prependInnerIcon) {\n        slot.push(this.genIcon('prependInner'))\n      }\n\n      return this.genSlot('prepend', 'inner', slot)\n    },\n    genIconSlot () {\n      const slot = []\n\n      if (this.$slots.append) {\n        slot.push(this.$slots.append as VNode[])\n      } else if (this.appendIcon) {\n        slot.push(this.genIcon('append'))\n      }\n\n      return this.genSlot('append', 'inner', slot)\n    },\n    genInputSlot () {\n      const input = VInput.options.methods.genInputSlot.call(this)\n\n      const prepend = this.genPrependInnerSlot()\n\n      if (prepend) {\n        input.children = input.children || []\n        input.children.unshift(prepend)\n      }\n\n      return input\n    },\n    genClearIcon () {\n      if (!this.clearable) return null\n\n      const data = this.isDirty ? undefined : { attrs: { disabled: true } }\n\n      return this.genSlot('append', 'inner', [\n        this.genIcon('clear', this.clearableCallback, data),\n      ])\n    },\n    genCounter () {\n      if (!this.hasCounter) return null\n\n      const max = this.counter === true ? this.attrs$.maxlength : this.counter\n\n      return this.$createElement(VCounter, {\n        props: {\n          dark: this.dark,\n          light: this.light,\n          max,\n          value: this.computedCounterValue,\n        },\n      })\n    },\n    genControl () {\n      return VInput.options.methods.genControl.call(this)\n    },\n    genDefaultSlot () {\n      return [\n        this.genFieldset(),\n        this.genTextFieldSlot(),\n        this.genClearIcon(),\n        this.genIconSlot(),\n        this.genProgress(),\n      ]\n    },\n    genFieldset () {\n      if (!this.outlined) return null\n\n      return this.$createElement('fieldset', {\n        attrs: {\n          'aria-hidden': true,\n        },\n      }, [this.genLegend()])\n    },\n    genLabel () {\n      if (!this.showLabel) return null\n\n      const data = {\n        props: {\n          absolute: true,\n          color: this.validationState,\n          dark: this.dark,\n          disabled: this.isDisabled,\n          focused: !this.isSingle && (this.isFocused || !!this.validationState),\n          for: this.computedId,\n          left: this.labelPosition.left,\n          light: this.light,\n          right: this.labelPosition.right,\n          value: this.labelValue,\n        },\n      }\n\n      return this.$createElement(VLabel, data, this.$slots.label || this.label)\n    },\n    genLegend () {\n      const width = !this.singleLine && (this.labelValue || this.isDirty) ? this.labelWidth : 0\n      const span = this.$createElement('span', {\n        domProps: { innerHTML: '&#8203;' },\n      })\n\n      return this.$createElement('legend', {\n        style: {\n          width: !this.isSingle ? convertToUnit(width) : undefined,\n        },\n      }, [span])\n    },\n    genInput () {\n      const listeners = Object.assign({}, this.listeners$)\n      delete listeners.change // Change should not be bound externally\n\n      return this.$createElement('input', {\n        style: {},\n        domProps: {\n          value: (this.type === 'number' && Object.is(this.lazyValue, -0)) ? '-0' : this.lazyValue,\n        },\n        attrs: {\n          ...this.attrs$,\n          autofocus: this.autofocus,\n          disabled: this.isDisabled,\n          id: this.computedId,\n          placeholder: this.placeholder,\n          readonly: this.isReadonly,\n          type: this.type,\n        },\n        on: Object.assign(listeners, {\n          blur: this.onBlur,\n          input: this.onInput,\n          focus: this.onFocus,\n          keydown: this.onKeyDown,\n        }),\n        ref: 'input',\n        directives: [{\n          name: 'resize',\n          modifiers: { quiet: true },\n          value: this.onResize,\n        }],\n      })\n    },\n    genMessages () {\n      if (!this.showDetails) return null\n\n      const messagesNode = VInput.options.methods.genMessages.call(this)\n      const counterNode = this.genCounter()\n\n      return this.$createElement('div', {\n        staticClass: 'v-text-field__details',\n      }, [\n        messagesNode,\n        counterNode,\n      ])\n    },\n    genTextFieldSlot () {\n      return this.$createElement('div', {\n        staticClass: 'v-text-field__slot',\n      }, [\n        this.genLabel(),\n        this.prefix ? this.genAffix('prefix') : null,\n        this.genInput(),\n        this.suffix ? this.genAffix('suffix') : null,\n      ])\n    },\n    genAffix (type: 'prefix' | 'suffix') {\n      return this.$createElement('div', {\n        class: `v-text-field__${type}`,\n        ref: type,\n      }, this[type])\n    },\n    onBlur (e?: Event) {\n      this.isFocused = false\n      e && this.$nextTick(() => this.$emit('blur', e))\n    },\n    onClick () {\n      if (this.isFocused || this.isDisabled || !this.$refs.input) return\n\n      this.$refs.input.focus()\n    },\n    onFocus (e?: Event) {\n      if (!this.$refs.input) return\n\n      if (document.activeElement !== this.$refs.input) {\n        return this.$refs.input.focus()\n      }\n\n      if (!this.isFocused) {\n        this.isFocused = true\n        e && this.$emit('focus', e)\n      }\n    },\n    onInput (e: Event) {\n      const target = e.target as HTMLInputElement\n      this.internalValue = target.value\n      this.badInput = target.validity && target.validity.badInput\n    },\n    onKeyDown (e: KeyboardEvent) {\n      if (e.keyCode === keyCodes.enter) this.$emit('change', this.internalValue)\n\n      this.$emit('keydown', e)\n    },\n    onMouseDown (e: Event) {\n      // Prevent input from being blurred\n      if (e.target !== this.$refs.input) {\n        e.preventDefault()\n        e.stopPropagation()\n      }\n\n      VInput.options.methods.onMouseDown.call(this, e)\n    },\n    onMouseUp (e: Event) {\n      if (this.hasMouseDown) this.focus()\n\n      VInput.options.methods.onMouseUp.call(this, e)\n    },\n    setLabelWidth () {\n      if (!this.outlined) return\n\n      this.labelWidth = this.$refs.label\n        ? Math.min(this.$refs.label.scrollWidth * 0.75 + 6, (this.$el as HTMLElement).offsetWidth - 24)\n        : 0\n    },\n    setPrefixWidth () {\n      if (!this.$refs.prefix) return\n\n      this.prefixWidth = this.$refs.prefix.offsetWidth\n    },\n    setPrependWidth () {\n      if (!this.outlined || !this.$refs['prepend-inner']) return\n\n      this.prependWidth = this.$refs['prepend-inner'].offsetWidth\n    },\n    tryAutofocus () {\n      if (\n        !this.autofocus ||\n        typeof document === 'undefined' ||\n        !this.$refs.input ||\n        document.activeElement === this.$refs.input\n      ) return false\n\n      this.$refs.input.focus()\n\n      return true\n    },\n    updateValue (val: boolean) {\n      // Sets validationState from validatable\n      this.hasColor = val\n\n      if (val) {\n        this.initialValue = this.lazyValue\n      } else if (this.initialValue !== this.lazyValue) {\n        this.$emit('change', this.lazyValue)\n      }\n    },\n    onResize () {\n      this.setLabelWidth()\n      this.setPrefixWidth()\n      this.setPrependWidth()\n    },\n  },\n})\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","import VIcon from './VIcon'\n\nexport { VIcon }\nexport default VIcon\n","'use strict';\nvar $ = require('../internals/export');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('splice', { ACCESSORS: true, 0: 0, 1: 2 });\n\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = toLength(O.length);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toInteger(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","// Styles\nimport './VLabel.sass'\n\n// Mixins\nimport Colorable from '../../mixins/colorable'\nimport Themeable, { functionalThemeClasses } from '../../mixins/themeable'\n\n// Types\nimport { VNode } from 'vue'\nimport mixins from '../../util/mixins'\n\n// Helpers\nimport { convertToUnit } from '../../util/helpers'\n\n/* @vue/component */\nexport default mixins(Themeable).extend({\n  name: 'v-label',\n\n  functional: true,\n\n  props: {\n    absolute: Boolean,\n    color: {\n      type: String,\n      default: 'primary',\n    },\n    disabled: Boolean,\n    focused: Boolean,\n    for: String,\n    left: {\n      type: [Number, String],\n      default: 0,\n    },\n    right: {\n      type: [Number, String],\n      default: 'auto',\n    },\n    value: Boolean,\n  },\n\n  render (h, ctx): VNode {\n    const { children, listeners, props } = ctx\n    const data = {\n      staticClass: 'v-label',\n      class: {\n        'v-label--active': props.value,\n        'v-label--is-disabled': props.disabled,\n        ...functionalThemeClasses(ctx),\n      },\n      attrs: {\n        for: props.for,\n        'aria-hidden': !props.for,\n      },\n      on: listeners,\n      style: {\n        left: convertToUnit(props.left),\n        right: convertToUnit(props.right),\n        position: props.absolute ? 'absolute' : 'relative',\n      },\n      ref: 'label',\n    }\n\n    return h('label', Colorable.options.methods.setTextColor(props.focused && props.color, data), children)\n  },\n})\n","import VLabel from './VLabel'\n\nexport { VLabel }\nexport default VLabel\n","// Styles\nimport './VMessages.sass'\n\n// Mixins\nimport Colorable from '../../mixins/colorable'\nimport Themeable from '../../mixins/themeable'\n\n// Types\nimport { VNode } from 'vue'\nimport { PropValidator } from 'vue/types/options'\nimport mixins from '../../util/mixins'\n\n// Utilities\nimport { getSlot } from '../../util/helpers'\n\n/* @vue/component */\nexport default mixins(Colorable, Themeable).extend({\n  name: 'v-messages',\n\n  props: {\n    value: {\n      type: Array,\n      default: () => ([]),\n    } as PropValidator<string[]>,\n  },\n\n  methods: {\n    genChildren () {\n      return this.$createElement('transition-group', {\n        staticClass: 'v-messages__wrapper',\n        attrs: {\n          name: 'message-transition',\n          tag: 'div',\n        },\n      }, this.value.map(this.genMessage))\n    },\n    genMessage (message: string, key: number) {\n      return this.$createElement('div', {\n        staticClass: 'v-messages__message',\n        key,\n      }, getSlot(this, 'default', { message, key }) || [message])\n    },\n  },\n\n  render (h): VNode {\n    return h('div', this.setTextColor(this.color, {\n      staticClass: 'v-messages',\n      class: this.themeClasses,\n    }), [this.genChildren()])\n  },\n})\n","import VMessages from './VMessages'\n\nexport { VMessages }\nexport default VMessages\n","// Styles\nimport './VInput.sass'\n\n// Components\nimport VIcon from '../VIcon'\nimport VLabel from '../VLabel'\nimport VMessages from '../VMessages'\n\n// Mixins\nimport BindsAttrs from '../../mixins/binds-attrs'\nimport Validatable from '../../mixins/validatable'\n\n// Utilities\nimport {\n  convertToUnit,\n  getSlot,\n  kebabCase,\n} from '../../util/helpers'\nimport mergeData from '../../util/mergeData'\n\n// Types\nimport { VNode, VNodeData, PropType } from 'vue'\nimport mixins from '../../util/mixins'\nimport { InputValidationRule } from 'vuetify/types'\n\nconst baseMixins = mixins(\n  BindsAttrs,\n  Validatable,\n)\n\ninterface options extends InstanceType<typeof baseMixins> {\n  /* eslint-disable-next-line camelcase */\n  $_modelEvent: string\n}\n\n/* @vue/component */\nexport default baseMixins.extend<options>().extend({\n  name: 'v-input',\n\n  inheritAttrs: false,\n\n  props: {\n    appendIcon: String,\n    backgroundColor: {\n      type: String,\n      default: '',\n    },\n    dense: Boolean,\n    height: [Number, String],\n    hideDetails: [Boolean, String] as PropType<boolean | 'auto'>,\n    hint: String,\n    id: String,\n    label: String,\n    loading: Boolean,\n    persistentHint: Boolean,\n    prependIcon: String,\n    value: null as any as PropType<any>,\n  },\n\n  data () {\n    return {\n      lazyValue: this.value,\n      hasMouseDown: false,\n    }\n  },\n\n  computed: {\n    classes (): object {\n      return {\n        'v-input--has-state': this.hasState,\n        'v-input--hide-details': !this.showDetails,\n        'v-input--is-label-active': this.isLabelActive,\n        'v-input--is-dirty': this.isDirty,\n        'v-input--is-disabled': this.isDisabled,\n        'v-input--is-focused': this.isFocused,\n        // <v-switch loading>.loading === '' so we can't just cast to boolean\n        'v-input--is-loading': this.loading !== false && this.loading != null,\n        'v-input--is-readonly': this.isReadonly,\n        'v-input--dense': this.dense,\n        ...this.themeClasses,\n      }\n    },\n    computedId (): string {\n      return this.id || `input-${this._uid}`\n    },\n    hasDetails (): boolean {\n      return this.messagesToDisplay.length > 0\n    },\n    hasHint (): boolean {\n      return !this.hasMessages &&\n        !!this.hint &&\n        (this.persistentHint || this.isFocused)\n    },\n    hasLabel (): boolean {\n      return !!(this.$slots.label || this.label)\n    },\n    // Proxy for `lazyValue`\n    // This allows an input\n    // to function without\n    // a provided model\n    internalValue: {\n      get (): any {\n        return this.lazyValue\n      },\n      set (val: any) {\n        this.lazyValue = val\n        this.$emit(this.$_modelEvent, val)\n      },\n    },\n    isDirty (): boolean {\n      return !!this.lazyValue\n    },\n    isLabelActive (): boolean {\n      return this.isDirty\n    },\n    messagesToDisplay (): string[] {\n      if (this.hasHint) return [this.hint]\n\n      if (!this.hasMessages) return []\n\n      return this.validations.map((validation: string | InputValidationRule) => {\n        if (typeof validation === 'string') return validation\n\n        const validationResult = validation(this.internalValue)\n\n        return typeof validationResult === 'string' ? validationResult : ''\n      }).filter(message => message !== '')\n    },\n    showDetails (): boolean {\n      return this.hideDetails === false || (this.hideDetails === 'auto' && this.hasDetails)\n    },\n  },\n\n  watch: {\n    value (val) {\n      this.lazyValue = val\n    },\n  },\n\n  beforeCreate () {\n    // v-radio-group needs to emit a different event\n    // https://github.com/vuetifyjs/vuetify/issues/4752\n    this.$_modelEvent = (this.$options.model && this.$options.model.event) || 'input'\n  },\n\n  methods: {\n    genContent () {\n      return [\n        this.genPrependSlot(),\n        this.genControl(),\n        this.genAppendSlot(),\n      ]\n    },\n    genControl () {\n      return this.$createElement('div', {\n        staticClass: 'v-input__control',\n      }, [\n        this.genInputSlot(),\n        this.genMessages(),\n      ])\n    },\n    genDefaultSlot () {\n      return [\n        this.genLabel(),\n        this.$slots.default,\n      ]\n    },\n    genIcon (\n      type: string,\n      cb?: (e: Event) => void,\n      extraData: VNodeData = {}\n    ) {\n      const icon = (this as any)[`${type}Icon`]\n      const eventName = `click:${kebabCase(type)}`\n      const hasListener = !!(this.listeners$[eventName] || cb)\n\n      const data = mergeData({\n        attrs: {\n          'aria-label': hasListener ? kebabCase(type).split('-')[0] + ' icon' : undefined,\n          color: this.validationState,\n          dark: this.dark,\n          disabled: this.isDisabled,\n          light: this.light,\n        },\n        on: !hasListener\n          ? undefined\n          : {\n            click: (e: Event) => {\n              e.preventDefault()\n              e.stopPropagation()\n\n              this.$emit(eventName, e)\n              cb && cb(e)\n            },\n            // Container has g event that will\n            // trigger menu open if enclosed\n            mouseup: (e: Event) => {\n              e.preventDefault()\n              e.stopPropagation()\n            },\n          },\n      }, extraData)\n\n      return this.$createElement('div', {\n        staticClass: `v-input__icon`,\n        class: type ? `v-input__icon--${kebabCase(type)}` : undefined,\n      }, [\n        this.$createElement(\n          VIcon,\n          data,\n          icon\n        ),\n      ])\n    },\n    genInputSlot () {\n      return this.$createElement('div', this.setBackgroundColor(this.backgroundColor, {\n        staticClass: 'v-input__slot',\n        style: { height: convertToUnit(this.height) },\n        on: {\n          click: this.onClick,\n          mousedown: this.onMouseDown,\n          mouseup: this.onMouseUp,\n        },\n        ref: 'input-slot',\n      }), [this.genDefaultSlot()])\n    },\n    genLabel () {\n      if (!this.hasLabel) return null\n\n      return this.$createElement(VLabel, {\n        props: {\n          color: this.validationState,\n          dark: this.dark,\n          disabled: this.isDisabled,\n          focused: this.hasState,\n          for: this.computedId,\n          light: this.light,\n        },\n      }, this.$slots.label || this.label)\n    },\n    genMessages () {\n      if (!this.showDetails) return null\n\n      return this.$createElement(VMessages, {\n        props: {\n          color: this.hasHint ? '' : this.validationState,\n          dark: this.dark,\n          light: this.light,\n          value: this.messagesToDisplay,\n        },\n        attrs: {\n          role: this.hasMessages ? 'alert' : null,\n        },\n        scopedSlots: {\n          default: props => getSlot(this, 'message', props),\n        },\n      })\n    },\n    genSlot (\n      type: string,\n      location: string,\n      slot: (VNode | VNode[])[]\n    ) {\n      if (!slot.length) return null\n\n      const ref = `${type}-${location}`\n\n      return this.$createElement('div', {\n        staticClass: `v-input__${ref}`,\n        ref,\n      }, slot)\n    },\n    genPrependSlot () {\n      const slot = []\n\n      if (this.$slots.prepend) {\n        slot.push(this.$slots.prepend)\n      } else if (this.prependIcon) {\n        slot.push(this.genIcon('prepend'))\n      }\n\n      return this.genSlot('prepend', 'outer', slot)\n    },\n    genAppendSlot () {\n      const slot = []\n\n      // Append icon for text field was really\n      // an appended inner icon, v-text-field\n      // will overwrite this method in order to obtain\n      // backwards compat\n      if (this.$slots.append) {\n        slot.push(this.$slots.append)\n      } else if (this.appendIcon) {\n        slot.push(this.genIcon('append'))\n      }\n\n      return this.genSlot('append', 'outer', slot)\n    },\n    onClick (e: Event) {\n      this.$emit('click', e)\n    },\n    onMouseDown (e: Event) {\n      this.hasMouseDown = true\n      this.$emit('mousedown', e)\n    },\n    onMouseUp (e: Event) {\n      this.hasMouseDown = false\n      this.$emit('mouseup', e)\n    },\n  },\n\n  render (h): VNode {\n    return h('div', this.setTextColor(this.validationState, {\n      staticClass: 'v-input',\n      class: this.classes,\n    }), this.genContent())\n  },\n})\n","import VInput from './VInput'\n\nexport { VInput }\nexport default VInput\n","// Styles\nimport './VChip.sass'\n\n// Types\nimport { VNode } from 'vue'\nimport mixins from '../../util/mixins'\n\n// Components\nimport { VExpandXTransition } from '../transitions'\nimport VIcon from '../VIcon'\n\n// Mixins\nimport Colorable from '../../mixins/colorable'\nimport { factory as GroupableFactory } from '../../mixins/groupable'\nimport Themeable from '../../mixins/themeable'\nimport { factory as ToggleableFactory } from '../../mixins/toggleable'\nimport Routable from '../../mixins/routable'\nimport Sizeable from '../../mixins/sizeable'\n\n// Utilities\nimport { breaking } from '../../util/console'\n\n// Types\nimport { PropValidator, PropType } from 'vue/types/options'\n\n/* @vue/component */\nexport default mixins(\n  Colorable,\n  Sizeable,\n  Routable,\n  Themeable,\n  GroupableFactory('chipGroup'),\n  ToggleableFactory('inputValue')\n).extend({\n  name: 'v-chip',\n\n  props: {\n    active: {\n      type: Boolean,\n      default: true,\n    },\n    activeClass: {\n      type: String,\n      default (): string | undefined {\n        if (!this.chipGroup) return ''\n\n        return this.chipGroup.activeClass\n      },\n    } as any as PropValidator<string>,\n    close: Boolean,\n    closeIcon: {\n      type: String,\n      default: '$delete',\n    },\n    disabled: Boolean,\n    draggable: Boolean,\n    filter: Boolean,\n    filterIcon: {\n      type: String,\n      default: '$complete',\n    },\n    label: Boolean,\n    link: Boolean,\n    outlined: Boolean,\n    pill: Boolean,\n    tag: {\n      type: String,\n      default: 'span',\n    },\n    textColor: String,\n    value: null as any as PropType<any>,\n  },\n\n  data: () => ({\n    proxyClass: 'v-chip--active',\n  }),\n\n  computed: {\n    classes (): object {\n      return {\n        'v-chip': true,\n        ...Routable.options.computed.classes.call(this),\n        'v-chip--clickable': this.isClickable,\n        'v-chip--disabled': this.disabled,\n        'v-chip--draggable': this.draggable,\n        'v-chip--label': this.label,\n        'v-chip--link': this.isLink,\n        'v-chip--no-color': !this.color,\n        'v-chip--outlined': this.outlined,\n        'v-chip--pill': this.pill,\n        'v-chip--removable': this.hasClose,\n        ...this.themeClasses,\n        ...this.sizeableClasses,\n        ...this.groupClasses,\n      }\n    },\n    hasClose (): boolean {\n      return Boolean(this.close)\n    },\n    isClickable (): boolean {\n      return Boolean(\n        Routable.options.computed.isClickable.call(this) ||\n        this.chipGroup\n      )\n    },\n  },\n\n  created () {\n    const breakingProps = [\n      ['outline', 'outlined'],\n      ['selected', 'input-value'],\n      ['value', 'active'],\n      ['@input', '@active.sync'],\n    ]\n\n    /* istanbul ignore next */\n    breakingProps.forEach(([original, replacement]) => {\n      if (this.$attrs.hasOwnProperty(original)) breaking(original, replacement, this)\n    })\n  },\n\n  methods: {\n    click (e: MouseEvent): void {\n      this.$emit('click', e)\n\n      this.chipGroup && this.toggle()\n    },\n    genFilter (): VNode {\n      const children = []\n\n      if (this.isActive) {\n        children.push(\n          this.$createElement(VIcon, {\n            staticClass: 'v-chip__filter',\n            props: { left: true },\n          }, this.filterIcon)\n        )\n      }\n\n      return this.$createElement(VExpandXTransition, children)\n    },\n    genClose (): VNode {\n      return this.$createElement(VIcon, {\n        staticClass: 'v-chip__close',\n        props: {\n          right: true,\n          size: 18,\n        },\n        on: {\n          click: (e: Event) => {\n            e.stopPropagation()\n            e.preventDefault()\n\n            this.$emit('click:close')\n            this.$emit('update:active', false)\n          },\n        },\n      }, this.closeIcon)\n    },\n    genContent (): VNode {\n      return this.$createElement('span', {\n        staticClass: 'v-chip__content',\n      }, [\n        this.filter && this.genFilter(),\n        this.$slots.default,\n        this.hasClose && this.genClose(),\n      ])\n    },\n  },\n\n  render (h): VNode {\n    const children = [this.genContent()]\n    let { tag, data } = this.generateRouteLink()\n\n    data.attrs = {\n      ...data.attrs,\n      draggable: this.draggable ? 'true' : undefined,\n      tabindex: this.chipGroup && !this.disabled ? 0 : data.attrs!.tabindex,\n    }\n    data.directives!.push({\n      name: 'show',\n      value: this.active,\n    })\n    data = this.setBackgroundColor(this.color, data)\n\n    const color = this.textColor || (this.outlined && this.color)\n\n    return h(tag, this.setTextColor(color, data), children)\n  },\n})\n","import { VNodeDirective } from 'vue/types/vnode'\n\ninterface ResizeVNodeDirective extends VNodeDirective {\n  value?: () => void\n  options?: boolean | AddEventListenerOptions\n}\n\nfunction inserted (el: HTMLElement, binding: ResizeVNodeDirective) {\n  const callback = binding.value!\n  const options = binding.options || { passive: true }\n\n  window.addEventListener('resize', callback, options)\n  el._onResize = {\n    callback,\n    options,\n  }\n\n  if (!binding.modifiers || !binding.modifiers.quiet) {\n    callback()\n  }\n}\n\nfunction unbind (el: HTMLElement) {\n  if (!el._onResize) return\n\n  const { callback, options } = el._onResize\n  window.removeEventListener('resize', callback, options)\n  delete el._onResize\n}\n\nexport const Resize = {\n  inserted,\n  unbind,\n}\n\nexport default Resize\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n"],"sourceRoot":""}